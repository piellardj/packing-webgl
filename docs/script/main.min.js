!function(){"use strict";var e={377:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ColorPicker=void 0;var n=i(697),r=[[new n.Color(29,62,94),new n.Color(44,98,154),new n.Color(68,174,163),new n.Color(243,214,99),new n.Color(233,86,64)],[new n.Color(14,61,4),new n.Color(23,122,8),new n.Color(183,58,69),new n.Color(238,213,157),new n.Color(209,135,52)],[new n.Color(8,29,60),new n.Color(31,99,159),new n.Color(60,157,199),new n.Color(175,240,255),new n.Color(235,184,133)],[new n.Color(141,28,11),new n.Color(164,75,38),new n.Color(229,171,84),new n.Color(127,164,161),new n.Color(91,125,123),new n.Color(31,54,54)],[new n.Color(38,38,38),new n.Color(76,76,76),new n.Color(114,114,114),new n.Color(153,153,153),new n.Color(191,191,191),new n.Color(220,220,220)],[new n.Color(252,17,147),new n.Color(23,0,81),new n.Color(106,39,197),new n.Color(33,168,159),new n.Color(133,224,191)],[new n.Color(167,206,160),new n.Color(95,154,121),new n.Color(55,82,83),new n.Color(218,172,115),new n.Color(244,219,142),new n.Color(155,143,100),new n.Color(170,109,75)],[new n.Color(255,0,0),new n.Color(135,0,255),new n.Color(46,0,255),new n.Color(0,161,255),new n.Color(0,255,46),new n.Color(238,255,0),new n.Color(255,123,0)],[new n.Color(85,21,37),new n.Color(220,37,82),new n.Color(243,81,120),new n.Color(250,153,185),new n.Color(249,235,209)]],o=function(){function e(){}return e.setPalette=function(t){t<0||t>=r.length?this.usePalette=!1:(this.usePalette=!0,e.palette=r[t])},e.getDisplayColor=function(t,i){return e.highContrastMode?i%2==+e.darkMode?n.Color.WHITE:n.Color.BLACK:t},e.getDifferentColorFromPalette=function(t){var i,n=e.palette.length;do{var r=Math.floor(n*Math.random());i=e.palette[r]}while(i===t);return i},e.highContrastMode=!1,e.darkMode=!1,e.usePalette=!1,e.palette=r[0],e}();t.ColorPicker=o},697:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Color=void 0,"function"!=typeof String.prototype.padStart&&(String.prototype.padStart=function(e,t){if(this.length>e)return String(this);t||(t=" ");for(var i=Math.ceil((e-this.length)/t.length),n="",r=0;r<i;r++)n+=t;return n+this});var i=function(){function e(e,t,i){this.r=e,this.g=t,this.b=i}return e.random=function(){return new e(e.randomChannel(),e.randomChannel(),e.randomChannel())},e.prototype.toString=function(){if(!this.hexString){var e=this.r.toString(16).padStart(2,"0"),t=this.g.toString(16).padStart(2,"0"),i=this.b.toString(16).padStart(2,"0");this.hexString="#".concat(e).concat(t).concat(i)}return this.hexString},e.randomChannel=function(){return Math.floor(256*Math.random())},e.BLACK=new e(0,0,0),e.WHITE=new e(255,255,255),e.GREEN=new e(0,255,0),e}();t.Color=i},642:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.mainDebugCollisions=void 0;var n=i(697),r=i(61),o=i(166),a=i(941),s=i(822),c=i(330),l=i(106),u=i(523),h=i(886),d={fixed:new l.PatternSquare,mobile:new l.PatternSquare},f={fixed:new a.PatternCircle,mobile:new a.PatternCircle},g={fixed:new c.PatternRectangle,mobile:new c.PatternRectangle},p={fixed:new u.PatternTriangle,mobile:new u.PatternTriangle},P={fixed:new s.PatternHeart,mobile:new s.PatternHeart};function v(e){return m({width:e,height:e})}function m(e){return[{from:{x:-.5*e.width,y:-.5*e.height},to:{x:.5*e.width,y:-.5*e.height}},{from:{x:.5*e.width,y:-.5*e.height},to:{x:.5*e.width,y:.5*e.height}},{from:{x:.5*e.width,y:.5*e.height},to:{x:-.5*e.width,y:.5*e.height}},{from:{x:-.5*e.width,y:.5*e.height},to:{x:-.5*e.width,y:-.5*e.height}}]}t.mainDebugCollisions=function(){var e=new h.PlotterCanvas2D,t=1;Page.Canvas.Observers.mouseWheel.push((function(e){t+=.1*e,t=Math.max(.2,Math.min(10,t))})),requestAnimationFrame((function i(){var a,s=r.Parameters.currentCollisionType,c=(a=r.Parameters.primitive)===r.EPrimitive.SQUARE?d:a===r.EPrimitive.CIRCLE?f:a===r.EPrimitive.RECTANGLE?g:a===r.EPrimitive.TRIANGLE?p:P,l=Page.Canvas.getSize(),u=Math.min(l[0],l[1]),h=Page.Canvas.getMousePosition();c.mobile.center.x=(h[0]-.5)*l[0],c.mobile.center.y=(h[1]-.5)*l[1],c.fixed.center.x=0,c.fixed.center.y=0,c.fixed.size=.5*t*u;var y=function(){var t=r.Parameters.primitive;return t===r.EPrimitive.SQUARE?function(t){return e.drawSquares(t)}:t===r.EPrimitive.CIRCLE?function(t){return e.drawCircles(t)}:t===r.EPrimitive.RECTANGLE?function(t){return e.drawRectangles(t)}:t===r.EPrimitive.TRIANGLE?function(t){return e.drawTriangles(t)}:function(t){return e.drawHearts(t)}}();if(s===r.ECollisionTestType.PRIMITIVE){c.mobile.size=c.mobile.computeBiggestSizePossibleToAvoidItem(c.fixed,!0).size;var b=v(c.fixed.size);e.initialize(n.Color.BLACK),y([c.fixed,c.mobile]),e.drawLines(b,n.Color.GREEN),e.finalize()}else if(s===r.ECollisionTestType.POINT)c.mobile.size=c.mobile.computeBiggestSizePossibleToAvoidPoint({x:0,y:0}),b=v(.5),e.initialize(n.Color.BLACK),y([c.mobile]),e.drawLines(b,n.Color.GREEN),e.finalize();else{c.mobile.size=.2*t*u;var _={width:.5*l[0],height:.5*l[1]},I=c.mobile.computeVisibility(_);I===o.EVisibility.COVERS_VIEW?console.log("covers view"):I===o.EVisibility.OUT_OF_VIEW?console.log("out of view"):console.log("visible"),b=m(_),e.initialize(n.Color.BLACK),y([c.mobile]),e.drawLines(b,n.Color.GREEN),e.finalize()}requestAnimationFrame(i)}))}},852:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Engine=void 0;var a=i(697),s=i(377),c=i(61),l=i(166),u=i(941),h=i(822),d=i(330),f=i(106),g=i(523),p=i(247),P=o(i(8)),v=i(587);i(457);var m=function(){function e(){this.initializedItemsList=[],this.uninitializedItemsList=[],this.lastRecyclingTime=0,this.grid=new p.Grid,this.zoomCenter={x:0,y:0},this.currentBackgroundItem=null}return e.prototype.reset=function(){var e=c.Parameters.primitive;if(e===c.EPrimitive.SQUARE)this.createItem=function(){return new f.PatternSquare};else if(e===c.EPrimitive.CIRCLE)this.createItem=function(){return new u.PatternCircle};else if(e===c.EPrimitive.RECTANGLE)this.createItem=function(){return new d.PatternRectangle};else if(e===c.EPrimitive.TRIANGLE)this.createItem=function(){return new g.PatternTriangle};else{if(e!==c.EPrimitive.HEART)throw new Error('Invalid primitive "'.concat(e,"."));this.createItem=function(){return new h.PatternHeart}}this.initializedItemsList=[],this.uninitializedItemsList=[],this.currentPrimitive=e,this.currentBackgroundItem=null,this.zoomCenter.x=0,this.zoomCenter.y=0},e.prototype.setItemsCount=function(e){var t=this.initializedItemsList.length,i=t+this.uninitializedItemsList.length;if(e>i)for(var n=e-i,r=0;r<n;r++){var o=this.createItem();this.uninitializedItemsList.push(o)}else e<i&&(e>t?this.uninitializedItemsList.length=e-t:(this.uninitializedItemsList=[],this.initializedItemsList.length=e))},e.prototype.draw=function(t){e.DEFAULT_BACKGROUND_ITEM.color=c.Parameters.blackBackground?a.Color.BLACK:a.Color.WHITE,s.ColorPicker.darkMode=c.Parameters.blackBackground,s.ColorPicker.highContrastMode=c.Parameters.highContrast;var i=t.isReady;c.Parameters.isZooming||performance.now()-this.lastRecyclingTime>l.PatternBase.maxBlendingTime||(i=!1);var n,r=this.computeBackgroundColor();if(t.initialize(r),n=c.Parameters.oneCellOnly?this.grid.getItemsFromCell(c.Parameters.cellX,c.Parameters.cellY):this.initializedItemsList,this.currentPrimitive===c.EPrimitive.SQUARE)t.drawSquares(n);else if(this.currentPrimitive===c.EPrimitive.CIRCLE)t.drawCircles(n);else if(this.currentPrimitive===c.EPrimitive.RECTANGLE)t.drawRectangles(n);else if(this.currentPrimitive===c.EPrimitive.TRIANGLE)t.drawTriangles(n);else{if(this.currentPrimitive!==c.EPrimitive.HEART)throw new Error("Unsupported primitive ".concat(this.currentPrimitive," for drawing."));t.drawHearts(n)}return c.Parameters.showGrid&&this.grid.draw(t),t.finalize(),i},e.prototype.udpate=function(e,t){var i=this.uninitializedItemsList.length>0,n=this.initializedItemsList.length>0&&c.Parameters.isZooming,r=void 0===this.grid;if(!(i||n||r))return!1;var o=!1;P.timeSpentInReindex.start();var a=this.reindexItems(t);o=o||a,P.timeSpentInReindex.stop(),P.timeSpentInRecycle.start();var s=this.performRecycling(t);if(o=o||s,s&&(this.lastRecyclingTime=performance.now()),P.timeSpentInRecycle.stop(),P.timeSpentInZoom.start(),c.Parameters.isZooming){var l=this.initializedItemsList.length>0;this.performZoom(e,t),o=o||l}return P.timeSpentInZoom.stop(),o},e.prototype.reindexItems=function(e){var t=c.Parameters.cellSize;if(c.Parameters.adaptativeGrid){var i=c.Parameters.targetItemsPerGridCell,n=this.grid.itemsPerCell;t=this.grid.cellSize,n<i?t++:t--}return this.grid.reset(e,t,this.initializedItemsList)},e.prototype.performRecycling=function(e){for(var t=0,i=c.Parameters.allowOverlapping,n=1-c.Parameters.spacing,r=new v.NumberRange(c.Parameters.minSize,1e6),o=c.Parameters.maxTriesPerFrame,a=this.backgroundItem,s=o;this.uninitializedItemsList.length>0&&s>0;){var l=this.uninitializedItemsList.pop(),u=l.reset(e,this.grid,n,r,i,a,s);s-=u.nbTries,u.success?(this.initializedItemsList.push(l),this.grid.registerItem(l),t++):this.uninitializedItemsList.push(l)}var h=this.initializedItemsList.length+this.uninitializedItemsList.length,d=this.uninitializedItemsList.length,f=o-s;return P.registerRecyclingStats(h,t,d,f),this.grid.computeStatistics(),t>0},e.prototype.performZoom=function(e,t){this.updateZoomCenter(t);for(var i=[],n=1+e*c.Parameters.zoomSpeed,r=0,o=this.initializedItemsList;r<o.length;r++){var a=o[r];a.zoomIn(this.zoomCenter,n);var s;(s=a.size>l.PatternBase.MAX_SIZE?l.EVisibility.OUT_OF_VIEW:a.computeVisibility(t))===l.EVisibility.VISIBLE?i.push(a):(this.uninitializedItemsList.push(a),s===l.EVisibility.COVERS_VIEW&&(this.currentBackgroundItem={nestingLevel:a.nestingLevel%1e5,color:a.rawColor}))}this.initializedItemsList=i},e.prototype.computeBackgroundColor=function(){var e=this.backgroundItem;return s.ColorPicker.getDisplayColor(e.color,e.nestingLevel)},e.prototype.updateZoomCenter=function(e){if(Page.Canvas.isMouseDown()){var t=Page.Canvas.getMousePosition();this.zoomCenter.x=e.width*(t[0]-.5),this.zoomCenter.y=e.height*(t[1]-.5)}var i=.5*e.width,n=.5*e.height;this.zoomCenter.x<-i?this.zoomCenter.x=-i:this.zoomCenter.x>i&&(this.zoomCenter.x=i),this.zoomCenter.y<-n?this.zoomCenter.y=-n:this.zoomCenter.y>n&&(this.zoomCenter.y=n)},Object.defineProperty(e.prototype,"backgroundItem",{get:function(){return null!==this.currentBackgroundItem?this.currentBackgroundItem:e.DEFAULT_BACKGROUND_ITEM},enumerable:!1,configurable:!0}),e.DEFAULT_BACKGROUND_ITEM={nestingLevel:0,color:a.Color.BLACK},e}();t.Engine=m},753:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.gl=t.initGL=t.adjustSize=void 0,i(457);var n=null;t.gl=n,t.initGL=function(e){function i(e){Page.Demopage.setErrorMessage("webgl-support",e)}var r=Page.Canvas.getCanvas();if(t.gl=n=r.getContext("webgl",e),null==n){if(t.gl=n=r.getContext("experimental-webgl",e),null==n)return i("Your browser or device does not seem to support WebGL."),!1;i("Your browser or device only supports experimental WebGL.\nThe simulation may not run as expected.")}return n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.BLEND),n.clearColor(0,0,0,1),!0},t.adjustSize=function(e){void 0===e&&(e=!1);var t=e?window.devicePixelRatio:1,i=n.canvas,r=Math.floor(i.clientWidth*t),o=Math.floor(i.clientHeight*t);i.width===r&&i.height===o||(i.width=r,i.height=o)}},771:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.GLResource=void 0;var i=function(){function e(e){this._gl=e}return e.prototype.gl=function(){return this._gl},e}();t.GLResource=i},748:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteShader=t.registerShader=t.getShader=t.buildShader=void 0;var a=i(753),s=i(490),c=o(i(71)),l={};function u(e,t){var i=2,n=0;function r(r){function o(t){return t.replace(/#INJECT\((.*)\)/gm,(function(t,i){return e.injected[i]?e.injected[i]:t}))}if(i--,r||n++,0===i){var l=null;if(0===n){var u=c.getSource(e.vertexFilename),h=c.getSource(e.fragmentFilename),d=o(u),f=o(h);l=new s.Shader(a.gl,d,f)}t(l)}}c.loadSource(e.vertexFilename,r),c.loadSource(e.fragmentFilename,r)}t.getShader=function(e){return l[e].shader},t.buildShader=u,t.registerShader=function(e,t,i){function n(e){for(var t=0,i=e.callbacks;t<i.length;t++)(0,i[t])(!e.failed,e.shader);e.callbacks=[]}if(void 0===l[e]){l[e]={callbacks:[i],failed:!1,infos:t,pending:!0,shader:null};var r=l[e];u(t,(function(e){r.pending=!1,r.failed=null===e,r.shader=e,n(r)}))}else{var o=l[e];!0===o.pending?o.callbacks.push(i):n(o)}},t.deleteShader=function(e){void 0!==l[e]&&(null!==l[e].shader&&l[e].shader.freeGLResources(),delete l[e])}},71:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.loadSource=t.getSource=void 0;var i={};t.loadSource=function(e,t){function n(e){for(var t=0,i=e.callbacks;t<i.length;t++)(0,i[t])(!e.failed);e.callbacks=[]}if(void 0===i[e]){i[e]={callbacks:[t],failed:!1,pending:!0,text:null};var r=i[e],o=new XMLHttpRequest;o.open("GET","./shaders/"+e,!0),o.onload=function(){4===o.readyState&&(r.pending=!1,200===o.status?(r.text=o.responseText,r.failed=!1):(console.error("Cannot load '".concat(e,"' shader source: ").concat(o.statusText)),r.failed=!0),n(r))},o.onerror=function(){console.error("Cannot load '".concat(e,"' shader source: ").concat(o.statusText)),r.pending=!1,r.failed=!0,n(r)},o.send(null)}else{var a=i[e];!0===a.pending?a.callbacks.push(t):(a.callbacks=[t],n(a))}},t.getSource=function(e){return i[e].text}},490:function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.Shader=void 0;var o=i(771);function a(){alert("NOT IMPLEMENTED YET")}var s={35664:{str:"FLOAT_VEC2",binder:function(e,t,i){e.uniform2fv(t,i)}},35665:{str:"FLOAT_VEC3",binder:function(e,t,i){e.uniform3fv(t,i)}},35666:{str:"FLOAT_VEC4",binder:function(e,t,i){e.uniform4fv(t,i)}},35667:{str:"INT_VEC2",binder:function(e,t,i){e.uniform2iv(t,i)}},35668:{str:"INT_VEC3",binder:function(e,t,i){e.uniform3iv(t,i)}},35669:{str:"INT_VEC4",binder:function(e,t,i){e.uniform4iv(t,i)}},35670:{str:"BOOL",binder:function(e,t,i){e.uniform1i(t,+i)}},35671:{str:"BOOL_VEC2",binder:function(e,t,i){e.uniform2iv(t,i)}},35672:{str:"BOOL_VEC3",binder:function(e,t,i){e.uniform3iv(t,i)}},35673:{str:"BOOL_VEC4",binder:function(e,t,i){e.uniform4iv(t,i)}},35674:{str:"FLOAT_MAT2",binder:function(e,t,i){e.uniformMatrix2fv(t,!1,i)}},35675:{str:"FLOAT_MAT3",binder:function(e,t,i){e.uniformMatrix3fv(t,!1,i)}},35676:{str:"FLOAT_MAT4",binder:function(e,t,i){e.uniformMatrix4fv(t,!1,i)}},35678:{str:"SAMPLER_2D",binder:function(e,t,i,n){e.uniform1i(t,i),e.activeTexture(e["TEXTURE"+i]),e.bindTexture(e.TEXTURE_2D,n)}},35680:{str:"SAMPLER_CUBE",binder:function(e,t,i,n){e.uniform1i(t,i),e.activeTexture(e["TEXTURE"+i]),e.bindTexture(e.TEXTURE_CUBE_MAP,n)}},5120:{str:"BYTE",binder:a},5121:{str:"UNSIGNED_BYTE",binder:a},5122:{str:"SHORT",binder:a},5123:{str:"UNSIGNED_SHORT",binder:a},5124:{str:"INT",binder:function(e,t,i){Array.isArray(i),e.uniform1iv(t,i)}},5125:{str:"UNSIGNED_INT",binder:a},5126:{str:"FLOAT",binder:function(e,t,i){Array.isArray(i)?e.uniform1fv(t,i):e.uniform1f(t,i)}}},c=function(e){function t(t,i,n){var r=this;function o(e,i){var n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(console.error(t.getShaderInfoLog(n)),t.deleteShader(n),null)}(r=e.call(this,t)||this).id=null,r.uCount=0,r.aCount=0;var a=o(t.VERTEX_SHADER,i),s=o(t.FRAGMENT_SHADER,n),c=t.createProgram();return t.attachShader(c,a),t.attachShader(c,s),t.linkProgram(c),t.getProgramParameter(c,t.LINK_STATUS)?(r.id=c,r.introspection()):(console.error(t.getProgramInfoLog(c)),t.deleteProgram(c)),r}return r(t,e),t.prototype.freeGLResources=function(){e.prototype.gl.call(this).deleteProgram(this.id),this.id=null},t.prototype.use=function(){e.prototype.gl.call(this).useProgram(this.id)},t.prototype.bindUniforms=function(){var t=this,i=e.prototype.gl.call(this),n=0;Object.keys(this.u).forEach((function(e){var r=t.u[e];if(null!==r.value)if(35678===r.type||35680===r.type){var o=n;s[r.type].binder(i,r.loc,o,r.value),n++}else s[r.type].binder(i,r.loc,r.value)}))},t.prototype.bindAttributes=function(){var e=this;Object.keys(this.a).forEach((function(t){var i=e.a[t];null!==i.VBO&&i.VBO.bind(i.loc)}))},t.prototype.bindUniformsAndAttributes=function(){this.bindUniforms(),this.bindAttributes()},t.prototype.introspection=function(){var t=e.prototype.gl.call(this);this.uCount=t.getProgramParameter(this.id,t.ACTIVE_UNIFORMS),this.u={};for(var i=0;i<this.uCount;i++){var n=t.getActiveUniform(this.id,i),r=n.name;this.u[r]={loc:t.getUniformLocation(this.id,r),size:n.size,type:n.type,value:null}}for(this.aCount=t.getProgramParameter(this.id,t.ACTIVE_ATTRIBUTES),this.a={},i=0;i<this.aCount;i++){var o=t.getActiveAttrib(this.id,i),a=o.name;this.a[a]={VBO:null,loc:t.getAttribLocation(this.id,a),size:o.size,type:o.type}}},t}(o.GLResource);t.Shader=c},62:function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.VBO=void 0;var o,a=i(771);!function(e){e[e.DYNAMIC=0]="DYNAMIC",e[e.STATIC=1]="STATIC"}(o||(o={}));var s=function(e){function t(t,i,n,r,a){void 0===a&&(a=!0);var s=e.call(this,t)||this;return s.id=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,s.id),a?t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW):t.bufferData(t.ARRAY_BUFFER,i,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),s.size=n,s.type=r,s.normalize=!1,s.stride=0,s.offset=0,s.usage=a?o.STATIC:o.DYNAMIC,s}return r(t,e),t.createQuad=function(e,i,n,r,o){return new t(e,new Float32Array([i,n,r,n,i,o,r,o]),2,e.FLOAT,!0)},t.prototype.freeGLResources=function(){this.gl().deleteBuffer(this.id),this.id=null},t.prototype.bind=function(t){var i=e.prototype.gl.call(this);i.enableVertexAttribArray(t),i.bindBuffer(i.ARRAY_BUFFER,this.id),i.vertexAttribPointer(t,this.size,this.type,this.normalize,this.stride,this.offset)},t.prototype.setData=function(t){var i=e.prototype.gl.call(this);i.bindBuffer(i.ARRAY_BUFFER,this.id),this.usage===o.STATIC?i.bufferData(i.ARRAY_BUFFER,t,i.STATIC_DRAW):i.bufferData(i.ARRAY_BUFFER,t,i.DYNAMIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,null)},t}(a.GLResource);t.VBO=s},633:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});var a=i(377),s=i(642),c=i(852),l=i(61),u=i(886),h=i(139),d=i(174),f=o(i(8)),g=o(i(440));i(457),l.Parameters.isInCollisionsDebug?(0,s.mainDebugCollisions)():function(){var e=l.Parameters.isWebGLVersion?new h.PlotterCanvasWebGL:new u.PlotterCanvas2D,t=new c.Engine,i=!0;l.Parameters.addRedrawObserver((function(){return i=!0})),l.Parameters.addClearObserver((function(){t.reset(),i=!0})),l.Parameters.addDownloadObserver((function(){var i=new d.PlotterSVG(e.size);t.draw(i);var n=i.export();g.downloadTextFile("packing.svg",n)}));var n=0;f.initialize(),t.reset(),requestAnimationFrame((function r(o){f.timeSpentInMainLoop.start();var s=.001*(o-n);n=o;var c=1e3*l.Parameters.quantity;t.setItemsCount(c),a.ColorPicker.setPalette(l.Parameters.paletteId),f.timeSpentInUpdate.start();var u=t.udpate(s,e.size);if(i=i||u,f.timeSpentInUpdate.stop(),i){f.timeSpentInDraw.start();var h=t.draw(e);f.timeSpentInDraw.stop(),i=!h}f.timeSpentInMainLoop.stop(),f.registerFrame(),requestAnimationFrame(r)}))}()},457:function(){},61:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ECollisionTestType=t.EPrimitive=t.Parameters=void 0,i(457);var a=o(i(440)),s={PRIMITIVE:"primitive-tab-id",RESET:"reset-button-id",SPACING:"spacing-range-id",MIN_SIZE:"min-size-range-id",ALLOW_OVERLAPPING:"allow-overlapping-checkbox-id",QUANTITY:"quantity-range-id",ZOOM_SPEED:"zoom-speed-range-id",BACKGROUND:"background-tab-id",PALETTE:"palette-picker-id",BLENDING:"blending-checkbox-id",HIGH_CONTRAST:"high-contrast-checkbox-id",INDICATORS:"indicators-checkbox-id",MAX_TRIES_PER_FRAME:"max-tries-per-frame-range-id",INSTANCING:"instancing-checkbox-id",ADAPTATIVE_GRID:"adaptative-grid-checkbox-id",TARGET_ITEMS_PER_GRIDCELL:"target-items-per-gridcell-checkbox-id",CELL_SIZE:"cell-size-range-id",ONE_CELL_ONLY:"one-cell-only-checkbox-id",SHOW_GRID:"show-grid-checkbox-id",CELL_X:"cell-x-range-id",CELL_Y:"cell-y-range-id",COLLISION_TEST_TYPE:"collision-test-type-tab-id",DOWNLOAD:"result-download-id"},c=[];function l(){for(var e=0,t=c;e<t.length;e++)(0,t[e])()}Page.Canvas.Observers.canvasResize.push(l),Page.Checkbox.addObserver(s.ALLOW_OVERLAPPING,l),Page.Tabs.addObserver(s.BACKGROUND,l),Page.Checkbox.addObserver(s.HIGH_CONTRAST,l),Page.Checkbox.addObserver(s.ONE_CELL_ONLY,l),Page.Checkbox.addObserver(s.SHOW_GRID,l),Page.Checkbox.addObserver(s.INSTANCING,l),Page.Range.addObserver(s.QUANTITY,l),Page.Range.addObserver(s.CELL_X,l),Page.Range.addObserver(s.CELL_Y,l);var u,h,d=[];function f(){for(var e=0,t=d;e<t.length;e++)(0,t[e])()}function g(){b.isZooming||f()}Page.Button.addObserver(s.RESET,f),Page.Tabs.addObserver(s.PRIMITIVE,f),Page.Range.addObserver(s.SPACING,g),Page.Range.addObserver(s.MIN_SIZE,g),Page.Picker.addObserver(s.PALETTE,g),Page.Checkbox.addObserver(s.ALLOW_OVERLAPPING,g),function(e){e.SQUARE="square",e.CIRCLE="circle",e.RECTANGLE="rectangle",e.TRIANGLE="triangle",e.HEART="heart"}(u||(u={})),t.EPrimitive=u,function(e){e.PRIMITIVE="primitive",e.POINT="point",e.VISIBILITY="visbility"}(h||(h={})),t.ECollisionTestType=h;var p="1"===a.getQueryStringValue("debug"),P="1"===a.getQueryStringValue("debug-collisions");Page.Sections.setVisibility("display-section",!P),Page.Sections.setVisibility("debug-section",p&&!P),Page.Sections.setVisibility("debug-collisions-section",p&&P),Page.Canvas.setIndicatorVisibility("main-loop-time",p),Page.Canvas.setIndicatorVisibility("draw-time",p),Page.Canvas.setIndicatorVisibility("draw-allocatebuffer-time",p),Page.Canvas.setIndicatorVisibility("draw-fillbuffer-time",p),Page.Canvas.setIndicatorVisibility("draw-uploadvbo-time",p),Page.Canvas.setIndicatorVisibility("draw-drawX-time",p),Page.Canvas.setIndicatorVisibility("update-time",p),Page.Canvas.setIndicatorVisibility("update-reindex-time",p),Page.Canvas.setIndicatorVisibility("update-reindex-resetdomain-time",p),Page.Canvas.setIndicatorVisibility("update-reindex-reindexitems-time",p),Page.Canvas.setIndicatorVisibility("update-recycle-time",p),Page.Canvas.setIndicatorVisibility("update-zoom-time",p),Page.Canvas.setIndicatorVisibility("items-reclycled-count",p),Page.Canvas.setIndicatorVisibility("items-pending-recycling-count",p),Page.Canvas.setIndicatorVisibility("items-recycling-tries-count",p),Page.Canvas.setIndicatorVisibility("grid-size",p),Page.Canvas.setIndicatorVisibility("grid-cell-size",p),Page.Canvas.setIndicatorVisibility("grid-items-per-cell",p),p?Page.Checkbox.setChecked(s.INDICATORS,!0):(Page.Checkbox.setChecked(s.ONE_CELL_ONLY,!1),Page.Checkbox.setChecked(s.SHOW_GRID,!1));var v="0"!==a.getQueryStringValue("webgl");function m(){var e=!P&&Page.Checkbox.isChecked(s.INDICATORS);Page.Canvas.setIndicatorsVisibility(e)}function y(){var e=Page.Checkbox.isChecked(s.ADAPTATIVE_GRID);Page.Controls.setVisibility(s.TARGET_ITEMS_PER_GRIDCELL,e),Page.Controls.setVisibility(s.CELL_SIZE,!e)}v||(Page.Checkbox.setChecked(s.BLENDING,!1),Page.Controls.setVisibility(s.BLENDING,!1),Page.Controls.setVisibility(s.INSTANCING,!1)),Page.Checkbox.addObserver(s.INDICATORS,m),m(),Page.Checkbox.addObserver(s.ADAPTATIVE_GRID,y),y(),Page.Button.addObserver("debug-collisions-button-id",(function(){window.location.href=window.location.href+"&debug-collisions=1"}));var b=function(){function e(){}return Object.defineProperty(e,"quantity",{get:function(){return Page.Range.getValue(s.QUANTITY)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"spacing",{get:function(){return Page.Range.getValue(s.SPACING)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"minSize",{get:function(){return Page.Range.getValue(s.MIN_SIZE)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"allowOverlapping",{get:function(){return Page.Checkbox.isChecked(s.ALLOW_OVERLAPPING)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"primitive",{get:function(){return Page.Tabs.getValues(s.PRIMITIVE)[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"zoomSpeed",{get:function(){return Page.Range.getValue(s.ZOOM_SPEED)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"isZooming",{get:function(){return Math.abs(e.zoomSpeed)>.001},enumerable:!1,configurable:!0}),Object.defineProperty(e,"blackBackground",{get:function(){return"dark"===Page.Tabs.getValues(s.BACKGROUND)[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"blending",{get:function(){return Page.Checkbox.isChecked(s.BLENDING)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"paletteId",{get:function(){return+Page.Picker.getValue(s.PALETTE)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"highContrast",{get:function(){return Page.Checkbox.isChecked(s.HIGH_CONTRAST)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"isInDebug",{get:function(){return p},enumerable:!1,configurable:!0}),Object.defineProperty(e,"isInCollisionsDebug",{get:function(){return P},enumerable:!1,configurable:!0}),Object.defineProperty(e,"isWebGLVersion",{get:function(){return v},enumerable:!1,configurable:!0}),Object.defineProperty(e,"maxTriesPerFrame",{get:function(){return 100*Page.Range.getValue(s.MAX_TRIES_PER_FRAME)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"adaptativeGrid",{get:function(){return Page.Checkbox.isChecked(s.ADAPTATIVE_GRID)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"targetItemsPerGridCell",{get:function(){return Page.Range.getValue(s.TARGET_ITEMS_PER_GRIDCELL)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"cellSize",{get:function(){return Page.Range.getValue(s.CELL_SIZE)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"oneCellOnly",{get:function(){return Page.Checkbox.isChecked(s.ONE_CELL_ONLY)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"showGrid",{get:function(){return Page.Checkbox.isChecked(s.SHOW_GRID)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"cellX",{get:function(){return Page.Range.getValue(s.CELL_X)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"cellY",{get:function(){return Page.Range.getValue(s.CELL_Y)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"useInstancing",{get:function(){return Page.Checkbox.isChecked(s.INSTANCING)},enumerable:!1,configurable:!0}),e.disallowInstancing=function(){Page.Checkbox.setChecked(s.INSTANCING,!1),Page.Controls.setVisibility(s.INSTANCING,!1)},Object.defineProperty(e,"currentCollisionType",{get:function(){return Page.Tabs.getValues(s.COLLISION_TEST_TYPE)[0]},enumerable:!1,configurable:!0}),e.addRedrawObserver=function(e){c.push(e)},e.addClearObserver=function(e){d.push(e)},e.addDownloadObserver=function(e){Page.FileControl.addDownloadObserver(s.DOWNLOAD,e)},e}();t.Parameters=b},166:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.EVisibility=t.PatternBase=void 0;var n,r=i(697),o=i(377),a=i(61),s={x:0,y:0},c=1;!function(e){e[e.VISIBLE=0]="VISIBLE",e[e.OUT_OF_VIEW=1]="OUT_OF_VIEW",e[e.COVERS_VIEW=2]="COVERS_VIEW"}(n||(n={})),t.EVisibility=n;var l=function(){function e(){this.center={x:0,y:0},this.size=0,this.nestingLevel=0,this.rawColor=r.Color.random(),this.lastTestId=0}return Object.defineProperty(e,"maxBlendingTime",{get:function(){return a.Parameters.blending?500/(1+a.Parameters.zoomSpeed):0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return o.ColorPicker.getDisplayColor(this.rawColor,this.nestingLevel)},enumerable:!1,configurable:!0}),e.prototype.zoomIn=function(e,t){this.center.x=(this.center.x-e.x)*t+e.x,this.center.y=(this.center.y-e.y)*t+e.y,this.size*=t},e.prototype.reset=function(e,t,i,n,r,a,s){for(var c={nbTries:0,success:!1};c.nbTries<s&&!c.success;){this.randomizePosition(e),this.parentItem=null;var l=i*this.computeBiggestSizePossible(t,n.from,r);if(n.isInRange(l)){this.size=2*Math.floor(.5*l),this.initializationTime=performance.now(),c.success=!0;var u=null!==this.parentItem?this.parentItem.nestingLevel:a.nestingLevel;if(this.nestingLevel=u+1,o.ColorPicker.usePalette){var h=null!==this.parentItem?this.parentItem.rawColor:a.color;this.rawColor=o.ColorPicker.getDifferentColorFromPalette(h)}}c.nbTries++}return c},e.prototype.computeOpacity=function(t,i){if(this.size>e.MAX_SIZE_LOWER){var n=(this.size-e.MAX_SIZE_LOWER)/e.MAX_SIZE_GAP;return n>1?0:1-n}var r=t-this.initializationTime;return r>i?1:r/i},e.prototype.computeBiggestSizePossible=function(e,t,i){var n=c=(c+1)%999999999999,r=this.computeBiggestSizePossibleToAvoidPoint(s),o=e.getDistanceToClosestBorder(this.center),a=e.getCellId(this.center),l=e.getItemsFromCell(a.x,a.y),u=this.computeBiggestSizePossibleToAvoidItems(l,t,i,n);if((r=Math.min(r,u))>=o){var h={x:this.center.x-.5*r,y:this.center.y-.5*r},d={x:this.center.x+.5*r,y:this.center.y+.5*r},f=e.getCellId(h),g=e.getCellId(d),p=e.getItemsFromCellsGroup(f.x,f.y,g.x,g.y),P=this.computeBiggestSizePossibleToAvoidItems(p,t,i,n);r=Math.min(r,P)}return r},e.prototype.computeBiggestSizePossibleToAvoidItems=function(e,t,i,n){for(var r=1e5,o=0,a=e;o<a.length;o++){var s=a[o];if(s!==this&&s.lastTestId!==n){if(r>t){var c=this.computeBiggestSizePossibleToAvoidItem(s,i);c.size<t||!i&&c.isInside?r=0:c.size<r&&(r=c.size,c.isInside&&(this.parentItem=s))}s.lastTestId=n}}return r},e.prototype.randomizePosition=function(e){this.center.x=Math.round(e.width*(Math.random()-.5)),this.center.y=Math.round(e.height*(Math.random()-.5))},e.MAX_SIZE=1e6,e.MAX_SIZE_LOWER=.75*e.MAX_SIZE,e.MAX_SIZE_GAP=e.MAX_SIZE-e.MAX_SIZE_LOWER,e}();t.PatternBase=l},941:function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.PatternCircle=void 0;var o=i(166),a=function(e){function t(){return e.call(this)||this}return r(t,e),t.prototype.computeBiggestSizePossibleToAvoidPoint=function(e){var t=e.x-this.center.x,i=e.y-this.center.y;return 2*Math.sqrt(t*t+i*i)},t.prototype.computeBiggestSizePossibleToAvoidItem=function(e,t){var i={size:0,isInside:!1},n=this.center.x-e.center.x,r=this.center.y-e.center.y,o=Math.sqrt(n*n+r*r);return o<=e.radius?(i.isInside=!0,t&&(i.size=2*(e.radius-o))):i.size=2*(o-e.radius),i},t.prototype.computeVisibility=function(e){var t=.5*e.width,i=.5*e.height,n=Math.abs(this.center.x),r=Math.abs(this.center.y),a=n+t,s=r+i,c=this.radius;return c*c>a*a+s*s?o.EVisibility.COVERS_VIEW:n-c<t&&r-c<i?o.EVisibility.VISIBLE:o.EVisibility.OUT_OF_VIEW},Object.defineProperty(t.prototype,"radius",{get:function(){return.5*this.size},enumerable:!1,configurable:!0}),t}(o.PatternBase);t.PatternCircle=a},822:function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.PatternHeart=void 0;var o=i(587),a=i(166),s=1/Math.sqrt(2),c=function(e){function t(){return e.call(this)||this}return r(t,e),t.prototype.computeBiggestSizePossibleToAvoidPoint=function(e){var i=Math.abs(e.x-this.center.x),n=e.y-this.center.y,r=Math.sqrt(i*i+n*n);return r/(n>=0?r*t.a/(i+n+1e-8):t.a*(i-n)/(r+1e-8))},t.prototype.computeBiggestSizePossibleToAvoidItem=function(e,i){var n=this,r={size:0,isInside:e.isPointInside(this.center)};if(r.isInside&&!i)return r;var a=Math.abs(this.center.x-e.center.x),c=this.center.y-e.center.y,l=s*(a-c),u=s*(c+a),h=.5*e.size*t.b;if(l>=-h&&l<=h){if(u>=h)r.size=(u-h)/t.b;else if(u>=0)Math.abs(l)<=u&&(r.size=2*(h-u)/t.b);else if(u<=0&&l<=h){var d={x:e.center.x,y:e.center.y-e.size*t.a};r.size=this.computeBiggestSizePossibleToAvoidPoint(d)}}else if(l<=-h){var f={x:e.center.x,y:e.center.y+e.size*t.a};r.size=this.computeBiggestSizePossibleToAvoidPoint(f)}if(r.size>0)return r;var g=.5*e.size*t.a,p=this.center.x>=e.center.x?e.center.x+g:e.center.x-g,P=e.center.y-g,v=e.size*t.c;r.size=9e11;for(var m=function(e,t){e=Math.max(4,Math.round(e));for(var i=t.span,o=i/(e-1),a=(t.from+t.to)/2,s=0;s<e;s++){var c=t.from+o*s,l={x:p+v*Math.cos(c),y:P-v*Math.sin(c)},u=n.computeBiggestSizePossibleToAvoidPoint(l);r.size>u&&(r.size=u,a=c)}i<0&&console.log(i),t.from=t.clamp(a-o),t.to=t.clamp(a+o)},y=this.center.x>=e.center.x?new o.NumberRange(-Math.PI/4,3*Math.PI/4):new o.NumberRange(Math.PI/4,5*Math.PI/4),b=new o.NumberRange(y.from,y.to),_=0;_<11;_++)m(6,b);return r},t.prototype.computeVisibility=function(e){var t=.5*e.width,i=.5*e.height,n=this.isPointInside({x:-t,y:-i}),r=this.isPointInside({x:+t,y:-i}),o=this.isPointInside({x:+t,y:+i}),s=this.isPointInside({x:-t,y:+i});return n&&r&&o&&s&&this.isPointInside({x:this.center.x,y:-i})?a.EVisibility.COVERS_VIEW:n||r||o||s||Math.abs(this.center.x)-.5*this.size<t&&Math.abs(this.center.y)-.5*this.size<i?a.EVisibility.VISIBLE:a.EVisibility.OUT_OF_VIEW},t.prototype.isPointInside=function(e){return this.computeBiggestSizePossibleToAvoidPoint(e)<=this.size},t.a=.41421356237,t.b=.585786437625,t.c=.29289321881,t}(a.PatternBase);t.PatternHeart=c},330:function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.PatternRectangle=void 0;var o=i(166),a=.5,s=function(e){function t(){var t=e.call(this)||this;return t.aspectRatio=1+a*(2*Math.random()-1),t.aspectRatio>=1?(t.baseWidth=1,t.baseHeight=1/t.aspectRatio):(t.baseWidth=t.aspectRatio,t.baseHeight=1),t}return r(t,e),t.prototype.computeBiggestSizePossibleToAvoidPoint=function(e){var t=e.x-this.center.x,i=e.y-this.center.y,n=Math.abs(t)/this.baseWidth,r=Math.abs(i)/this.baseHeight;return 2*Math.max(n,r)},t.prototype.computeBiggestSizePossibleToAvoidItem=function(e,t){var i={size:0,isInside:!1},n=Math.abs(this.center.x-e.center.x),r=Math.abs(this.center.y-e.center.y),o=.5*e.width,a=.5*e.height;return n<o?r<a?(i.isInside=!0,t&&(i.size=2*Math.min((o-n)/this.baseWidth,(a-r)/this.baseHeight))):i.size=2*(r-a)/this.baseHeight:i.size=r<a?2*(n-o)/this.baseWidth:2*Math.max((n-o)/this.baseWidth,(r-a)/this.baseHeight),i},t.prototype.computeVisibility=function(e){var t=.5*e.width,i=.5*e.height,n=Math.abs(this.center.x),r=Math.abs(this.center.y),a=.5*this.size*this.baseWidth,s=.5*this.size*this.baseHeight;return n+t<a&&r+i<s?o.EVisibility.COVERS_VIEW:n-a<t&&r-s<i?o.EVisibility.VISIBLE:o.EVisibility.OUT_OF_VIEW},Object.defineProperty(t.prototype,"width",{get:function(){return this.size*this.baseWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.size*this.baseHeight},enumerable:!1,configurable:!0}),t}(o.PatternBase);t.PatternRectangle=s},106:function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.PatternSquare=void 0;var o=i(166),a=function(e){function t(){return e.call(this)||this}return r(t,e),t.prototype.computeBiggestSizePossibleToAvoidPoint=function(e){var t=e.x-this.center.x,i=e.y-this.center.y,n=Math.abs(t),r=Math.abs(i);return 2*Math.max(n,r)},t.prototype.computeBiggestSizePossibleToAvoidItem=function(e,t){var i={size:0,isInside:!1},n=Math.abs(this.center.x-e.center.x),r=Math.abs(this.center.y-e.center.y),o=.5*e.sideLength;return n<o?r<o?(i.isInside=!0,t&&(i.size=2*Math.min(o-n,o-r))):i.size=2*(r-o):i.size=r<o?2*(n-o):2*Math.max(n-o,r-o),i},t.prototype.computeVisibility=function(e){var t=.5*e.width,i=.5*e.height,n=Math.abs(this.center.x),r=Math.abs(this.center.y),a=.5*this.size;return n+t<a&&r+i<a?o.EVisibility.COVERS_VIEW:n-a<t&&r-a<i?o.EVisibility.VISIBLE:o.EVisibility.OUT_OF_VIEW},Object.defineProperty(t.prototype,"sideLength",{get:function(){return this.size},enumerable:!1,configurable:!0}),t}(o.PatternBase);t.PatternSquare=a},523:function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.PatternTriangle=void 0;var o=i(166);function a(e,t,i){return{x:e.x*t-e.y*i,y:e.x*i+e.y*t}}function s(e,t,i){var n=i.y*t.x-t.y*i.x;if(0!==n){var r=1/n,o=(i.x*e.y-i.y*e.x)*r;if(0<=o&&o<=1)return(t.x*e.y-t.y*e.x)*r}return-1}var c=1e8;function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var i=c,n=0,r=e;n<r.length;n++){var o=r[n];o>=0&&o<i&&(i=o)}return i===c?-1:i}var u=function(e){function t(){var i=e.call(this)||this;i.angle=2*Math.PI*Math.random();var n=Math.cos(i.angle),r=Math.sin(i.angle);return i.P1=a(t.baseP1,n,r),i.P2=a(t.baseP2,n,r),i.P3=a(t.baseP3,n,r),i.P1_TO_P2={x:i.P2.x-i.P1.x,y:i.P2.y-i.P1.y},i.P2_TO_P3={x:i.P3.x-i.P2.x,y:i.P3.y-i.P2.y},i.P3_TO_P1={x:i.P1.x-i.P3.x,y:i.P1.y-i.P3.y},i}return r(t,e),t.prototype.computeBiggestSizePossibleToAvoidPoint=function(e){if(e.x===this.center.x&&e.y===this.center.y)return 0;var t={x:e.x-this.center.x,y:e.y-this.center.y},i=s(this.P1,this.P1_TO_P2,t);return i<0&&(i=s(this.P2,this.P2_TO_P3,t))<0&&(i=s(this.P3,this.P3_TO_P1,t)),i>0?1/i:0},t.prototype.computeBiggestSizePossibleToAvoidItem=function(e,t){var i={size:0,isInside:e.isPointInside(this.center.x,this.center.y)};if(i.isInside&&!t)return i;var n,r,o={x:e.center.x+e.P1.x*e.size-this.center.x,y:e.center.y+e.P1.y*e.size-this.center.y},a={x:e.center.x+e.P2.x*e.size-this.center.x,y:e.center.y+e.P2.y*e.size-this.center.y},c={x:e.center.x+e.P3.x*e.size-this.center.x,y:e.center.y+e.P3.y*e.size-this.center.y},u={x:e.P1_TO_P2.x*e.size,y:e.P1_TO_P2.y*e.size},h={x:e.P2_TO_P3.x*e.size,y:e.P2_TO_P3.y*e.size},d={x:e.P3_TO_P1.x*e.size,y:e.P3_TO_P1.y*e.size};n=l(s(o,u,this.P1),s(a,h,this.P1),s(c,d,this.P1),s(o,u,this.P2),s(a,h,this.P2),s(c,d,this.P2),s(o,u,this.P3),s(a,h,this.P3),s(c,d,this.P3));var f=s(this.P1,this.P1_TO_P2,o),g=s(this.P2,this.P2_TO_P3,o),p=s(this.P3,this.P3_TO_P1,o),P=s(this.P1,this.P1_TO_P2,a),v=s(this.P2,this.P2_TO_P3,a),m=s(this.P3,this.P3_TO_P1,a),y=s(this.P1,this.P1_TO_P2,c),b=s(this.P2,this.P2_TO_P3,c),_=s(this.P3,this.P3_TO_P1,c),I=Math.max(f,g,p,P,v,m,y,b,_);return r=0!==I?1/I:-1,i.size=l(n,r),i},t.prototype.computeVisibility=function(e){var t=.5*e.width,i=.5*e.height,n=Math.abs(this.center.x),r=Math.abs(this.center.y),a=.5*this.size;return this.isPointInside(-t,-i)&&this.isPointInside(t,-i)&&this.isPointInside(-t,i)&&this.isPointInside(t,i)?o.EVisibility.COVERS_VIEW:n-a<t&&r-a<i?o.EVisibility.VISIBLE:o.EVisibility.OUT_OF_VIEW},t.prototype.isPointInside=function(e,t){e=(e-this.center.x)/this.size,t=(t-this.center.y)/this.size;var i=this.P1_TO_P2.x*(t-this.P2.y)-(e-this.P2.x)*this.P1_TO_P2.y,n=this.P2_TO_P3.x*(t-this.P3.y)-(e-this.P3.x)*this.P2_TO_P3.y,r=this.P3_TO_P1.x*(t-this.P1.y)-(e-this.P1.x)*this.P3_TO_P1.y;return i<=0&&n<=0&&r<=0||i>0&&n>0&&r>0},t.baseP1={x:0,y:-.5},t.baseP2={x:.5*Math.cos(7*Math.PI/6),y:-.5*Math.sin(7*Math.PI/6)},t.baseP3={x:-.5*Math.cos(7*Math.PI/6),y:-.5*Math.sin(7*Math.PI/6)},t}(o.PatternBase);t.PatternTriangle=u},792:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PlotterBase=void 0;t.PlotterBase=function(){}},886:function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.PlotterCanvas2D=void 0;var o=i(822),a=i(643);i(457);var s=2*Math.PI,c=function(e){function t(){var t=e.call(this)||this;return t.context=t.canvas.getContext("2d",{alpha:!1}),t}return r(t,e),Object.defineProperty(t.prototype,"isReady",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype.clearCanvas=function(e){this.context.fillStyle=e.toString(),this.context.fillRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.finalize=function(){},t.prototype.drawSquares=function(e){for(var t=.5*this._size.width,i=.5*this._size.height,n=0,r=e;n<r.length;n++){var o=r[n],a=o.center.x+t,s=o.center.y+i,c=.5*o.size;this.context.fillStyle=o.color.toString(),this.context.fillRect(a-c,s-c,o.size,o.size)}},t.prototype.drawCircles=function(e){for(var t=.5*this._size.width,i=.5*this._size.height,n=0,r=e;n<r.length;n++){var o=r[n],a=o.center.x+t,c=o.center.y+i;this.context.fillStyle=o.color.toString(),this.context.beginPath(),this.context.arc(a,c,o.radius,0,s),this.context.fill(),this.context.closePath()}},t.prototype.drawRectangles=function(e){for(var t=.5*this._size.width,i=.5*this._size.height,n=0,r=e;n<r.length;n++){var o=r[n],a=o.center.x+t,s=o.center.y+i;this.context.fillStyle=o.color.toString(),this.context.fillRect(a-.5*o.width,s-.5*o.height,o.width,o.height)}},t.prototype.drawTriangles=function(e){for(var t=.5*this._size.width,i=.5*this._size.height,n=0,r=e;n<r.length;n++){var o=r[n],a=o.center.x+t,s=o.center.y+i;this.context.fillStyle=o.color.toString(),this.context.beginPath(),this.context.moveTo(a+o.P1.x*o.size,s+o.P1.y*o.size),this.context.lineTo(a+o.P2.x*o.size,s+o.P2.y*o.size),this.context.lineTo(a+o.P3.x*o.size,s+o.P3.y*o.size),this.context.fill(),this.context.closePath()}},t.prototype.drawHearts=function(e){for(var t=.5*this._size.width,i=.5*this._size.height,n=0,r=e;n<r.length;n++){var a=r[n],s=a.center.x+t,c=a.center.y+i,l=a.size*o.PatternHeart.a,u=a.size*o.PatternHeart.c;this.context.fillStyle=a.color.toString(),this.context.beginPath(),this.context.moveTo(s+l,c),this.context.lineTo(s,c+l),this.context.lineTo(s-l,c),this.context.arc(s-.5*l,c-.5*l,u,3/4*Math.PI,-1/4*Math.PI),this.context.arc(s+.5*l,c-.5*l,u,5/4*Math.PI,1/4*Math.PI),this.context.fill(),this.context.closePath()}},t.prototype.drawLines=function(e,t){this.context.fillStyle="none",this.context.strokeStyle=t.toString(),this.context.lineWidth=1,this.context.beginPath();for(var i=.5*this._size.width,n=.5*this._size.height,r=0,o=e;r<o.length;r++){var a=o[r];this.context.moveTo(a.from.x+i,a.from.y+n),this.context.lineTo(a.to.x+i,a.to.y+n)}this.context.stroke(),this.context.closePath(),this.context.strokeStyle="none"},t}(a.PlotterCanvasBase);t.PlotterCanvas2D=c},643:function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.PlotterCanvasBase=void 0;var o=i(792);i(457);var a=function(e){function t(){var t,i=this;return(i=e.call(this)||this).canvas=Page.Canvas.getCanvas(),i.cssPixel=null!==(t=window.devicePixelRatio)&&void 0!==t?t:1,i.resizeCanvas(),i}return r(t,e),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){this.resizeCanvas(),this.clearCanvas(e)},t.prototype.resizeCanvas=function(){var e=Math.floor(this.cssPixel*this.canvas.clientWidth),t=Math.floor(this.cssPixel*this.canvas.clientHeight);this.canvas.width===e&&this.canvas.height===t||(this.canvas.width=e,this.canvas.height=t),this._size={width:this.canvas.width,height:this.canvas.height}},t}(o.PlotterBase);t.PlotterCanvasBase=a},139:function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),o=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&o(t,e,i);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.PlotterCanvasWebGL=void 0;var c=i(753),l=s(i(748)),u=i(62),h=i(61),d=i(166),f=i(523),g=s(i(8)),p=i(643);i(457);var P=[-.5,.5,-.5,-.5,.5,.5,.5,-.5],v=[f.PatternTriangle.baseP1.x,f.PatternTriangle.baseP1.y,f.PatternTriangle.baseP2.x,f.PatternTriangle.baseP2.y,f.PatternTriangle.baseP3.x,f.PatternTriangle.baseP3.y],m=function(e){function t(){var t=e.call(this)||this;if(!(0,c.initGL)())throw new Error("Failed to initialize WebGL.");console.log('Max point size supported by WebGL: "'.concat(c.gl.ALIASED_POINT_SIZE_RANGE,'" pixels.')),t.needToResetInstancingDivision=!1;var i="ANGLE_instanced_arrays";if(t.instancingExt=c.gl.getExtension(i),null===t.instancingExt){var n='Your device does not support the "'.concat(i,'" WebGL extension. Using the fallback mode with GL_POINTS, which might cause visual artifacts.');Page.Demopage.setErrorMessage("webgl-instanced",n),console.log(n),h.Parameters.disallowInstancing()}else console.log('Using the "'.concat(i,'" WebGL extension.'));t.blending=!1,t.enableBlending=!0,t.linesBuffer=new Float32Array([]),t.linesVBO=new u.VBO(c.gl,new Float32Array(t.linesBuffer),2,c.gl.FLOAT,!1),t.primitivesBuffer=new Float32Array([]),t.primitivesVBOId=c.gl.createBuffer();var r=P.concat(v);return t.geometryVBO=new u.VBO(c.gl,new Float32Array(r),2,c.gl.FLOAT,!0),t.linesShader=null,t.squaresShader=null,t.circlesShader=null,t.rectanglesShader=null,t.trianglesShader=null,t.heartsShader=null,t.loadAndBuildShader("point/lines.vert","point/lines.frag","lines",(function(e){return t.linesShader=e})),t.loadAndBuildShader("point/items.vert","point/squares.frag","squares",(function(e){return t.squaresShader=e})),t.loadAndBuildShader("point/items.vert","point/circles.frag","circles",(function(e){return t.circlesShader=e})),t.loadAndBuildShader("point/rectangles.vert","point/rectangles.frag","rectangles",(function(e){return t.rectanglesShader=e})),t.loadAndBuildShader("point/triangles.vert","point/triangles.frag","triangles",(function(e){return t.trianglesShader=e})),t.loadAndBuildShader("point/items.vert","point/hearts.frag","hearts",(function(e){return t.heartsShader=e})),t.squaresInstancedShader=null,t.circlesInstancedShader=null,t.rectanglesInstancedShader=null,t.trianglesInstancedShader=null,t.heartsInstancedShader=null,t.supportsInstancing&&(t.loadAndBuildShader("instanced/simpleGeometry.vert","instanced/fillColor.frag","instanced squares",(function(e){return t.squaresInstancedShader=e})),t.loadAndBuildShader("instanced/squareToDiscard.vert","instanced/circles.frag","instanced squares",(function(e){return t.circlesInstancedShader=e})),t.loadAndBuildShader("instanced/rectangles.vert","instanced/fillColor.frag","instanced circles",(function(e){return t.rectanglesInstancedShader=e})),t.loadAndBuildShader("instanced/triangles.vert","instanced/fillColor.frag","instanced triangles",(function(e){return t.trianglesInstancedShader=e})),t.loadAndBuildShader("instanced/squareToDiscard.vert","instanced/hearts.frag","instanced hearts",(function(e){return t.heartsInstancedShader=e}))),t}return r(t,e),Object.defineProperty(t.prototype,"isReady",{get:function(){return null!==this.linesShader&&null!==this.squaresShader&&null!==this.circlesShader&&null!==this.rectanglesShader&&null!==this.trianglesShader&&null!==this.squaresInstancedShader&&null!==this.circlesInstancedShader&&null!==this.rectanglesInstancedShader&&null!==this.trianglesInstancedShader},enumerable:!1,configurable:!0}),t.prototype.clearCanvas=function(e){c.gl.clearColor(e.r/255,e.g/255,e.b/255,1),c.gl.clear(c.gl.COLOR_BUFFER_BIT)},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),c.gl.viewport(0,0,this._size.width,this._size.height)},t.prototype.finalize=function(){},t.prototype.drawSquares=function(e){this.drawPrimitives(this.squaresShader,this.squaresInstancedShader,e,h.EPrimitive.SQUARE)},t.prototype.drawCircles=function(e){this.drawPrimitives(this.circlesShader,this.circlesInstancedShader,e,h.EPrimitive.CIRCLE)},t.prototype.drawRectangles=function(e){this.drawPrimitives(this.rectanglesShader,this.rectanglesInstancedShader,e,h.EPrimitive.RECTANGLE,(function(e){return e.aspectRatio}))},t.prototype.drawTriangles=function(e){this.drawPrimitives(this.trianglesShader,this.trianglesInstancedShader,e,h.EPrimitive.TRIANGLE,(function(e){return e.angle}))},t.prototype.drawHearts=function(e){this.drawPrimitives(this.heartsShader,this.heartsInstancedShader,e,h.EPrimitive.HEART)},t.prototype.drawLines=function(e,t){var i=e.length;if(null!==this.linesShader&&i>=1){var n=4*i;this.linesBuffer.length!==n&&(this.linesBuffer=new Float32Array(n));for(var r=0;r<i;r++)this.linesBuffer[4*r+0]=e[r].from.x,this.linesBuffer[4*r+1]=e[r].from.y,this.linesBuffer[4*r+2]=e[r].to.x,this.linesBuffer[4*r+3]=e[r].to.y;this.linesVBO.setData(new Float32Array(this.linesBuffer)),this.linesShader.a.aCoords.VBO=this.linesVBO,this.linesShader.u.uScreenSize.value=[this._size.width,this._size.height],this.linesShader.u.uColor.value=[t.r/255,t.g/255,t.b/255,1],this.linesShader.use(),this.linesShader.bindUniformsAndAttributes(),c.gl.drawArrays(c.gl.LINES,0,2*i)}},t.prototype.drawPrimitives=function(e,t,i,n,r){this.updatePrimitivesVBO(i,r),g.timeSpentInDrawDrawX.start(),this.useInstancing&&null!==t?this.drawInstanced(t,i,n):this.drawAsPoints(e,i),g.timeSpentInDrawDrawX.stop()},t.prototype.drawInstanced=function(e,t,i){var n=t.length;this.supportsInstancing&&null!==e&&n>0&&(e.use(),this.bindCommonUniformsAndAttributes(e,!0),this.geometryVBO.bind(e.a.aVertex.loc),i===h.EPrimitive.TRIANGLE?this.instancingExt.drawArraysInstancedANGLE(c.gl.TRIANGLES,4,3,n):this.instancingExt.drawArraysInstancedANGLE(c.gl.TRIANGLE_STRIP,0,4,n))},t.prototype.drawAsPoints=function(e,t){var i=t.length;null!==e&&i>0&&(e.use(),this.bindCommonUniformsAndAttributes(e,!1),c.gl.drawArrays(c.gl.POINTS,0,i))},t.prototype.updatePrimitivesVBO=function(e,t){var i=e.length;g.timeSpentInDrawAllocateBuffer.start();var n=1024*Math.ceil(i/1024)*8;this.primitivesBuffer.length!==n&&(this.primitivesBuffer=new Float32Array(n)),g.timeSpentInDrawAllocateBuffer.stop(),this.enableBlending=h.Parameters.blending;var r=performance.now(),o=d.PatternBase.maxBlendingTime;"function"!=typeof t&&(t=function(){return 0}),g.timeSpentInDrawFillBuffer.start();for(var a=0;a<i;a++){var s=e[a].color;this.primitivesBuffer[8*a+0]=e[a].center.x,this.primitivesBuffer[8*a+1]=e[a].center.y,this.primitivesBuffer[8*a+2]=e[a].size,this.primitivesBuffer[8*a+3]=t(e[a]),this.primitivesBuffer[8*a+4]=s.r/255,this.primitivesBuffer[8*a+5]=s.g/255,this.primitivesBuffer[8*a+6]=s.b/255,this.primitivesBuffer[8*a+7]=e[a].computeOpacity(r,o)}g.timeSpentInDrawFillBuffer.stop(),g.timeSpentInDrawUploadVBO.start(),c.gl.bindBuffer(c.gl.ARRAY_BUFFER,this.primitivesVBOId),c.gl.bufferData(c.gl.ARRAY_BUFFER,this.primitivesBuffer,c.gl.DYNAMIC_DRAW),g.timeSpentInDrawUploadVBO.stop()},t.prototype.bindCommonUniformsAndAttributes=function(e,t){e.u.uScreenSize.value=[this._size.width,this._size.height],e.bindUniforms();var i=e.a.aState.loc,n=e.a.aColor.loc;c.gl.bindBuffer(c.gl.ARRAY_BUFFER,this.primitivesVBOId),c.gl.enableVertexAttribArray(i),c.gl.vertexAttribPointer(i,4,c.gl.FLOAT,!1,32,0),t?this.instancingExt.vertexAttribDivisorANGLE(i,1):this.needToResetInstancingDivision&&this.instancingExt.vertexAttribDivisorANGLE(i,0),c.gl.enableVertexAttribArray(n),c.gl.vertexAttribPointer(n,4,c.gl.FLOAT,!1,32,16),t?this.instancingExt.vertexAttribDivisorANGLE(n,1):this.needToResetInstancingDivision&&this.instancingExt.vertexAttribDivisorANGLE(n,0),this.needToResetInstancingDivision=t},Object.defineProperty(t.prototype,"enableBlending",{set:function(e){e!==this.blending&&(this.blending=e,e?(c.gl.enable(c.gl.BLEND),c.gl.blendFunc(c.gl.SRC_ALPHA,c.gl.ONE_MINUS_SRC_ALPHA)):c.gl.disable(c.gl.BLEND))},enumerable:!1,configurable:!0}),t.prototype.loadAndBuildShader=function(e,t,i,n){l.buildShader({vertexFilename:e,fragmentFilename:t,injected:{}},(function(e){if(null===e){var t="Failed to load or build the ".concat(i," shader.");throw Page.Demopage.setErrorMessage("shader-".concat(i),t),new Error(t)}n(e)}))},Object.defineProperty(t.prototype,"supportsInstancing",{get:function(){return null!==this.instancingExt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useInstancing",{get:function(){return this.supportsInstancing&&h.Parameters.useInstancing},enumerable:!1,configurable:!0}),t}(p.PlotterCanvasBase);t.PlotterCanvasWebGL=m},174:function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.PlotterSVG=void 0;var o=i(822),a=function(e){function t(t){var i=e.call(this)||this;return i._size={width:t.width,height:t.height},i}return r(t,e),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isReady",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){this.stringParts=[],this.stringParts.push('<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n'),this.stringParts.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 '.concat(this._size.width," ").concat(this._size.height,'">\n')),this.stringParts.push('\t<rect fill="'.concat(e,'" stroke="none" x="0" y="0" width="').concat(this._size.width,'" height="').concat(this._size.height,'"/>\n'))},t.prototype.finalize=function(){this.stringParts.push("</svg>\n")},t.prototype.drawSquares=function(e){var t=.5*this._size.width,i=.5*this._size.height;this.stringParts.push('\t<g stroke="none">\n');for(var n=0,r=e;n<r.length;n++){var o=r[n],a=o.center.x+t,s=o.center.y+i,c=.5*o.size;this.stringParts.push('\t\t<rect fill="'.concat(o.color,'" x="').concat(a-c,'" y="').concat(s-c,'" width="').concat(o.size,'" height="').concat(o.size,'"/>\n'))}this.stringParts.push("\t</g>\n")},t.prototype.drawCircles=function(e){var t=.5*this._size.width,i=.5*this._size.height;this.stringParts.push('\t<g stroke="none">\n');for(var n=0,r=e;n<r.length;n++){var o=r[n],a=o.center.x+t,s=o.center.y+i;this.stringParts.push('\t\t<circle fill="'.concat(o.color,'" cx="').concat(a,'" cy="').concat(s,'" r="').concat(o.radius,'"/>\n'))}this.stringParts.push("\t</g>\n")},t.prototype.drawRectangles=function(e){var t=.5*this._size.width,i=.5*this._size.height;this.stringParts.push('\t<g stroke="none">\n');for(var n=0,r=e;n<r.length;n++){var o=r[n],a=o.center.x+t,s=o.center.y+i;this.stringParts.push('\t\t<rect fill="'.concat(o.color,'" x="').concat(a-.5*o.width,'" y="').concat(s-.5*o.height,'" width="').concat(o.width,'" height="').concat(o.height,'"/>\n'))}this.stringParts.push("\t</g>\n")},t.prototype.drawTriangles=function(e){var t=.5*this._size.width,i=.5*this._size.height;this.stringParts.push('\t<g stroke="none">\n');for(var n=0,r=e;n<r.length;n++){var o=r[n],a=o.center.x+t,s=o.center.y+i;this.stringParts.push('\t\t<polygon fill="'.concat(o.color,'" points="').concat(a+o.P1.x*o.size,",").concat(s+o.P1.y*o.size," ").concat(a+o.P2.x*o.size,",").concat(s+o.P2.y*o.size," ").concat(a+o.P3.x*o.size,",").concat(s+o.P3.y*o.size,'"/>\n'))}this.stringParts.push("\t</g>\n")},t.prototype.drawHearts=function(e){var t=.5*this._size.width,i=.5*this._size.height,n="heart_".concat(Math.round(1e5*Math.random()));this.stringParts.push("\t<defs>\n"),this.stringParts.push('\t\t<path id="'.concat(n,'" d="M').concat(o.PatternHeart.a,",0L0,").concat(o.PatternHeart.a," ").concat(-o.PatternHeart.a,",0 A ").concat(o.PatternHeart.c," ").concat(o.PatternHeart.c," 0 0 1 0,").concat(-o.PatternHeart.a," A ").concat(o.PatternHeart.c," ").concat(o.PatternHeart.c," 0 0 1 ").concat(o.PatternHeart.a,',0Z"/>\n')),this.stringParts.push("\t</defs>\n"),this.stringParts.push('\t<g stroke="none">\n');for(var r=0,a=e;r<a.length;r++){var s=a[r];this.stringParts.push('\t\t<use href="#'.concat(n,'" fill="').concat(s.color,'" transform="translate(').concat(s.center.x+t,", ").concat(s.center.y+i,") scale(").concat(s.size,')"/>\n'))}this.stringParts.push("\t</g>\n")},t.prototype.drawLines=function(e,t){for(var i=[],n=.5*this._size.width,r=.5*this._size.height,o=0,a=e;o<a.length;o++){var s=a[o],c=s.from.x+n,l=s.from.y+r,u=s.to.x+n,h=s.to.y+r;i.push("M".concat(c,",").concat(l,"L").concat(u,",").concat(h))}this.stringParts.push('\t\t\t<path fill="none" stroke-width="1" stroke="'.concat(t,'" d="').concat(i.join(),'"/>\n'))},t.prototype.export=function(){return this.stringParts.join("")},t}(i(792).PlotterBase);t.PlotterSVG=a},247:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Grid=void 0;var a=o(i(8)),s=i(697),c=function(){function e(){this.gridSize={width:0,height:0},this.gridCells=[],this.topLeftCorner={x:0,y:0},this.reset({width:1,height:1},100,[])}return e.prototype.reset=function(e,t,i){this.registeredItemsCount=0,a.timeSpentInReindexResetDomain.start();var n=this.resetDomain(e,t);a.timeSpentInReindexResetDomain.stop(),a.timeSpentInReindexReindexItems.start();for(var r=0,o=i;r<o.length;r++){var s=o[r];this.registerItem(s)}return a.timeSpentInReindexReindexItems.stop(),n},e.prototype.registerItem=function(e){for(var t={x:e.center.x-.5*e.size,y:e.center.y-.5*e.size},i={x:e.center.x+.5*e.size,y:e.center.y+.5*e.size},n=this.getCellId(t),r=this.getCellId(i),o=n.y;o<=r.y;o++)for(var a=n.x;a<=r.x;a++){var s=this.computeCellId(a,o);this.gridCells[s].push(e),this.registeredItemsCount++}},e.prototype.draw=function(e){for(var t=[],i=this.topLeftCorner.x,n=i+this.gridSize.width*this._cellSize,r=this.topLeftCorner.y,o=r+this.gridSize.height*this._cellSize,a=0;a<this.gridSize.width;a++){var c=i+a*this._cellSize,l={from:{x:c,y:r},to:{x:c,y:o}};t.push(l)}for(var u=0;u<this.gridSize.height;u++){var h=r+u*this._cellSize;l={from:{x:i,y:h},to:{x:n,y:h}},t.push(l)}e.drawLines(t,s.Color.GREEN)},e.prototype.getCellId=function(e){var t=Math.floor((e.x-this.topLeftCorner.x)/this._cellSize),i=Math.floor((e.y-this.topLeftCorner.y)/this._cellSize);return t<0?t=0:t>=this.gridSize.width&&(t=this.gridSize.width-1),i<0?i=0:i>=this.gridSize.height&&(i=this.gridSize.height-1),{x:t,y:i}},e.prototype.getDistanceToClosestBorder=function(e){var t=(e.x-this.topLeftCorner.x)%this._cellSize,i=(e.y-this.topLeftCorner.y)%this._cellSize,n=Math.min(t,this._cellSize-t),r=Math.min(i,this._cellSize-i);return Math.min(n,r)},e.prototype.getItemsFromCell=function(e,t){if(e>=0&&e<this.gridSize.width&&t>=0&&t<this.gridSize.height){var i=this.computeCellId(e,t);return this.gridCells[i]}return[]},e.prototype.getItemsFromCellsGroup=function(e,t,i,n){for(var r=[],o=t;o<=n;o++)for(var a=e;a<=i;a++){var s=this.getItemsFromCell(a,o);r.push.apply(r,s)}return r},e.prototype.computeStatistics=function(){a.registerGridStats(this.gridSize,this._cellSize,this.registeredItemsCount)},Object.defineProperty(e.prototype,"itemsPerCell",{get:function(){return 0===this.gridCells.length?0:this.registeredItemsCount/this.gridCells.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cellSize",{get:function(){return this._cellSize},enumerable:!1,configurable:!0}),e.prototype.resetDomain=function(e,t){var i=Math.ceil(e.width/t),n=Math.ceil(e.height/t);t<10?t=10:t>500&&(t=500);var r=this._cellSize!==t||this.gridSize.width!==i||this.gridSize.height!==n;this._cellSize=t,this.gridSize.width=i,this.gridSize.height=n,this.topLeftCorner.x=-.5*e.width,this.topLeftCorner.y=-.5*e.height;var o=this.gridSize.width*this.gridSize.height;this.gridCells.length=o;for(var a=0;a<o;a++)this.gridCells[a]=[];return r},e.prototype.computeCellId=function(e,t){return e+t*this.gridSize.width},e}();t.Grid=c},8:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.timeSpentInZoom=t.timeSpentInRecycle=t.timeSpentInReindexReindexItems=t.timeSpentInReindexResetDomain=t.timeSpentInReindex=t.timeSpentInUpdate=t.timeSpentInDrawDrawX=t.timeSpentInDrawUploadVBO=t.timeSpentInDrawFillBuffer=t.timeSpentInDrawAllocateBuffer=t.timeSpentInDraw=t.timeSpentInMainLoop=t.registerRecyclingStats=t.registerFrame=t.registerGridStats=t.initialize=void 0;var n=i(61),r=i(935);i(457);var o=new r.StopWatch,a=0,s=new r.StopWatch;t.timeSpentInMainLoop=s;var c=new r.StopWatch;t.timeSpentInDraw=c;var l=new r.StopWatch;t.timeSpentInDrawAllocateBuffer=l;var u=new r.StopWatch;t.timeSpentInDrawFillBuffer=u;var h=new r.StopWatch;t.timeSpentInDrawUploadVBO=h;var d=new r.StopWatch;t.timeSpentInDrawDrawX=d;var f=new r.StopWatch;t.timeSpentInUpdate=f;var g=new r.StopWatch;t.timeSpentInReindex=g;var p=new r.StopWatch;t.timeSpentInReindexResetDomain=p;var P=new r.StopWatch;t.timeSpentInReindexReindexItems=P;var v=new r.StopWatch;t.timeSpentInRecycle=v;var m=new r.StopWatch;t.timeSpentInZoom=m;var y=0,b=0,_=0,I=0,C=0,x=0,S=0,w=0,O=0;t.initialize=function(){o.reset(),o.start(),a=0},t.registerFrame=function(){a++,o.totalTime>1e3&&(function(){var e=1e3*a/o.totalTime;if(n.Parameters.isInDebug){var t=o.totalTime/a,i=s.totalTime/a,r=i/t,T=c.totalTime/a,E=T/i,z=l.totalTime/a,A=z/T,R=u.totalTime/a,L=R/T,M=h.totalTime/a,B=M/T,V=d.totalTime/a,j=V/T,D=f.totalTime/a,N=D/i,F=g.totalTime/a,G=F/D,k=p.totalTime/a,U=k/F,W=P.totalTime/a,H=W/F,Y=v.totalTime/a,q=Y/D,Z=m.totalTime/a,X=Z/D;if(Page.Canvas.setIndicatorText("fps","".concat(e.toFixed(0)," (").concat(t.toFixed(2)," ms)")),Page.Canvas.setIndicatorText("main-loop-time","".concat(i.toFixed(2)," ms (").concat((100*r).toFixed(1)," %)")),Page.Canvas.setIndicatorText("draw-time","".concat(T.toFixed(2)," ms (").concat((100*E).toFixed(1)," %)")),Page.Canvas.setIndicatorText("draw-allocatebuffer-time","".concat(z.toFixed(2)," ms (").concat((100*A).toFixed(1)," %)")),Page.Canvas.setIndicatorText("draw-fillbuffer-time","".concat(R.toFixed(2)," ms (").concat((100*L).toFixed(1)," %)")),Page.Canvas.setIndicatorText("draw-uploadvbo-time","".concat(M.toFixed(2)," ms (").concat((100*B).toFixed(1)," %)")),Page.Canvas.setIndicatorText("draw-drawX-time","".concat(V.toFixed(2)," ms (").concat((100*j).toFixed(1)," %)")),Page.Canvas.setIndicatorText("update-time","".concat(D.toFixed(2)," ms (").concat((100*N).toFixed(1)," %)")),Page.Canvas.setIndicatorText("update-reindex-time","".concat(F.toFixed(2)," ms (").concat((100*G).toFixed(1)," %)")),Page.Canvas.setIndicatorText("update-reindex-resetdomain-time","".concat(k.toFixed(2)," ms (").concat((100*U).toFixed(1)," %)")),Page.Canvas.setIndicatorText("update-reindex-reindexitems-time","".concat(W.toFixed(2)," ms (").concat((100*H).toFixed(1)," %)")),Page.Canvas.setIndicatorText("update-recycle-time","".concat(Y.toFixed(2)," ms (").concat((100*q).toFixed(1)," %)")),Page.Canvas.setIndicatorText("update-zoom-time","".concat(Z.toFixed(2)," ms (").concat((100*X).toFixed(1)," %)")),Page.Canvas.setIndicatorText("items-reclycled-count","".concat((b/a*e).toFixed(1))),Page.Canvas.setIndicatorText("items-pending-recycling-count","".concat((_/a).toFixed(1))),Page.Canvas.setIndicatorText("items-recycling-tries-count","".concat((I/a).toFixed(1))),C>0){var Q=Math.round(x/C),K=Math.round(S/C),J=Q*K;Page.Canvas.setIndicatorText("grid-size","".concat(Q,"x").concat(K," (").concat(J,")")),Page.Canvas.setIndicatorText("grid-cell-size","".concat((w/C).toFixed(1))),Page.Canvas.setIndicatorText("grid-items-per-cell","".concat((O/C/J).toFixed(1)))}}else Page.Canvas.setIndicatorText("fps",e.toFixed(0));Page.Canvas.setIndicatorText("items-count","".concat(y)),Page.Canvas.setIndicatorText("items-visible-count","".concat((y-_/a).toFixed(0)))}(),o.reset(),a=0,s.reset(),c.reset(),l.reset(),u.reset(),h.reset(),d.reset(),f.reset(),g.reset(),p.reset(),P.reset(),v.reset(),m.reset(),b=0,_=0,I=0,C=0)},t.registerRecyclingStats=function(e,t,i,n){y=e,b+=t,_+=i,I+=n},t.registerGridStats=function(e,t,i){0===C&&(x=0,S=0,w=0,O=0),C++,x+=e.width,S+=e.height,w+=t,O+=i}},935:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.StopWatch=void 0;var i=function(){function e(){this._totalTime=0,this._isRunning=!1}return e.prototype.start=function(){this._isRunning?console.log("Error: stopwatch is already started"):(this._lastCheckpoint=performance.now(),this._isRunning=!0)},e.prototype.stop=function(){if(this._isRunning){var e=performance.now();this._totalTime+=e-this._lastCheckpoint,this._lastCheckpoint=e,this._isRunning=!1}else console.log("Error: stopwatch is already stopped.")},e.prototype.reset=function(){this._totalTime=0,this._lastCheckpoint=performance.now()},Object.defineProperty(e.prototype,"totalTime",{get:function(){return this._isRunning?this._totalTime+(performance.now()-this._lastCheckpoint):this._totalTime},enumerable:!1,configurable:!0}),e}();t.StopWatch=i},440:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getQueryStringValue=t.downloadTextFile=void 0,t.downloadTextFile=function(e,t){var i="text/plain",n=new Blob([t],{type:i});if(void 0!==window.navigator&&void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(n,e);else{var r=URL.createObjectURL(n),o=document.createElement("a");o.download=e,o.href=r,o.dataset.downloadurl="".concat(i,":").concat(o.download,":").concat(o.href),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout((function(){URL.revokeObjectURL(r)}),5e3)}},t.getQueryStringValue=function(e){var t=window.location.href,i=t.indexOf("?");if(i>=0){var n=t.substring(i+1);if(n.length>0)for(var r=0,o=n.split("&");r<o.length;r++){var a=o[r].split("=");if(2===a.length&&decodeURIComponent(a[0])===e)return decodeURIComponent(a[1])}}return null}},587:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NumberRange=void 0;var i=function(){function e(e,t){this.from=e,this.to=t}return e.prototype.isInRange=function(e){return this.from<=e&&e<=this.to},e.prototype.clamp=function(e){return e<this.from?this.from:e>this.to?this.to:e},Object.defineProperty(e.prototype,"span",{get:function(){return this.to-this.from},enumerable:!1,configurable:!0}),e}();t.NumberRange=i}},t={};!function i(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,i),o.exports}(633)}();
//# sourceMappingURL=main.min.js.map