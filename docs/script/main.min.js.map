{"version":3,"sources":["webpack://packing-webgl/./src/ts/color/color.ts","webpack://packing-webgl/./src/ts/debug-collisions.ts","webpack://packing-webgl/./src/ts/engine.ts","webpack://packing-webgl/./src/ts/gl-utils/gl-canvas.ts","webpack://packing-webgl/./src/ts/gl-utils/gl-resource.ts","webpack://packing-webgl/./src/ts/gl-utils/shader-manager.ts","webpack://packing-webgl/./src/ts/gl-utils/shader-sources.ts","webpack://packing-webgl/./src/ts/gl-utils/shader.ts","webpack://packing-webgl/./src/ts/gl-utils/vbo.ts","webpack://packing-webgl/./src/ts/main.ts","webpack://packing-webgl/./src/ts/parameters.ts","webpack://packing-webgl/./src/ts/patterns/pattern-base.ts","webpack://packing-webgl/./src/ts/patterns/pattern-circle.ts","webpack://packing-webgl/./src/ts/patterns/pattern-rectangle.ts","webpack://packing-webgl/./src/ts/patterns/pattern-square.ts","webpack://packing-webgl/./src/ts/patterns/pattern-triangle.ts","webpack://packing-webgl/./src/ts/plotter/plotter-base.ts","webpack://packing-webgl/./src/ts/plotter/plotter-canvas-2d.ts","webpack://packing-webgl/./src/ts/plotter/plotter-canvas-base.ts","webpack://packing-webgl/./src/ts/plotter/plotter-canvas-webgl.ts","webpack://packing-webgl/./src/ts/plotter/plotter-svg.ts","webpack://packing-webgl/./src/ts/space-grid/grid.ts","webpack://packing-webgl/./src/ts/statistics/statistics.ts","webpack://packing-webgl/./src/ts/statistics/stop-watch.ts","webpack://packing-webgl/./src/ts/utils/helper.ts","webpack://packing-webgl/./src/ts/utils/number-range.ts","webpack://packing-webgl/webpack/bootstrap","webpack://packing-webgl/webpack/startup"],"names":["String","prototype","padStart","maxLength","fillString","this","length","nbRepeats","Math","ceil","result","i","r","g","b","random","Color","randomChannel","toString","hexString","rHex","gHex","bHex","floor","BLACK","WHITE","GREEN","testedSquares","fixed","PatternSquare","mobile","testedCircles","PatternCircle","testedRectangles","PatternRectangle","testedTriangles","PatternTriangle","computeSquare","sideSize","computeRectangle","width","height","size","from","x","y","to","mainDebugCollisions","plotter","PlotterCanvas2D","zoomFactor","Page","Canvas","Observers","mouseWheel","push","delta","max","min","requestAnimationFrame","mainLoop","primitive","currentTestType","Parameters","currentCollisionType","testitems","EPrimitive","SQUARE","CIRCLE","RECTANGLE","canvasSize","getSize","minCanvasSide","mousePosRelative","getMousePosition","center","drawFunction","items","drawSquares","drawCircles","drawRectangles","drawTriangles","getDrawFunction","ECollisionTestType","PRIMITIVE","lines","initialize","drawLines","finalize","POINT","domainSize","visibility","computeVisibility","EVisibility","COVERS_VIEW","console","log","OUT_OF_VIEW","initializedItemsList","uninitializedItemsList","lastRecyclingTime","zoomCenter","backgroundColorOverride","backgroundNestingLevel","reset","createItem","TRIANGLE","Error","currentPrimitive","setItemsCount","wantedCount","initializedCount","totalItemsCount","itemsToAdd","newItem","draw","PatternBase","baseNestingLevel","additionalNestingLevelForColor","highContrastColor","highContrast","everythingDrawn","isReady","isZooming","performance","now","maxBlendingTime","itemsToDraw","backgroundColor","computeBackgroundColor","oneCellOnly","grid","getItemsFromCell","cellX","cellY","showGrid","udpate","deltaTimeInSeconds","mayRecycle","willZoom","needToInitializeGrid","requiresRedraw","Statistics","timeSpentInReindex","start","gridChanged","reindexItems","stop","timeSpentInRecycle","itemsRecycled","performRecycling","timeSpentInZoom","itemsMoved","performZoom","Grid","gridCellSize","cellSize","adaptativeGrid","targetItemsPerCell","targetItemsPerGridCell","lastItemsPerCell","itemsPerCell","nbItemsRecycled","allowOverlapping","sizeFactor","spacing","acceptedSizesForNewItems","NumberRange","minSize","maxTries","maxTriesPerFrame","triesLeft","currentItem","pop","resetResult","nbTries","success","registerItem","nbPendingRecycling","nbTriesUsed","registerRecyclingStats","computeStatistics","updateZoomCenter","newInitializedArray","zoomSpeed","item","zoomIn","MAX_SIZE","VISIBLE","rawColor","nestingLevel","blackBackground","isMouseDown","mousePosition","halfWidth","halfHeight","Engine","gl","initGL","flags","setError","message","Demopage","setErrorMessage","canvas","getCanvas","getContext","disable","CULL_FACE","DEPTH_TEST","BLEND","clearColor","adjustSize","hidpi","cssPixel","window","devicePixelRatio","clientWidth","clientHeight","_gl","GLResource","cachedShaders","buildShader","infos","callback","sourcesPending","sourcesFailed","loadedSource","processSource","source","replace","match","name","injected","shader","vert","ShaderSources","getSource","vertexFilename","frag","fragmentFilename","processedVert","processedFrag","Shader","loadSource","getShader","registerShader","callAndClearCallbacks","cached","callbacks","cachedCallback","failed","pending","builtShader","deleteShader","freeGLResources","cachedSources","filename","text","XMLHttpRequest","open","onload","readyState","status","responseText","error","statusText","onerror","send","notImplemented","alert","types","str","binder","location","value","uniform2fv","uniform3fv","uniform4fv","uniform2iv","uniform3iv","uniform4iv","uniform1i","uniformMatrix2fv","uniformMatrix3fv","uniformMatrix4fv","unitNb","activeTexture","bindTexture","TEXTURE_2D","TEXTURE_CUBE_MAP","Array","isArray","uniform1iv","uniform1fv","uniform1f","vertexSource","fragmentSource","createShader","type","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","id","uCount","aCount","vertexShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","introspection","getProgramInfoLog","deleteProgram","use","useProgram","bindUniforms","currTextureUnitNb","Object","keys","u","forEach","uName","uniform","loc","bindAttributes","a","aName","attribute","VBO","bind","bindUniformsAndAttributes","ACTIVE_UNIFORMS","getActiveUniform","getUniformLocation","ACTIVE_ATTRIBUTES","getActiveAttrib","getAttribLocation","Usage","array","staticUsage","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","DYNAMIC_DRAW","normalize","stride","offset","usage","STATIC","DYNAMIC","createQuad","minX","minY","maxX","maxY","Float32Array","FLOAT","deleteBuffer","enableVertexAttribArray","vertexAttribPointer","bindInstanced","ext","divisor","vertexAttribDivisorANGLE","setData","isInCollisionsDebug","canvasPlotter","isWebGLVersion","PlotterCanvasWebGL","engine","needToRedraw","addRedrawObserver","addClearObserver","addDownloadObserver","svgPlotter","PlotterSVG","svgString","export","Helper","downloadTextFile","lastRunTime","time","timeSpentInMainLoop","wantedItemsCount","quantity","timeSpentInUpdate","updateChangedSomething","timeSpentInDraw","successfulDraw","registerFrame","main","controlId","redrawObservers","triggerRedraw","observer","canvasResize","Checkbox","addObserver","Tabs","Range","clearObservers","triggerClear","Button","isInDebug","Helpers","getQueryStringValue","Sections","setVisibility","setIndicatorVisibility","setChecked","updateIndicatorsVisibility","visible","isChecked","setIndicatorsVisibility","updateGridControlsVisibility","adaptative","Controls","href","getValue","getValues","abs","disallowInstancing","FileControl","CANVAS_CENTER","globalLastTestId","lastTestId","blending","acceptedSizes","randomizePosition","maxSize","computeBiggestSizePossible","isInRange","initializationTime","computeOpacity","blendTime","MAX_SIZE_LOWER","MAX_SIZE_GAP","lifetime","currentTestId","rawMaxSize","computeBiggestSizePossibleToAvoidPoint","maxDistanceDetectableByExactCell","getDistanceToClosestBorder","exactCellId","getCellId","existingItemsFromExactCell","biggestSizeToAvoidClosestItems","computeBiggestSizePossibleToAvoidItems","topLeftPoint","bottomRightPoint","minCellId","maxCellId","additionalItemsToTest","getItemsFromCellsGroup","biggestSizeToAvoidFurtherItems","itemsToAvoid","computeBiggestSizePossibleToAvoidItem","isInside","round","pointToAvoid","toPointX","toPointY","sqrt","itemToAvoid","toCenterX","toCenterY","distance","radius","halfDomainWidth","halfDomainHeight","absX","absY","dX","dY","aspectRatio","baseWidth","baseHeight","maxSizeX","maxSizeY","deltaX","deltaY","halfObstacleWidth","halfObstacleHeight","halfSideLength","sideLength","halfSize","rotatePoint","point","cosAngle","sinAngle","computeSegmentsIntersection","from1","delta1","delta2","denom","invDenom","t1","MAX_NUMBER","minPositive","args","arg","angle","PI","cos","sin","P1","baseP1","P2","baseP2","P3","baseP3","P1_TO_P2","P2_TO_P3","P3_TO_P1","pointToAvoidLocal","intersection","isPointInside","smallerTforMyVertices","smallerTforMySides","localOtherP1","localOtherP2","localOtherP3","scaledOtherP1toP2","scaledOtherP2toP3","scaledOtherP3toP1","T1_1","T1_2","T1_3","T2_1","T2_2","T2_3","T3_1","T3_2","T3_3","d1","d2","d3","PlotterBase","context","alpha","clearCanvas","color","fillStyle","fillRect","squares","_size","square","centerX","centerY","circles","TWO_PI","circle","beginPath","arc","fill","closePath","rectangles","rectangle","triangles","triangle","moveTo","lineTo","strokeStyle","lineWidth","line","stroke","PlotterCanvasBase","resizeCanvas","actualWidth","actualHeight","SQUARE_GEOMETRY","TRIANGLE_GEOMETRY","ALIASED_POINT_SIZE_RANGE","needToResetInstancingDivision","instancingExt","getExtension","errorMessage","enableBlending","linesBuffer","linesVBO","statesBuffer","statesVBO","colorsBuffer","colorsVBO","geometryBuffer","concat","geometryVBO","linesShader","squaresShader","circlesShader","rectanglesShader","trianglesShader","loadAndBuildShader","squaresInstancedShader","circlesInstancedShader","rectanglesInstancedShader","trianglesInstancedShader","supportsInstancing","clear","COLOR_BUFFER_BIT","viewport","drawPrimitives","nbLines","wantedLinesBufferLength","drawArrays","LINES","pointsShader","instancedShader","extraAttributeFunction","updateStateAndColorVBOs","useInstancing","drawInstanced","drawAsPoints","nbItems","drawArraysInstancedANGLE","TRIANGLES","TRIANGLE_STRIP","POINTS","extraAttribute","nbItemsRounded","wantedStatesBufferLength","wantedColorsBufferLength","enable","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","shaderName","affectShader","ShaderManager","stringParts","path","x1","y1","x2","y2","join","gridSize","gridCells","topLeftCorner","registeredItemsCount","gridHasChanged","resetDomain","topLeft","bottomRight","iCellY","iCellX","cellId","computeCellId","_cellSize","iX","iY","position","localX","localY","minDistanceX","minDistanceY","minCellX","minCellY","maxCellX","maxCellY","cellItems","apply","registerGridStats","wantedGridSizeX","wantedGridSizeY","hasChanged","nbCells","timeSinceLastVerboseFrame","StopWatch","frames","itemsCount","itemsRecycledCount","itemsPendingRecyclingCount","itemsRecyclingTries","nbGridStats","gridWidth","gridHeight","gridRegisteredItems","totalTime","fps","averageFrameTime","averageMainLoopTime","mainLoopTimeRelative","averageDrawTime","drawTimeRelative","averageUpdateTime","updateTimeRelative","averageUpdateReindexTime","updateReindexTimeRelative","averageUpdateRecycleTime","updateRecycleTimeRelative","averageUpdateZoomTime","updateZoomTimeRelative","setIndicatorText","toFixed","averageGridWidth","averageGridHeight","averageGridCellCount","updateIndicators","total","recycled","pendingRecycling","nbTriesCount","registeredItems","_totalTime","_isRunning","_lastCheckpoint","fileName","content","fileType","blob","Blob","navigator","msSaveBlob","URL","createObjectURL","linkElement","document","createElement","download","dataset","downloadurl","style","display","body","appendChild","click","removeChild","setTimeout","revokeObjectURL","url","queryStringStart","indexOf","queryString","substring","split","keyValue","decodeURIComponent","candidate","__webpack_module_cache__","__webpack_require__","moduleId","exports","module","__webpack_modules__","call"],"mappings":"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","file":"main.min.js","sourcesContent":["function registerPadStartPolyfill(): void {\r\n    if (typeof String.prototype.padStart !== \"function\") {\r\n        String.prototype.padStart = function padStart(maxLength: number, fillString?: string): string {\r\n            if (this.length > maxLength) {\r\n                return String(this);\r\n            }\r\n\r\n            if (!fillString) {\r\n                fillString = \" \";\r\n            }\r\n\r\n            const nbRepeats = Math.ceil((maxLength - this.length) / fillString.length);\r\n            let result = \"\";\r\n            for (let i = 0; i < nbRepeats; i++) {\r\n                result += fillString;\r\n            }\r\n            return result + this;\r\n        }\r\n    }\r\n}\r\nregisterPadStartPolyfill(); // for IE11\r\n\r\nclass Color {\r\n    public static readonly BLACK: Color = new Color(0, 0, 0);\r\n    public static readonly WHITE: Color = new Color(255, 255, 255);\r\n    public static readonly GREEN: Color = new Color(0, 255, 0);\r\n\r\n    public static random(): Color {\r\n        return new Color(Color.randomChannel(), Color.randomChannel(), Color.randomChannel());\r\n    }\r\n\r\n    /** @param r in [0, 255]\r\n     *  @param g in [0, 255]\r\n     *  @param b in [0, 255]\r\n     */\r\n    public constructor(public readonly r: number, public readonly g: number, public readonly b: number) { }\r\n\r\n    public toString(): string {\r\n        if (!this.hexString) {\r\n            const rHex = this.r.toString(16).padStart(2, \"0\");\r\n            const gHex = this.g.toString(16).padStart(2, \"0\");\r\n            const bHex = this.b.toString(16).padStart(2, \"0\");\r\n            this.hexString = `#${rHex}${gHex}${bHex}`;\r\n        }\r\n\r\n        return this.hexString;\r\n    }\r\n\r\n    private hexString: string;\r\n\r\n    private static randomChannel(): number {\r\n        return Math.floor(256 * Math.random());\r\n    }\r\n}\r\n\r\nexport { Color }\r\n","import { ECollisionTestType, EPrimitive, Parameters } from \"./parameters\";\r\nimport { EVisibility, PatternBase } from \"./patterns/pattern-base\";\r\nimport { PatternCircle } from \"./patterns/pattern-circle\";\r\nimport { PatternRectangle } from \"./patterns/pattern-rectangle\";\r\nimport { PatternSquare } from \"./patterns/pattern-square\";\r\nimport { PatternTriangle } from \"./patterns/pattern-triangle\";\r\nimport { PlotterCanvas2D } from \"./plotter/plotter-canvas-2d\";\r\nimport { Color } from \"./color/color\";\r\nimport { ILine } from \"./utils/i-line\";\r\nimport { ISize } from \"./utils/i-size\";\r\n\r\ninterface ITest {\r\n    fixed: PatternBase;\r\n    mobile: PatternBase;\r\n}\r\ninterface ITestedPattern<T extends PatternBase> extends ITest {\r\n    fixed: T;\r\n    mobile: T;\r\n}\r\n\r\nconst testedSquares: ITestedPattern<PatternSquare> = {\r\n    fixed: new PatternSquare(),\r\n    mobile: new PatternSquare(),\r\n};\r\n\r\nconst testedCircles: ITestedPattern<PatternCircle> = {\r\n    fixed: new PatternCircle(),\r\n    mobile: new PatternCircle(),\r\n};\r\n\r\nconst testedRectangles: ITestedPattern<PatternRectangle> = {\r\n    fixed: new PatternRectangle(),\r\n    mobile: new PatternRectangle(),\r\n};\r\n\r\nconst testedTriangles: ITestedPattern<PatternTriangle> = {\r\n    fixed: new PatternTriangle(),\r\n    mobile: new PatternTriangle(),\r\n};\r\n\r\nfunction getCurrentTestItems(): ITest {\r\n    const primitive = Parameters.primitive;\r\n    if (primitive === EPrimitive.SQUARE) {\r\n        return testedSquares;\r\n    } else if (primitive === EPrimitive.CIRCLE) {\r\n        return testedCircles;\r\n    } else if (primitive === EPrimitive.RECTANGLE) {\r\n        return testedRectangles;\r\n    } else { //  if (primitive === EPrimitive.TRIANGLE) {\r\n        return testedTriangles\r\n    }\r\n}\r\n\r\nfunction computeSquare(sideSize: number): ILine[] {\r\n    return computeRectangle({ width: sideSize, height: sideSize });\r\n}\r\n\r\nfunction computeRectangle(size: ISize): ILine[] {\r\n    return [\r\n        { from: { x: -0.5 * size.width, y: -0.5 * size.height }, to: { x: +0.5 * size.width, y: -0.5 * size.height } },\r\n        { from: { x: +0.5 * size.width, y: -0.5 * size.height }, to: { x: +0.5 * size.width, y: +0.5 * size.height } },\r\n        { from: { x: +0.5 * size.width, y: +0.5 * size.height }, to: { x: -0.5 * size.width, y: +0.5 * size.height } },\r\n        { from: { x: -0.5 * size.width, y: +0.5 * size.height }, to: { x: -0.5 * size.width, y: -0.5 * size.height } },\r\n    ];\r\n}\r\n\r\nfunction mainDebugCollisions(): void {\r\n    const plotter = new PlotterCanvas2D();\r\n\r\n    type DrawFunction = (items: PatternBase[]) => unknown;\r\n    function getDrawFunction(): DrawFunction {\r\n        const primitive = Parameters.primitive;\r\n        if (primitive === EPrimitive.SQUARE) {\r\n            return (items: PatternBase[]) => plotter.drawSquares(items as PatternSquare[]);\r\n        } else if (primitive === EPrimitive.CIRCLE) {\r\n            return (items: PatternBase[]) => plotter.drawCircles(items as PatternCircle[]);\r\n        } else if (primitive === EPrimitive.RECTANGLE) {\r\n            return (items: PatternBase[]) => plotter.drawRectangles(items as PatternRectangle[]);\r\n        } else { // if (primitive === EPrimitive.TRIANGLE) {\r\n            return (items: PatternBase[]) => plotter.drawTriangles(items as PatternTriangle[]);\r\n        }\r\n    }\r\n\r\n    let zoomFactor = 1;\r\n    Page.Canvas.Observers.mouseWheel.push((delta: number) => {\r\n        zoomFactor += 0.1 * delta;\r\n        zoomFactor = Math.max(0.2, Math.min(10, zoomFactor));\r\n    });\r\n    function mainLoop(): void {\r\n        const currentTestType = Parameters.currentCollisionType;\r\n\r\n        const testitems = getCurrentTestItems();\r\n\r\n        const canvasSize = Page.Canvas.getSize();\r\n        const minCanvasSide = Math.min(canvasSize[0], canvasSize[1]);\r\n        const mousePosRelative = Page.Canvas.getMousePosition();\r\n        testitems.mobile.center.x = (mousePosRelative[0] - 0.5) * canvasSize[0];\r\n        testitems.mobile.center.y = (mousePosRelative[1] - 0.5) * canvasSize[1];\r\n        testitems.fixed.center.x = 0;\r\n        testitems.fixed.center.y = 0;\r\n        testitems.fixed.size = 0.5 * zoomFactor * minCanvasSide;\r\n\r\n        const drawFunction = getDrawFunction();\r\n        if (currentTestType === ECollisionTestType.PRIMITIVE) {\r\n            // bracket notations allows access to private fields/method while still keeping a bit of type checking\r\n            testitems.mobile.size = testitems.mobile[\"computeBiggestSizePossibleToAvoidItem\"](testitems.fixed, true).size;\r\n\r\n            const lines = computeSquare(testitems.fixed.size);\r\n            plotter.initialize(Color.BLACK);\r\n            drawFunction([testitems.fixed, testitems.mobile]);\r\n            plotter.drawLines(lines, Color.GREEN);\r\n            plotter.finalize();\r\n        } else if (currentTestType === ECollisionTestType.POINT) {\r\n            // bracket notations allows access to private fields/method while still keeping a bit of type checking\r\n            testitems.mobile.size = testitems.mobile[\"computeBiggestSizePossibleToAvoidPoint\"]({ x: 0, y: 0 });\r\n\r\n            const lines = computeSquare(0.5);\r\n            plotter.initialize(Color.BLACK);\r\n            drawFunction([testitems.mobile]);\r\n            plotter.drawLines(lines, Color.GREEN);\r\n            plotter.finalize();\r\n        } else {\r\n            testitems.mobile.size = 0.2 * zoomFactor * minCanvasSide;\r\n\r\n            const domainSize: ISize = { width: 0.5 * canvasSize[0], height: 0.5 * canvasSize[1] };\r\n            const visibility = testitems.mobile.computeVisibility(domainSize);\r\n            if (visibility === EVisibility.COVERS_VIEW) {\r\n                console.log(\"covers view\");\r\n            } else if (visibility === EVisibility.OUT_OF_VIEW) {\r\n                console.log(\"out of view\");\r\n            } else {\r\n                console.log(\"visible\");\r\n            }\r\n\r\n            const lines = computeRectangle(domainSize);\r\n            plotter.initialize(Color.BLACK);\r\n            drawFunction([testitems.mobile]);\r\n            plotter.drawLines(lines, Color.GREEN);\r\n            plotter.finalize();\r\n        }\r\n\r\n        requestAnimationFrame(mainLoop);\r\n    }\r\n    requestAnimationFrame(mainLoop);\r\n}\r\n\r\nexport { mainDebugCollisions }\r\n","import { EPrimitive, Parameters } from \"./parameters\";\r\n\r\nimport { EVisibility, PatternBase } from \"./patterns/pattern-base\";\r\nimport { PatternCircle } from \"./patterns/pattern-circle\";\r\nimport { PatternRectangle } from \"./patterns/pattern-rectangle\";\r\nimport { PatternSquare } from \"./patterns/pattern-square\";\r\nimport { PatternTriangle } from \"./patterns/pattern-triangle\";\r\n\r\nimport { PlotterBase } from \"./plotter/plotter-base\";\r\n\r\nimport { Grid } from \"./space-grid/grid\";\r\n\r\nimport { Color } from \"./color/color\";\r\nimport { ISize } from \"./utils/i-size\";\r\nimport { IPoint } from \"./utils/i-point\";\r\nimport { NumberRange } from \"./utils/number-range\";\r\n\r\nimport * as Statistics from \"./statistics/statistics\";\r\n\r\nimport \"./page-interface-generated\";\r\n\r\nclass Engine {\r\n    private initializedItemsList: PatternBase[]; // stored in the order they must be drawn.\r\n    private uninitializedItemsList: PatternBase[]; // stored in no particular order\r\n    private lastRecyclingTime: number;\r\n\r\n    private currentPrimitive: EPrimitive;\r\n    private createItem: () => PatternBase;\r\n\r\n    private grid: Grid; // used to index the items' positions for faster recycling\r\n\r\n    private zoomCenter: IPoint;\r\n\r\n    private backgroundColorOverride: Color;\r\n    private backgroundNestingLevel: number;\r\n\r\n    public constructor() {\r\n        this.initializedItemsList = [];\r\n        this.uninitializedItemsList = [];\r\n        this.lastRecyclingTime = 0;\r\n\r\n        this.zoomCenter = { x: 0, y: 0 }; // canvas center\r\n        this.backgroundColorOverride = null;\r\n        this.backgroundNestingLevel = 0;\r\n    }\r\n\r\n    public reset(): void {\r\n        const primitive = Parameters.primitive;\r\n\r\n        if (primitive === EPrimitive.SQUARE) {\r\n            this.createItem = () => new PatternSquare();\r\n        } else if (primitive === EPrimitive.CIRCLE) {\r\n            this.createItem = () => new PatternCircle();\r\n        } else if (primitive === EPrimitive.RECTANGLE) {\r\n            this.createItem = () => new PatternRectangle();\r\n        } else if (primitive === EPrimitive.TRIANGLE) {\r\n            this.createItem = () => new PatternTriangle();\r\n        } else {\r\n            throw new Error(`Invalid primitive \"${primitive}.`);\r\n        }\r\n\r\n        this.initializedItemsList = [];\r\n        this.uninitializedItemsList = [];\r\n        this.currentPrimitive = primitive;\r\n        this.backgroundColorOverride = null;\r\n        this.backgroundNestingLevel = 0;\r\n        this.zoomCenter.x = 0;\r\n        this.zoomCenter.y = 0;\r\n    }\r\n\r\n    public setItemsCount(wantedCount: number): void {\r\n        const initializedCount = this.initializedItemsList.length;\r\n        const uninitializedCount = this.uninitializedItemsList.length;\r\n\r\n        const totalItemsCount = initializedCount + uninitializedCount;\r\n        if (wantedCount > totalItemsCount) { // items to add\r\n            const itemsToAdd = wantedCount - totalItemsCount;\r\n            for (let i = 0; i < itemsToAdd; i++) {\r\n                const newItem = this.createItem();\r\n                this.uninitializedItemsList.push(newItem);\r\n            }\r\n        } else if (wantedCount < totalItemsCount) { // items to remove\r\n            if (wantedCount > initializedCount) {\r\n                this.uninitializedItemsList.length = wantedCount - initializedCount;\r\n            } else {\r\n                this.uninitializedItemsList = [];\r\n                this.initializedItemsList.length = wantedCount;\r\n            }\r\n        }\r\n    }\r\n\r\n    public draw(plotter: PlotterBase): boolean {\r\n        PatternBase.baseNestingLevel = this.backgroundNestingLevel;\r\n        PatternBase.additionalNestingLevelForColor = (Parameters.blackBackground) ? 0 : 1;\r\n        PatternBase.highContrastColor = Parameters.highContrast;\r\n\r\n        let everythingDrawn = plotter.isReady;\r\n        if (!Parameters.isZooming) {\r\n            const timeSinceLastRecycling = performance.now() - this.lastRecyclingTime;\r\n            const blendingOver = timeSinceLastRecycling > PatternBase.maxBlendingTime;\r\n            if (!blendingOver) {\r\n                everythingDrawn = false;\r\n            }\r\n        }\r\n\r\n        const backgroundColor = this.computeBackgroundColor();\r\n        plotter.initialize(backgroundColor);\r\n\r\n        let itemsToDraw: PatternBase[];\r\n        if (Parameters.oneCellOnly) {\r\n            itemsToDraw = this.grid.getItemsFromCell(Parameters.cellX, Parameters.cellY);\r\n        } else {\r\n            itemsToDraw = this.initializedItemsList;\r\n        }\r\n\r\n        if (this.currentPrimitive === EPrimitive.SQUARE) {\r\n            plotter.drawSquares(itemsToDraw as PatternSquare[]);\r\n        } else if (this.currentPrimitive === EPrimitive.CIRCLE) {\r\n            plotter.drawCircles(itemsToDraw as PatternCircle[]);\r\n        } else if (this.currentPrimitive === EPrimitive.RECTANGLE) {\r\n            plotter.drawRectangles(itemsToDraw as PatternRectangle[]);\r\n        } else if (this.currentPrimitive === EPrimitive.TRIANGLE) {\r\n            plotter.drawTriangles(itemsToDraw as PatternTriangle[]);\r\n        }\r\n\r\n        if (Parameters.showGrid) {\r\n            this.grid.draw(plotter);\r\n        }\r\n\r\n        plotter.finalize();\r\n\r\n        return everythingDrawn;\r\n    }\r\n\r\n    /** @returns true if the update changed something that requires a redraw */\r\n    public udpate(deltaTimeInSeconds: number, domainSize: ISize): boolean {\r\n        const mayRecycle = this.uninitializedItemsList.length > 0;\r\n        const willZoom = this.initializedItemsList.length > 0 && Parameters.isZooming;\r\n        const needToInitializeGrid = typeof this.grid === \"undefined\";\r\n        const needUpdate = mayRecycle || willZoom || needToInitializeGrid;\r\n        if (!needUpdate) {\r\n            return false;\r\n        }\r\n\r\n        let requiresRedraw = false;\r\n\r\n        Statistics.timeSpentInReindex.start();\r\n        const gridChanged = this.reindexItems(domainSize);\r\n        requiresRedraw = requiresRedraw || gridChanged;\r\n        Statistics.timeSpentInReindex.stop();\r\n\r\n        Statistics.timeSpentInRecycle.start();\r\n        const itemsRecycled = this.performRecycling(domainSize);\r\n        requiresRedraw = requiresRedraw || itemsRecycled;\r\n        if (itemsRecycled) {\r\n            this.lastRecyclingTime = performance.now();\r\n        }\r\n        Statistics.timeSpentInRecycle.stop();\r\n\r\n        Statistics.timeSpentInZoom.start();\r\n        if (Parameters.isZooming) {\r\n            const itemsMoved = (this.initializedItemsList.length > 0);\r\n            this.performZoom(deltaTimeInSeconds, domainSize);\r\n            requiresRedraw = requiresRedraw || itemsMoved;\r\n        }\r\n        Statistics.timeSpentInZoom.stop();\r\n\r\n        return requiresRedraw;\r\n    }\r\n\r\n    /**\r\n     * @param domainSize in pixels\r\n     * @param cellSize in pixels\r\n     * @returns true if a redraw is required\r\n     */\r\n    private reindexItems(domainSize: ISize): boolean {\r\n        if (typeof this.grid === \"undefined\") {\r\n            this.grid = new Grid();\r\n        }\r\n\r\n        let gridCellSize = Parameters.cellSize;\r\n        if (Parameters.adaptativeGrid) {\r\n            const targetItemsPerCell = Parameters.targetItemsPerGridCell;\r\n            const lastItemsPerCell = this.grid.itemsPerCell;\r\n            gridCellSize = this.grid.cellSize;\r\n            if (lastItemsPerCell < targetItemsPerCell) {\r\n                gridCellSize++;\r\n            } else {\r\n                gridCellSize--;\r\n            }\r\n        }\r\n\r\n        return this.grid.reset(domainSize, gridCellSize, this.initializedItemsList);\r\n    }\r\n\r\n    private performRecycling(domainSize: ISize): boolean {\r\n        let nbItemsRecycled = 0;\r\n\r\n        const allowOverlapping = Parameters.allowOverlapping;\r\n        const sizeFactor = 1 - Parameters.spacing;\r\n        const acceptedSizesForNewItems = new NumberRange(Parameters.minSize, 1000000);\r\n        const maxTries = Parameters.maxTriesPerFrame;\r\n\r\n        let triesLeft = maxTries;\r\n        while (this.uninitializedItemsList.length > 0 && triesLeft > 0) {\r\n            const currentItem = this.uninitializedItemsList.pop();\r\n\r\n            const resetResult = currentItem.reset(domainSize, this.grid, sizeFactor, acceptedSizesForNewItems, allowOverlapping, triesLeft);\r\n            triesLeft -= resetResult.nbTries;\r\n            if (resetResult.success) {\r\n                this.initializedItemsList.push(currentItem);\r\n                this.grid.registerItem(currentItem);\r\n                nbItemsRecycled++;\r\n            } else {\r\n                this.uninitializedItemsList.push(currentItem);\r\n            }\r\n        }\r\n\r\n        const totalItemsCount = this.initializedItemsList.length + this.uninitializedItemsList.length;\r\n        const nbPendingRecycling = this.uninitializedItemsList.length;\r\n        const nbTriesUsed = maxTries - triesLeft;\r\n        Statistics.registerRecyclingStats(totalItemsCount, nbItemsRecycled, nbPendingRecycling, nbTriesUsed);\r\n        this.grid.computeStatistics();\r\n\r\n        return nbItemsRecycled > 0;\r\n    }\r\n\r\n    /**\r\n     * Performs zoom on initialized items.\r\n     * During zooming, items might go out of view. In that case:\r\n     *   - these items are added to the uninitializedItemsList\r\n     *   - these items are removed from the initializedItemsList\r\n     * Does not modify the order of the initializedItemsList.\r\n     * @returns true if something changed and requires a redraw\r\n     */\r\n    private performZoom(deltaTimeInSeconds: number, domainSize: ISize): void {\r\n        this.updateZoomCenter(domainSize);\r\n\r\n        const newInitializedArray: PatternBase[] = [];\r\n\r\n        const zoomSpeed = 1 + deltaTimeInSeconds * Parameters.zoomSpeed;\r\n        for (const item of this.initializedItemsList) {\r\n            item.zoomIn(this.zoomCenter, zoomSpeed);\r\n\r\n            let visibility: EVisibility;\r\n            if (item.size > PatternBase.MAX_SIZE) {\r\n                visibility = EVisibility.OUT_OF_VIEW;\r\n            } else {\r\n                visibility = item.computeVisibility(domainSize);\r\n            }\r\n\r\n            if (visibility === EVisibility.VISIBLE) {\r\n                newInitializedArray.push(item);\r\n            } else {\r\n                this.uninitializedItemsList.push(item); // recycle item\r\n\r\n                if (visibility === EVisibility.COVERS_VIEW) {\r\n                    this.backgroundColorOverride = item.rawColor; // overrite current background to make the illusion that we are still in the item\r\n                    this.backgroundNestingLevel = item.nestingLevel % 2; // modulus to avoid rounding errors with higher nestings\r\n                    PatternBase.baseNestingLevel = this.backgroundNestingLevel;\r\n                }\r\n            }\r\n        }\r\n\r\n        this.initializedItemsList = newInitializedArray;\r\n    }\r\n\r\n    private computeBackgroundColor(): Color {\r\n        if (Parameters.highContrast) {\r\n            if (Parameters.blackBackground) {\r\n                return (this.backgroundNestingLevel % 2 === 0) ? Color.BLACK : Color.WHITE;\r\n            } else {\r\n                return (this.backgroundNestingLevel % 2 === 0) ? Color.WHITE : Color.BLACK;\r\n            }\r\n        } else {\r\n            if (this.backgroundColorOverride !== null) {\r\n                return this.backgroundColorOverride;\r\n            }\r\n            return Parameters.blackBackground ? Color.BLACK : Color.WHITE;\r\n        }\r\n    }\r\n\r\n    private updateZoomCenter(domainSize: ISize): void {\r\n        if (Page.Canvas.isMouseDown()) {\r\n            const mousePosition = Page.Canvas.getMousePosition(); // in [0,1]^2\r\n            this.zoomCenter.x = domainSize.width * (mousePosition[0] - 0.5);\r\n            this.zoomCenter.y = domainSize.height * (mousePosition[1] - 0.5);\r\n        }\r\n\r\n        const halfWidth = 0.5 * domainSize.width;\r\n        const halfHeight = 0.5 * domainSize.height;\r\n\r\n        if (this.zoomCenter.x < -halfWidth) {\r\n            this.zoomCenter.x = -halfWidth\r\n        } else if (this.zoomCenter.x > halfWidth) {\r\n            this.zoomCenter.x = halfWidth;\r\n        }\r\n\r\n        if (this.zoomCenter.y < -halfHeight) {\r\n            this.zoomCenter.y = -halfHeight\r\n        } else if (this.zoomCenter.y > halfHeight) {\r\n            this.zoomCenter.y = halfHeight;\r\n        }\r\n    }\r\n}\r\n\r\nexport { Engine }\r\n","import \"../page-interface-generated\";\r\n\r\nlet gl: WebGLRenderingContext = null;\r\n\r\n/** Initializes a WebGL context */\r\nfunction initGL(flags?: object): boolean {\r\n    function setError(message: string): void {\r\n        Page.Demopage.setErrorMessage(\"webgl-support\", message);\r\n    }\r\n\r\n    const canvas = Page.Canvas.getCanvas();\r\n\r\n    gl = canvas.getContext(\"webgl\", flags) as WebGLRenderingContext;\r\n    if (gl == null) {\r\n        gl = canvas.getContext(\"experimental-webgl\", flags) as WebGLRenderingContext;\r\n        if (gl == null) {\r\n            setError(\"Your browser or device does not seem to support WebGL.\");\r\n            return false;\r\n        }\r\n\r\n        setError(`Your browser or device only supports experimental WebGL.\r\nThe simulation may not run as expected.`);\r\n    }\r\n\r\n    gl.disable(gl.CULL_FACE);\r\n    gl.disable(gl.DEPTH_TEST);\r\n    gl.disable(gl.BLEND);\r\n    gl.clearColor(0, 0, 0, 1);\r\n\r\n    return true;\r\n}\r\n\r\n/* Adjusts the GL canvas size to the actual canvas element size on the page */\r\nfunction adjustSize(hidpi: boolean = false): void {\r\n    const cssPixel: number = (hidpi) ? window.devicePixelRatio : 1;\r\n\r\n    const canvas = gl.canvas as HTMLCanvasElement;\r\n\r\n    const width: number = Math.floor(canvas.clientWidth * cssPixel);\r\n    const height: number = Math.floor(canvas.clientHeight * cssPixel);\r\n    if (canvas.width !== width || canvas.height !== height) {\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n    }\r\n}\r\n\r\nexport {\r\n    adjustSize,\r\n    initGL,\r\n    gl,\r\n};\r\n","abstract class GLResource {\r\n    private _gl: WebGLRenderingContext;\r\n\r\n    constructor(gl: WebGLRenderingContext) {\r\n        this._gl = gl;\r\n    }\r\n\r\n    public gl(): WebGLRenderingContext {\r\n        return this._gl;\r\n    }\r\n\r\n    public abstract freeGLResources(): void;\r\n}\r\n\r\nexport { GLResource };\r\n","import { gl } from \"./gl-canvas\";\r\nimport { Shader } from \"./shader\";\r\nimport * as ShaderSources from \"./shader-sources\";\r\n\r\ntype RegisterCallback = (success: boolean, shader: Shader | null) => void;\r\n\r\ninterface IShaderInfos {\r\n    fragmentFilename: string;\r\n    vertexFilename: string;\r\n    injected: { [id: string]: string };\r\n}\r\n\r\ninterface ICachedShader {\r\n    shader: Shader | null;\r\n    infos: IShaderInfos;\r\n    pending: boolean;\r\n    failed: boolean;\r\n    callbacks: RegisterCallback[];\r\n}\r\n\r\nconst cachedShaders: { [id: string]: ICachedShader } = {};\r\n\r\nfunction getShader(name: string): Shader | null {\r\n    return cachedShaders[name].shader;\r\n}\r\n\r\ntype BuildCallback = (builtShader: Shader | null) => void;\r\n\r\nfunction buildShader(infos: IShaderInfos, callback: BuildCallback): void {\r\n    let sourcesPending = 2;\r\n    let sourcesFailed = 0;\r\n\r\n    function loadedSource(success: boolean): void {\r\n        function processSource(source: string): string {\r\n            return source.replace(/#INJECT\\((.*)\\)/mg, (match: string, name: string) => {\r\n                if (infos.injected[name]) {\r\n                    return infos.injected[name];\r\n                }\r\n                return match;\r\n            });\r\n        }\r\n\r\n        sourcesPending--;\r\n        if (!success) {\r\n            sourcesFailed++;\r\n        }\r\n\r\n        if (sourcesPending === 0) {\r\n            let shader = null;\r\n\r\n            if (sourcesFailed === 0) {\r\n                const vert = ShaderSources.getSource(infos.vertexFilename);\r\n                const frag = ShaderSources.getSource(infos.fragmentFilename);\r\n\r\n                const processedVert = processSource(vert);\r\n                const processedFrag = processSource(frag);\r\n\r\n                shader = new Shader(gl, processedVert, processedFrag);\r\n            }\r\n\r\n            callback(shader);\r\n        }\r\n    }\r\n\r\n    ShaderSources.loadSource(infos.vertexFilename, loadedSource);\r\n    ShaderSources.loadSource(infos.fragmentFilename, loadedSource);\r\n}\r\n\r\nfunction registerShader(name: string, infos: IShaderInfos, callback: RegisterCallback): void {\r\n    function callAndClearCallbacks(cached: ICachedShader): void {\r\n        for (const cachedCallback of cached.callbacks) {\r\n            cachedCallback(!cached.failed, cached.shader);\r\n        }\r\n\r\n        cached.callbacks = [];\r\n    }\r\n\r\n    if (typeof cachedShaders[name] === \"undefined\") {\r\n        cachedShaders[name] = {\r\n            callbacks: [callback],\r\n            failed: false,\r\n            infos,\r\n            pending: true,\r\n            shader: null,\r\n        };\r\n        const cached = cachedShaders[name];\r\n\r\n        buildShader(infos, (builtShader: Shader | null) => {\r\n            cached.pending = false;\r\n            cached.failed = builtShader === null;\r\n            cached.shader = builtShader;\r\n\r\n            callAndClearCallbacks(cached);\r\n        });\r\n    } else {\r\n        const cached = cachedShaders[name];\r\n\r\n        if (cached.pending === true) {\r\n            cached.callbacks.push(callback);\r\n        } else {\r\n            callAndClearCallbacks(cached);\r\n        }\r\n    }\r\n}\r\n\r\nfunction deleteShader(name: string): void {\r\n    if (typeof cachedShaders[name] !== \"undefined\") {\r\n        if (cachedShaders[name].shader !== null) {\r\n            cachedShaders[name].shader.freeGLResources();\r\n        }\r\n        delete cachedShaders[name];\r\n    }\r\n}\r\n\r\nexport {\r\n    buildShader,\r\n    getShader,\r\n    IShaderInfos,\r\n    registerShader,\r\n    deleteShader,\r\n};\r\n","type LoadCallback = (success: boolean)  => void;\r\n\r\ninterface ICachedSource {\r\n    text: string;\r\n    pending: boolean;\r\n    failed: boolean;\r\n    callbacks: LoadCallback[];\r\n}\r\n\r\nconst cachedSources: { [id: string]: ICachedSource } = {};\r\n\r\n/* Fetches asynchronously the shader source from server and stores it in cache. */\r\nfunction loadSource(filename: string, callback: LoadCallback): void {\r\n    function callAndClearCallbacks(cached: ICachedSource): void {\r\n        for (const cachedCallback of cached.callbacks) {\r\n            cachedCallback(!cached.failed);\r\n        }\r\n\r\n        cached.callbacks = [];\r\n    }\r\n\r\n    if (typeof cachedSources[filename] === \"undefined\") {\r\n        cachedSources[filename] = {\r\n            callbacks: [callback],\r\n            failed: false,\r\n            pending: true,\r\n            text: null,\r\n        };\r\n        const cached = cachedSources[filename];\r\n\r\n        const xhr = new XMLHttpRequest();\r\n        xhr.open(\"GET\", \"./shaders/\" + filename, true);\r\n        xhr.onload = () => {\r\n            if (xhr.readyState === 4) {\r\n                cached.pending = false;\r\n\r\n                if (xhr.status === 200) {\r\n                    cached.text = xhr.responseText;\r\n                    cached.failed = false;\r\n                } else {\r\n                    console.error(`Cannot load '${filename}' shader source: ${xhr.statusText}`);\r\n                    cached.failed = true;\r\n                }\r\n\r\n                callAndClearCallbacks(cached);\r\n            }\r\n        };\r\n        xhr.onerror = () => {\r\n            console.error(`Cannot load '${filename}' shader source: ${xhr.statusText}`);\r\n            cached.pending = false;\r\n            cached.failed = true;\r\n            callAndClearCallbacks(cached);\r\n        };\r\n\r\n        xhr.send(null);\r\n    } else {\r\n        const cached = cachedSources[filename];\r\n\r\n        if (cached.pending === true) {\r\n            cached.callbacks.push(callback);\r\n        } else {\r\n            cached.callbacks = [callback];\r\n            callAndClearCallbacks(cached);\r\n        }\r\n    }\r\n}\r\n\r\nfunction getSource(filename: string): string {\r\n    return cachedSources[filename].text;\r\n}\r\n\r\nexport {\r\n    getSource,\r\n    loadSource,\r\n};\r\n","import { GLResource } from \"./gl-resource\";\r\nimport { VBO } from \"./vbo\";\r\n\r\nfunction notImplemented(): void {\r\n    alert(\"NOT IMPLEMENTED YET\");\r\n}\r\n\r\nfunction bindUniformFloat(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number | number[]): void;\r\nfunction bindUniformFloat(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    if (Array.isArray(value)) {\r\n        gl.uniform1fv(location, value);\r\n    } else {\r\n        gl.uniform1f(location, value);\r\n    }\r\n}\r\n\r\nfunction bindUniformFloat2v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform2fv(location, value);\r\n}\r\n\r\nfunction bindUniformFloat3v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform3fv(location, value);\r\n}\r\n\r\nfunction bindUniformFloat4v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform4fv(location, value);\r\n}\r\n\r\nfunction bindUniformInt(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number | number[]): void;\r\nfunction bindUniformInt(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    if (Array.isArray(value)) {\r\n        gl.uniform1iv(location, value);\r\n    } else {\r\n        gl.uniform1iv(location, value);\r\n    }\r\n}\r\n\r\nfunction bindUniformInt2v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform2iv(location, value);\r\n}\r\n\r\nfunction bindUniformInt3v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform3iv(location, value);\r\n}\r\n\r\nfunction bindUniformInt4v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform4iv(location, value);\r\n}\r\n\r\nfunction bindUniformBool(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: boolean | number): void {\r\n    gl.uniform1i(location, +value);\r\n}\r\n\r\nfunction bindUniformBool2v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    gl.uniform2iv(location, value);\r\n}\r\n\r\nfunction bindUniformBool3v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    gl.uniform3iv(location, value);\r\n}\r\n\r\nfunction bindUniformBool4v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    gl.uniform4iv(location, value);\r\n}\r\n\r\nfunction bindUniformFloatMat2(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniformMatrix2fv(location, false, value);\r\n}\r\n\r\nfunction bindUniformFloatMat3(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniformMatrix3fv(location, false, value);\r\n}\r\n\r\nfunction bindUniformFloatMat4(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniformMatrix4fv(location, false, value);\r\n}\r\n\r\nfunction bindSampler2D(gl: WebGLRenderingContext, location: WebGLUniformLocation, unitNb: number,\r\n    value: WebGLTexture): void {\r\n    gl.uniform1i(location, unitNb);\r\n    gl.activeTexture((gl as any)[\"TEXTURE\" + unitNb] as number);\r\n    gl.bindTexture(gl.TEXTURE_2D, value);\r\n}\r\n\r\nfunction bindSamplerCube(gl: WebGLRenderingContext, location: WebGLUniformLocation, unitNb: number,\r\n    value: WebGLTexture): void {\r\n    gl.uniform1i(location, unitNb);\r\n    gl.activeTexture((gl as any)[\"TEXTURE\" + unitNb] as number);\r\n    gl.bindTexture(gl.TEXTURE_CUBE_MAP, value);\r\n}\r\n\r\n/* From WebGL spec:\r\n* http://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14 */\r\ninterface IBindingType {\r\n    str: string;\r\n    binder: (...args: any[]) => unknown;\r\n}\r\nconst types: { [index: string]: IBindingType } = {\r\n    0x8B50: { str: \"FLOAT_VEC2\", binder: bindUniformFloat2v },\r\n    0x8B51: { str: \"FLOAT_VEC3\", binder: bindUniformFloat3v },\r\n    0x8B52: { str: \"FLOAT_VEC4\", binder: bindUniformFloat4v },\r\n    0x8B53: { str: \"INT_VEC2\", binder: bindUniformInt2v },\r\n    0x8B54: { str: \"INT_VEC3\", binder: bindUniformInt3v },\r\n    0x8B55: { str: \"INT_VEC4\", binder: bindUniformInt4v },\r\n    0x8B56: { str: \"BOOL\", binder: bindUniformBool },\r\n    0x8B57: { str: \"BOOL_VEC2\", binder: bindUniformBool2v },\r\n    0x8B58: { str: \"BOOL_VEC3\", binder: bindUniformBool3v },\r\n    0x8B59: { str: \"BOOL_VEC4\", binder: bindUniformBool4v },\r\n    0x8B5A: { str: \"FLOAT_MAT2\", binder: bindUniformFloatMat2 },\r\n    0x8B5B: { str: \"FLOAT_MAT3\", binder: bindUniformFloatMat3 },\r\n    0x8B5C: { str: \"FLOAT_MAT4\", binder: bindUniformFloatMat4 },\r\n    0x8B5E: { str: \"SAMPLER_2D\", binder: bindSampler2D },\r\n    0x8B60: { str: \"SAMPLER_CUBE\", binder: bindSamplerCube },\r\n    0x1400: { str: \"BYTE\", binder: notImplemented },\r\n    0x1401: { str: \"UNSIGNED_BYTE\", binder: notImplemented },\r\n    0x1402: { str: \"SHORT\", binder: notImplemented },\r\n    0x1403: { str: \"UNSIGNED_SHORT\", binder: notImplemented },\r\n    0x1404: { str: \"INT\", binder: bindUniformInt },\r\n    0x1405: { str: \"UNSIGNED_INT\", binder: notImplemented },\r\n    0x1406: { str: \"FLOAT\", binder: bindUniformFloat },\r\n};\r\n\r\ninterface IShaderUniform {\r\n    value: boolean | boolean[] | number | number[] | WebGLTexture | WebGLTexture[];\r\n    loc: WebGLUniformLocation;\r\n    size: number;\r\n    type: number;\r\n}\r\n\r\ninterface IShaderAttribute {\r\n    VBO: VBO;\r\n    loc: GLint;\r\n    size: number;\r\n    type: number;\r\n}\r\n\r\nclass ShaderProgram extends GLResource {\r\n    public u: { [name: string]: IShaderUniform };\r\n    public a: { [name: string]: IShaderAttribute };\r\n\r\n    private id: WebGLProgram;\r\n    private uCount: number;\r\n    private aCount: number;\r\n\r\n    constructor(gl: WebGLRenderingContext, vertexSource: string, fragmentSource: string) {\r\n        function createShader(type: GLenum, source: string): WebGLShader {\r\n            const shader = gl.createShader(type);\r\n            gl.shaderSource(shader, source);\r\n            gl.compileShader(shader);\r\n\r\n            const compileSuccess = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n            if (!compileSuccess) {\r\n                console.error(gl.getShaderInfoLog(shader));\r\n                gl.deleteShader(shader);\r\n                return null;\r\n            }\r\n\r\n            return shader;\r\n        }\r\n\r\n        super(gl);\r\n\r\n        this.id = null;\r\n        this.uCount = 0;\r\n        this.aCount = 0;\r\n\r\n        const vertexShader = createShader(gl.VERTEX_SHADER, vertexSource);\r\n        const fragmentShader = createShader(gl.FRAGMENT_SHADER, fragmentSource);\r\n\r\n        const id = gl.createProgram();\r\n        gl.attachShader(id, vertexShader);\r\n        gl.attachShader(id, fragmentShader);\r\n        gl.linkProgram(id);\r\n\r\n        const linkSuccess = gl.getProgramParameter(id, gl.LINK_STATUS);\r\n        if (!linkSuccess) {\r\n            console.error(gl.getProgramInfoLog(id));\r\n            gl.deleteProgram(id);\r\n        } else {\r\n            this.id = id;\r\n\r\n            this.introspection();\r\n        }\r\n    }\r\n\r\n    public freeGLResources(): void {\r\n        super.gl().deleteProgram(this.id);\r\n        this.id = null;\r\n    }\r\n\r\n    public use(): void {\r\n        super.gl().useProgram(this.id);\r\n    }\r\n\r\n    public bindUniforms(): void {\r\n        const gl: WebGLRenderingContext = super.gl();\r\n        let currTextureUnitNb: number = 0;\r\n\r\n        Object.keys(this.u).forEach((uName: string) => {\r\n            const uniform = this.u[uName];\r\n            if (uniform.value !== null) {\r\n                if (uniform.type === 0x8B5E || uniform.type === 0x8B60) {\r\n                    const unitNb: number = currTextureUnitNb;\r\n                    types[uniform.type].binder(gl, uniform.loc, unitNb, uniform.value);\r\n                    currTextureUnitNb++;\r\n                } else {\r\n                    types[uniform.type].binder(gl, uniform.loc, uniform.value);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    public bindAttributes(): void {\r\n        Object.keys(this.a).forEach((aName: string) => {\r\n            const attribute = this.a[aName];\r\n            if (attribute.VBO !== null) {\r\n                attribute.VBO.bind(attribute.loc);\r\n            }\r\n        });\r\n    }\r\n\r\n    public bindUniformsAndAttributes(): void {\r\n        this.bindUniforms();\r\n        this.bindAttributes();\r\n    }\r\n\r\n    private introspection(): void {\r\n        const gl = super.gl();\r\n\r\n        this.uCount = gl.getProgramParameter(this.id, gl.ACTIVE_UNIFORMS);\r\n        this.u = {};\r\n        for (let i = 0; i < this.uCount; i++) {\r\n            const uniform = gl.getActiveUniform(this.id, i);\r\n            const name = uniform.name;\r\n\r\n            this.u[name] = {\r\n                loc: gl.getUniformLocation(this.id, name),\r\n                size: uniform.size,\r\n                type: uniform.type,\r\n                value: null,\r\n            };\r\n        }\r\n\r\n        this.aCount = gl.getProgramParameter(this.id, gl.ACTIVE_ATTRIBUTES);\r\n        this.a = {};\r\n        for (let i = 0; i < this.aCount; i++) {\r\n            const attribute = gl.getActiveAttrib(this.id, i);\r\n            const name = attribute.name;\r\n\r\n            this.a[name] = {\r\n                VBO: null,\r\n                loc: gl.getAttribLocation(this.id, name),\r\n                size: attribute.size,\r\n                type: attribute.type,\r\n            };\r\n        }\r\n    }\r\n}\r\n\r\nexport { ShaderProgram as Shader };\r\n","import { GLResource } from \"./gl-resource\";\r\n\r\nenum Usage {\r\n    DYNAMIC,\r\n    STATIC,\r\n}\r\n\r\nclass VBO extends GLResource {\r\n    public static createQuad(gl: WebGLRenderingContext, minX: number, minY: number, maxX: number, maxY: number): VBO {\r\n        const vert = [\r\n            minX, minY,\r\n            maxX, minY,\r\n            minX, maxY,\r\n            maxX, maxY,\r\n        ];\r\n\r\n        return new VBO(gl, new Float32Array(vert), 2, gl.FLOAT, true);\r\n    }\r\n\r\n    private id: WebGLBuffer;\r\n    private size: number;\r\n    private type: GLenum;\r\n    private normalize: GLboolean;\r\n    private stride: GLsizei;\r\n    private offset: GLintptr;\r\n    private usage: Usage;\r\n\r\n    constructor(gl: WebGLRenderingContext, array: any, size: number, type: GLenum, staticUsage: boolean = true) {\r\n        super(gl);\r\n\r\n        this.id = gl.createBuffer();\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.id);\r\n        if (staticUsage) {\r\n            gl.bufferData(gl.ARRAY_BUFFER, array, gl.STATIC_DRAW);\r\n        } else {\r\n            gl.bufferData(gl.ARRAY_BUFFER, array, gl.DYNAMIC_DRAW);\r\n        }\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n\r\n        this.size = size;\r\n        this.type = type;\r\n        this.normalize = false;\r\n        this.stride = 0;\r\n        this.offset = 0;\r\n        this.usage = (staticUsage) ? Usage.STATIC : Usage.DYNAMIC;\r\n    }\r\n\r\n    public freeGLResources(): void {\r\n        this.gl().deleteBuffer(this.id);\r\n        this.id = null;\r\n    }\r\n\r\n    public bind(location: GLuint): void {\r\n        const gl = super.gl();\r\n        gl.enableVertexAttribArray(location);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.id);\r\n        gl.vertexAttribPointer(location, this.size, this.type, this.normalize, this.stride, this.offset);\r\n    }\r\n\r\n    public bindInstanced(location: GLuint, ext: ANGLE_instanced_arrays, divisor: number): void {\r\n        const gl = super.gl();\r\n        gl.enableVertexAttribArray(location);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.id);\r\n        gl.vertexAttribPointer(location, this.size, this.type, this.normalize, this.stride, this.offset);\r\n        ext.vertexAttribDivisorANGLE(location, divisor);\r\n    }\r\n\r\n    public setData(array: any): void {\r\n        const gl = super.gl();\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.id);\r\n        if (this.usage === Usage.STATIC) {\r\n            gl.bufferData(gl.ARRAY_BUFFER, array, gl.STATIC_DRAW);\r\n        } else {\r\n            gl.bufferData(gl.ARRAY_BUFFER, array, gl.DYNAMIC_DRAW);\r\n        }\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n    }\r\n}\r\n\r\nexport { VBO };\r\n","import { Engine } from \"./engine\";\r\n\r\nimport { Parameters } from \"./parameters\";\r\n\r\nimport { PlotterCanvas2D } from \"./plotter/plotter-canvas-2d\";\r\nimport { PlotterCanvasWebGL } from \"./plotter/plotter-canvas-webgl\";\r\nimport { PlotterSVG } from \"./plotter/plotter-svg\";\r\n\r\nimport * as Statistics from \"./statistics/statistics\";\r\n\r\nimport * as Helper from \"./utils/helper\";\r\n\r\nimport { mainDebugCollisions } from \"./debug-collisions\";\r\n\r\nimport \"./page-interface-generated\";\r\n\r\nfunction main(): void {\r\n    const canvasPlotter = Parameters.isWebGLVersion ? new PlotterCanvasWebGL() : new PlotterCanvas2D();\r\n\r\n    const engine = new Engine();\r\n\r\n    let needToRedraw = true;\r\n\r\n    Parameters.addRedrawObserver(() => needToRedraw = true);\r\n    Parameters.addClearObserver(() => {\r\n        engine.reset();\r\n        needToRedraw = true;\r\n    });\r\n\r\n    Parameters.addDownloadObserver(() => {\r\n        const svgPlotter = new PlotterSVG(canvasPlotter.size);\r\n        engine.draw(svgPlotter);\r\n\r\n        const fileName = \"packing.svg\";\r\n        const svgString = svgPlotter.export();\r\n        Helper.downloadTextFile(fileName, svgString);\r\n    });\r\n\r\n    let lastRunTime = 0;\r\n    Statistics.initialize();\r\n    engine.reset();\r\n    function mainLoop(time: number): void {\r\n        Statistics.timeSpentInMainLoop.start();\r\n\r\n        const deltaTimeInSeconds = 0.001 * (time - lastRunTime);\r\n        lastRunTime = time;\r\n\r\n        const wantedItemsCount = 1000 * Parameters.quantity;\r\n        engine.setItemsCount(wantedItemsCount);\r\n\r\n        Statistics.timeSpentInUpdate.start();\r\n        const updateChangedSomething = engine.udpate(deltaTimeInSeconds, canvasPlotter.size);\r\n        needToRedraw = needToRedraw || updateChangedSomething;\r\n        Statistics.timeSpentInUpdate.stop();\r\n\r\n        if (needToRedraw) {\r\n            Statistics.timeSpentInDraw.start();\r\n            const successfulDraw = engine.draw(canvasPlotter);\r\n            Statistics.timeSpentInDraw.stop();\r\n\r\n            needToRedraw = !successfulDraw;\r\n        }\r\n\r\n        Statistics.timeSpentInMainLoop.stop();\r\n        Statistics.registerFrame();\r\n        requestAnimationFrame(mainLoop);\r\n    }\r\n    requestAnimationFrame(mainLoop);\r\n}\r\n\r\nif (Parameters.isInCollisionsDebug) {\r\n    mainDebugCollisions();\r\n} else {\r\n    main();\r\n}\r\n","import * as Helpers from \"./utils/helper\";\r\n\r\nimport \"./page-interface-generated\";\r\n\r\nconst controlId = {\r\n    PRIMITIVE: \"primitive-tab-id\",\r\n    RESET: \"reset-button-id\",\r\n    SPACING: \"spacing-range-id\",\r\n    MIN_SIZE: \"min-size-range-id\",\r\n    ALLOW_OVERLAPPING: \"allow-overlapping-checkbox-id\",\r\n    QUANTITY: \"quantity-range-id\",\r\n    ZOOM_SPEED: \"zoom-speed-range-id\",\r\n    BACKGROUND: \"background-tab-id\",\r\n    BLENDING: \"blending-checkbox-id\",\r\n    HIGH_CONTRAST: \"high-contrast-checkbox-id\",\r\n    INDICATORS: \"indicators-checkbox-id\",\r\n\r\n    // DEBUG\r\n    MAX_TRIES_PER_FRAME: \"max-tries-per-frame-range-id\",\r\n    INSTANCING: \"instancing-checkbox-id\",\r\n    ADAPTATIVE_GRID: \"adaptative-grid-checkbox-id\",\r\n    TARGET_ITEMS_PER_GRIDCELL: \"target-items-per-gridcell-checkbox-id\",\r\n    CELL_SIZE: \"cell-size-range-id\",\r\n    ONE_CELL_ONLY: \"one-cell-only-checkbox-id\",\r\n    SHOW_GRID: \"show-grid-checkbox-id\",\r\n    CELL_X: \"cell-x-range-id\",\r\n    CELL_Y: \"cell-y-range-id\",\r\n    COLLISION_TEST_TYPE: \"collision-test-type-tab-id\",\r\n\r\n    DOWNLOAD: \"result-download-id\",\r\n};\r\n\r\ntype RedrawObserver = () => unknown;\r\nconst redrawObservers: RedrawObserver[] = [];\r\nfunction triggerRedraw(): void {\r\n    for (const observer of redrawObservers) {\r\n        observer();\r\n    }\r\n}\r\nPage.Canvas.Observers.canvasResize.push(triggerRedraw);\r\nPage.Checkbox.addObserver(controlId.ALLOW_OVERLAPPING, triggerRedraw);\r\nPage.Tabs.addObserver(controlId.BACKGROUND, triggerRedraw);\r\nPage.Checkbox.addObserver(controlId.HIGH_CONTRAST, triggerRedraw);\r\nPage.Checkbox.addObserver(controlId.ONE_CELL_ONLY, triggerRedraw);\r\nPage.Checkbox.addObserver(controlId.SHOW_GRID, triggerRedraw);\r\nPage.Checkbox.addObserver(controlId.INSTANCING, triggerRedraw);\r\nPage.Range.addObserver(controlId.QUANTITY, triggerRedraw);\r\nPage.Range.addObserver(controlId.CELL_X, triggerRedraw);\r\nPage.Range.addObserver(controlId.CELL_Y, triggerRedraw);\r\n\r\ntype ClearObserver = () => unknown;\r\nconst clearObservers: ClearObserver[] = [];\r\nfunction triggerClear(): void {\r\n    for (const observer of clearObservers) {\r\n        observer();\r\n    }\r\n}\r\nPage.Button.addObserver(controlId.RESET, triggerClear);\r\nPage.Tabs.addObserver(controlId.PRIMITIVE, triggerClear);\r\nPage.Range.addObserver(controlId.SPACING, () => {\r\n    if (!Parameters.isZooming) {\r\n        triggerClear();\r\n    }\r\n});\r\nPage.Range.addObserver(controlId.MIN_SIZE, () => {\r\n    if (!Parameters.isZooming) {\r\n        triggerClear();\r\n    }\r\n});\r\n\r\nenum EPrimitive {\r\n    SQUARE = \"square\",\r\n    CIRCLE = \"circle\",\r\n    RECTANGLE = \"rectangle\",\r\n    TRIANGLE = \"triangle\",\r\n}\r\n\r\nenum ECollisionTestType {\r\n    PRIMITIVE = \"primitive\",\r\n    POINT = \"point\",\r\n    VISIBILITY = \"visbility\",\r\n}\r\n\r\nconst isInDebug = Helpers.getQueryStringValue(\"debug\") === \"1\";\r\nconst isInCollisionsDebug = Helpers.getQueryStringValue(\"debug-collisions\") === \"1\";\r\nPage.Sections.setVisibility(\"display-section\", !isInCollisionsDebug);\r\nPage.Sections.setVisibility(\"debug-section\", isInDebug && !isInCollisionsDebug);\r\nPage.Sections.setVisibility(\"debug-collisions-section\", isInDebug && isInCollisionsDebug);\r\nPage.Canvas.setIndicatorVisibility(\"main-loop-time\", isInDebug);\r\nPage.Canvas.setIndicatorVisibility(\"draw-time\", isInDebug);\r\nPage.Canvas.setIndicatorVisibility(\"update-time\", isInDebug);\r\nPage.Canvas.setIndicatorVisibility(\"update-reindex-time\", isInDebug);\r\nPage.Canvas.setIndicatorVisibility(\"update-recycle-time\", isInDebug);\r\nPage.Canvas.setIndicatorVisibility(\"update-zoom-time\", isInDebug);\r\nPage.Canvas.setIndicatorVisibility(\"items-reclycled-count\", isInDebug);\r\nPage.Canvas.setIndicatorVisibility(\"items-pending-recycling-count\", isInDebug);\r\nPage.Canvas.setIndicatorVisibility(\"items-recycling-tries-count\", isInDebug);\r\nPage.Canvas.setIndicatorVisibility(\"grid-size\", isInDebug);\r\nPage.Canvas.setIndicatorVisibility(\"grid-cell-size\", isInDebug);\r\nPage.Canvas.setIndicatorVisibility(\"grid-items-per-cell\", isInDebug);\r\n\r\nif (isInDebug) {\r\n    Page.Checkbox.setChecked(controlId.INDICATORS, true);\r\n} else {\r\n    Page.Checkbox.setChecked(controlId.ONE_CELL_ONLY, false);\r\n    Page.Checkbox.setChecked(controlId.SHOW_GRID, false);\r\n}\r\n\r\nconst isWebGLVersion = Helpers.getQueryStringValue(\"webgl\") !== \"0\";\r\nif (!isWebGLVersion) {\r\n    Page.Checkbox.setChecked(controlId.BLENDING, false);\r\n    Page.Controls.setVisibility(controlId.BLENDING, false);\r\n    Page.Controls.setVisibility(controlId.INSTANCING, false);\r\n}\r\n\r\nfunction updateIndicatorsVisibility(): void {\r\n    const visible = !isInCollisionsDebug && Page.Checkbox.isChecked(controlId.INDICATORS);\r\n    Page.Canvas.setIndicatorsVisibility(visible);\r\n}\r\nPage.Checkbox.addObserver(controlId.INDICATORS, updateIndicatorsVisibility);\r\nupdateIndicatorsVisibility();\r\n\r\nfunction updateGridControlsVisibility(): void {\r\n    const adaptative = Page.Checkbox.isChecked(controlId.ADAPTATIVE_GRID);\r\n    Page.Controls.setVisibility(controlId.TARGET_ITEMS_PER_GRIDCELL, adaptative);\r\n    Page.Controls.setVisibility(controlId.CELL_SIZE, !adaptative);\r\n}\r\nPage.Checkbox.addObserver(controlId.ADAPTATIVE_GRID, updateGridControlsVisibility);\r\nupdateGridControlsVisibility();\r\n\r\nPage.Button.addObserver(\"debug-collisions-button-id\", () => {\r\n    window.location.href = window.location.href + \"&debug-collisions=1\";\r\n});\r\n\r\nabstract class Parameters {\r\n    public static get quantity(): number {\r\n        return Page.Range.getValue(controlId.QUANTITY);\r\n    }\r\n\r\n    public static get spacing(): number {\r\n        return Page.Range.getValue(controlId.SPACING);\r\n    }\r\n\r\n    public static get minSize(): number {\r\n        return Page.Range.getValue(controlId.MIN_SIZE);\r\n    }\r\n\r\n    public static get allowOverlapping(): boolean {\r\n        return Page.Checkbox.isChecked(controlId.ALLOW_OVERLAPPING);\r\n    }\r\n\r\n    public static get primitive(): EPrimitive {\r\n        return Page.Tabs.getValues(controlId.PRIMITIVE)[0] as EPrimitive;\r\n    }\r\n\r\n    public static get zoomSpeed(): number {\r\n        return Page.Range.getValue(controlId.ZOOM_SPEED);\r\n    }\r\n    public static get isZooming(): boolean {\r\n        return Math.abs(Parameters.zoomSpeed) > .001; // avoid float precision issues\r\n    }\r\n\r\n    public static get blackBackground(): boolean {\r\n        return Page.Tabs.getValues(controlId.BACKGROUND)[0] === \"dark\";\r\n    }\r\n\r\n    public static get blending(): boolean {\r\n        return Page.Checkbox.isChecked(controlId.BLENDING);\r\n    }\r\n\r\n    public static get highContrast(): boolean {\r\n        return Page.Checkbox.isChecked(controlId.HIGH_CONTRAST);\r\n    }\r\n\r\n    public static get isInDebug(): boolean {\r\n        return isInDebug;\r\n    }\r\n    public static get isInCollisionsDebug(): boolean {\r\n        return isInCollisionsDebug;\r\n    }\r\n    public static get isWebGLVersion(): boolean {\r\n        return isWebGLVersion;\r\n    }\r\n\r\n    /* === DEBUG SECTION === */\r\n\r\n    public static get maxTriesPerFrame(): number {\r\n        return 100 * Page.Range.getValue(controlId.MAX_TRIES_PER_FRAME);\r\n    }\r\n    public static get adaptativeGrid(): boolean {\r\n        return Page.Checkbox.isChecked(controlId.ADAPTATIVE_GRID);\r\n    }\r\n    public static get targetItemsPerGridCell(): number {\r\n        return Page.Range.getValue(controlId.TARGET_ITEMS_PER_GRIDCELL);\r\n    }\r\n    public static get cellSize(): number {\r\n        return Page.Range.getValue(controlId.CELL_SIZE);\r\n    }\r\n    public static get oneCellOnly(): boolean {\r\n        return Page.Checkbox.isChecked(controlId.ONE_CELL_ONLY);\r\n    }\r\n    public static get showGrid(): boolean {\r\n        return Page.Checkbox.isChecked(controlId.SHOW_GRID);\r\n    }\r\n    public static get cellX(): number {\r\n        return Page.Range.getValue(controlId.CELL_X);\r\n    }\r\n    public static get cellY(): number {\r\n        return Page.Range.getValue(controlId.CELL_Y);\r\n    }\r\n\r\n    public static get useInstancing(): boolean {\r\n        return Page.Checkbox.isChecked(controlId.INSTANCING);\r\n    }\r\n    public static disallowInstancing(): void {\r\n        Page.Checkbox.setChecked(controlId.INSTANCING, false);\r\n        Page.Controls.setVisibility(controlId.INSTANCING, false);\r\n    }\r\n\r\n    public static get currentCollisionType(): ECollisionTestType {\r\n        return Page.Tabs.getValues(controlId.COLLISION_TEST_TYPE)[0] as ECollisionTestType;\r\n    }\r\n\r\n    public static addRedrawObserver(callback: RedrawObserver): void {\r\n        redrawObservers.push(callback);\r\n    }\r\n\r\n    public static addClearObserver(callback: ClearObserver): void {\r\n        clearObservers.push(callback);\r\n    }\r\n\r\n    public static addDownloadObserver(callback: () => unknown): void {\r\n        Page.FileControl.addDownloadObserver(controlId.DOWNLOAD, callback);\r\n    }\r\n}\r\n\r\nexport { Parameters, EPrimitive, ECollisionTestType }\r\n","import { Color } from \"../color/color\";\r\nimport { IPoint } from \"../utils/i-point\";\r\nimport { ISize } from \"../utils/i-size\";\r\n\r\nimport { Grid } from \"../space-grid/grid\";\r\n\r\nimport { NumberRange } from \"../utils/number-range\";\r\nimport { Parameters } from \"../parameters\";\r\n\r\nconst CANVAS_CENTER: IPoint = { x: 0, y: 0 };\r\n\r\nconst MAX_TEST_ID = 999999999999; // lower (for extra safety) than Number.MAX_SAFE_INTEGER (which is not supported by IE11)\r\nlet globalLastTestId = 1;\r\n\r\nfunction generateTestId(): number {\r\n    globalLastTestId = (globalLastTestId + 1) % MAX_TEST_ID;\r\n    return globalLastTestId;\r\n}\r\n\r\ninterface IPatternResetResult {\r\n    success: boolean;\r\n    nbTries: number;\r\n}\r\n\r\ninterface ISizeComputationResult {\r\n    size: number;\r\n    isInside: boolean;\r\n}\r\n\r\nenum EVisibility {\r\n    VISIBLE = 0,\r\n    OUT_OF_VIEW = 1,\r\n    COVERS_VIEW = 2,\r\n}\r\n\r\nabstract class PatternBase {\r\n    public static baseNestingLevel: number = 0;\r\n    public static additionalNestingLevelForColor: number = 0;\r\n    public static highContrastColor: boolean = false;\r\n\r\n\r\n    /* When an item is too big, it can lead to visual glitches due to float precision issue on GPU.\r\n     *  To avoid this, remove items that are too big. */\r\n    public static readonly MAX_SIZE: number = 1000000;\r\n\r\n    private static readonly MAX_SIZE_LOWER: number = 0.75 * PatternBase.MAX_SIZE;\r\n    private static readonly MAX_SIZE_GAP: number = PatternBase.MAX_SIZE - PatternBase.MAX_SIZE_LOWER;\r\n\r\n    public static get maxBlendingTime(): number {\r\n        if (Parameters.blending) {\r\n            return 500 / (1 + Parameters.zoomSpeed);\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    public center: IPoint;\r\n    public size: number;\r\n    public nestingLevel: number;\r\n    public readonly rawColor: Color;\r\n\r\n    private lastTestId: number;\r\n    private initializationTime: number;\r\n\r\n    protected constructor() {\r\n        this.center = { x: 0, y: 0 };\r\n        this.size = 0;\r\n        this.nestingLevel = PatternBase.baseNestingLevel + 1;\r\n        this.rawColor = Color.random();\r\n        this.lastTestId = 0;\r\n    }\r\n\r\n    public get color(): Color {\r\n        if (PatternBase.highContrastColor) {\r\n            return ((this.nestingLevel + PatternBase.additionalNestingLevelForColor) % 2 === 0) ? Color.BLACK : Color.WHITE;\r\n        }\r\n        return this.rawColor;\r\n    }\r\n\r\n    public zoomIn(zoomCenter: IPoint, zoomFactor: number): void {\r\n        this.center.x = (this.center.x - zoomCenter.x) * zoomFactor + zoomCenter.x;\r\n        this.center.y = (this.center.y - zoomCenter.y) * zoomFactor + zoomCenter.y;\r\n        this.size *= zoomFactor;\r\n    }\r\n\r\n    /** @returns the number of tries (regardless of the success of the reset) */\r\n    public reset(domainSize: ISize, grid: Grid, sizeFactor: number, acceptedSizes: NumberRange, allowOverlapping: boolean, maxTries: number): IPatternResetResult {\r\n        const result: IPatternResetResult = {\r\n            nbTries: 0,\r\n            success: false,\r\n        };\r\n\r\n        while (result.nbTries < maxTries && !result.success) {\r\n            this.randomizePosition(domainSize);\r\n            this.nestingLevel = PatternBase.baseNestingLevel + 1;\r\n\r\n            const maxSize = sizeFactor * this.computeBiggestSizePossible(grid, allowOverlapping);\r\n            if (acceptedSizes.isInRange(maxSize)) {\r\n                this.size = 2 * Math.floor(0.5 * maxSize); // need to be even to avoid aliasing\r\n                this.initializationTime = performance.now();\r\n                result.success = true;\r\n            }\r\n\r\n            result.nbTries++;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    public computeOpacity(time: number, blendTime: number): number {\r\n        if (this.size > PatternBase.MAX_SIZE_LOWER) {\r\n            const r = (this.size - PatternBase.MAX_SIZE_LOWER) / PatternBase.MAX_SIZE_GAP;\r\n            return (r > 1) ? 0 : 1 - r;\r\n        }\r\n\r\n        const lifetime = time - this.initializationTime;\r\n        if (lifetime > blendTime) {\r\n            return 1;\r\n        }\r\n        return lifetime / blendTime;\r\n    }\r\n\r\n    protected abstract computeBiggestSizePossibleToAvoidPoint(pointToAvoid: IPoint): number;\r\n\r\n    protected abstract computeBiggestSizePossibleToAvoidItem(itemsToAvoid: PatternBase, allowOverlapping: boolean): ISizeComputationResult;\r\n\r\n    public abstract computeVisibility(domainSize: ISize): EVisibility;\r\n\r\n    private computeBiggestSizePossible(grid: Grid, allowOverlapping: boolean): number {\r\n        const currentTestId = generateTestId();\r\n\r\n        const biggestSizeToAvoidCenter = this.computeBiggestSizePossibleToAvoidPoint(CANVAS_CENTER);\r\n        let rawMaxSize = biggestSizeToAvoidCenter;\r\n\r\n        // first, test only existing items that are in the exact same grid cell as us\r\n        const maxDistanceDetectableByExactCell = grid.getDistanceToClosestBorder(this.center);\r\n\r\n        const exactCellId = grid.getCellId(this.center);\r\n        const existingItemsFromExactCell = grid.getItemsFromCell(exactCellId.x, exactCellId.y);\r\n        const biggestSizeToAvoidClosestItems = this.computeBiggestSizePossibleToAvoidItems(existingItemsFromExactCell, allowOverlapping, currentTestId);\r\n        rawMaxSize = Math.min(rawMaxSize, biggestSizeToAvoidClosestItems);\r\n\r\n        // the closest items were maybe not enough, test items that are a bit further\r\n        if (rawMaxSize >= maxDistanceDetectableByExactCell) {\r\n            const topLeftPoint: IPoint = { x: this.center.x - 0.5 * rawMaxSize, y: this.center.y - 0.5 * rawMaxSize };\r\n            const bottomRightPoint: IPoint = { x: this.center.x + 0.5 * rawMaxSize, y: this.center.y + 0.5 * rawMaxSize };\r\n            const minCellId = grid.getCellId(topLeftPoint);\r\n            const maxCellId = grid.getCellId(bottomRightPoint);\r\n\r\n            const additionalItemsToTest = grid.getItemsFromCellsGroup(minCellId.x, minCellId.y, maxCellId.x, maxCellId.y);\r\n            const biggestSizeToAvoidFurtherItems = this.computeBiggestSizePossibleToAvoidItems(additionalItemsToTest, allowOverlapping, currentTestId);\r\n            rawMaxSize = Math.min(rawMaxSize, biggestSizeToAvoidFurtherItems);\r\n        }\r\n\r\n        return rawMaxSize;\r\n    }\r\n\r\n    private computeBiggestSizePossibleToAvoidItems(itemsToAvoid: PatternBase[], allowOverlapping: boolean, currentTestId: number): number {\r\n        let maxSize = 100000;\r\n\r\n        for (const item of itemsToAvoid) {\r\n            if (item !== this) {\r\n                const testedAlready = (item.lastTestId === currentTestId);\r\n                if (!testedAlready) {\r\n                    const result = this.computeBiggestSizePossibleToAvoidItem(item, allowOverlapping);\r\n                    if (result.size < maxSize) {\r\n                        maxSize = result.size;\r\n\r\n                        if (result.isInside) {\r\n                            this.nestingLevel = item.nestingLevel + 1;\r\n                        }\r\n                    }\r\n                    item.lastTestId = currentTestId;\r\n                }\r\n            }\r\n        }\r\n\r\n        return maxSize;\r\n    }\r\n\r\n    private randomizePosition(domainSize: ISize): void {\r\n        this.center.x = Math.round(domainSize.width * (Math.random() - 0.5));\r\n        this.center.y = Math.round(domainSize.height * (Math.random() - 0.5));\r\n    }\r\n}\r\n\r\nexport { PatternBase, EVisibility, ISizeComputationResult }\r\n","import { EVisibility, ISizeComputationResult, PatternBase } from \"./pattern-base\";\r\n\r\nimport { IPoint } from \"../utils/i-point\";\r\nimport { ISize } from \"../utils/i-size\";\r\n\r\nclass PatternCircle extends PatternBase {\r\n    public constructor() {\r\n        super();\r\n    }\r\n\r\n    protected computeBiggestSizePossibleToAvoidPoint(pointToAvoid: IPoint): number {\r\n        const toPointX = pointToAvoid.x - this.center.x;\r\n        const toPointY = pointToAvoid.y - this.center.y;\r\n        return 2 * Math.sqrt(toPointX * toPointX + toPointY * toPointY);\r\n    }\r\n\r\n    protected computeBiggestSizePossibleToAvoidItem(itemToAvoid: PatternCircle, allowOverlapping: boolean): ISizeComputationResult {\r\n        const result = { size: 0, isInside: false };\r\n\r\n        const toCenterX = this.center.x - itemToAvoid.center.x;\r\n        const toCenterY = this.center.y - itemToAvoid.center.y;\r\n\r\n        const distance = Math.sqrt(toCenterX * toCenterX + toCenterY * toCenterY);\r\n\r\n        if (distance <= itemToAvoid.radius) {\r\n            if (allowOverlapping) {\r\n                result.size = 2 * (itemToAvoid.radius - distance);\r\n                result.isInside = true;\r\n            }\r\n        } else {\r\n            result.size = 2 * (distance - itemToAvoid.radius);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    public computeVisibility(domainSize: ISize): EVisibility {\r\n        const halfDomainWidth = 0.5 * domainSize.width;\r\n        const halfDomainHeight = 0.5 * domainSize.height;\r\n\r\n        const absX = Math.abs(this.center.x);\r\n        const absY = Math.abs(this.center.y);\r\n\r\n        const dX = absX + halfDomainWidth;\r\n        const dY = absY + halfDomainHeight;\r\n\r\n        const radius = this.radius;\r\n        if (radius * radius > dX * dX + dY * dY) {\r\n            return EVisibility.COVERS_VIEW;\r\n        }\r\n        if (absX - radius < halfDomainWidth && absY - radius < halfDomainHeight) {\r\n            return EVisibility.VISIBLE;\r\n        }\r\n        return EVisibility.OUT_OF_VIEW;\r\n    }\r\n\r\n    public get radius(): number {\r\n        return 0.5 * this.size;\r\n    }\r\n}\r\n\r\nexport { PatternCircle }\r\n","import { EVisibility, ISizeComputationResult, PatternBase } from \"./pattern-base\";\r\n\r\nimport { IPoint } from \"../utils/i-point\";\r\nimport { ISize } from \"../utils/i-size\";\r\n\r\nconst ASPECT_RATIO_VARIATION = 0.5; // must be in [0,1]\r\n\r\nclass PatternRectangle extends PatternBase {\r\n    private readonly baseWidth: number; // in [0,1]\r\n    private readonly baseHeight: number; // in [0,1]\r\n    public readonly aspectRatio: number;\r\n\r\n    public constructor() {\r\n        super();\r\n\r\n        this.aspectRatio = 1 + ASPECT_RATIO_VARIATION * (2 * Math.random() - 1);\r\n        if (this.aspectRatio >= 1) {\r\n            this.baseWidth = 1;\r\n            this.baseHeight = 1 / this.aspectRatio;\r\n        } else {\r\n            this.baseWidth = this.aspectRatio;\r\n            this.baseHeight = 1;\r\n        }\r\n    }\r\n\r\n    protected computeBiggestSizePossibleToAvoidPoint(pointToAvoid: IPoint): number {\r\n        const toPointX = pointToAvoid.x - this.center.x;\r\n        const toPointY = pointToAvoid.y - this.center.y;\r\n\r\n        const maxSizeX = Math.abs(toPointX) / this.baseWidth;\r\n        const maxSizeY = Math.abs(toPointY) / this.baseHeight;\r\n        return 2 * Math.max(maxSizeX, maxSizeY);\r\n    }\r\n\r\n    protected computeBiggestSizePossibleToAvoidItem(itemToAvoid: PatternRectangle, allowOverlapping: boolean): ISizeComputationResult {\r\n        const result = { size: 0, isInside: false };\r\n\r\n        const deltaX = Math.abs(this.center.x - itemToAvoid.center.x);\r\n        const deltaY = Math.abs(this.center.y - itemToAvoid.center.y);\r\n\r\n        const halfObstacleWidth = 0.5 * itemToAvoid.width;\r\n        const halfObstacleHeight = 0.5 * itemToAvoid.height;\r\n\r\n        if (deltaX < halfObstacleWidth) {\r\n            if (deltaY < halfObstacleHeight) {\r\n                if (allowOverlapping) {\r\n                    result.size = 2 * Math.min((halfObstacleWidth - deltaX) / this.baseWidth, (halfObstacleHeight - deltaY) / this.baseHeight);\r\n                    result.isInside = true;\r\n                }\r\n            } else {\r\n                result.size = 2 * (deltaY - halfObstacleHeight) / this.baseHeight;\r\n            }\r\n        } else {\r\n            if (deltaY < halfObstacleHeight) {\r\n                result.size = 2 * (deltaX - halfObstacleWidth) / this.baseWidth;\r\n            } else {\r\n                result.size = 2 * Math.max((deltaX - halfObstacleWidth) / this.baseWidth, (deltaY - halfObstacleHeight) / this.baseHeight);\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    public computeVisibility(domainSize: ISize): EVisibility {\r\n        const halfDomainWidth = 0.5 * domainSize.width;\r\n        const halfDomainHeight = 0.5 * domainSize.height;\r\n\r\n        const absX = Math.abs(this.center.x);\r\n        const absY = Math.abs(this.center.y);\r\n\r\n        const halfWidth = 0.5 * this.size * this.baseWidth;\r\n        const halfHeight = 0.5 * this.size * this.baseHeight;\r\n\r\n        if (absX + halfDomainWidth < halfWidth && absY + halfDomainHeight < halfHeight) {\r\n            return EVisibility.COVERS_VIEW;\r\n        }\r\n        if (absX - halfWidth < halfDomainWidth && absY - halfHeight < halfDomainHeight) {\r\n            return EVisibility.VISIBLE;\r\n        }\r\n        return EVisibility.OUT_OF_VIEW;\r\n    }\r\n\r\n    public get width(): number {\r\n        return this.size * this.baseWidth;\r\n    }\r\n\r\n    public get height(): number {\r\n        return this.size * this.baseHeight;\r\n    }\r\n}\r\n\r\nexport { PatternRectangle }\r\n","import { EVisibility, ISizeComputationResult, PatternBase } from \"./pattern-base\";\r\n\r\nimport { IPoint } from \"../utils/i-point\";\r\nimport { ISize } from \"../utils/i-size\";\r\n\r\nclass PatternSquare extends PatternBase {\r\n    public constructor() {\r\n        super();\r\n    }\r\n\r\n    protected computeBiggestSizePossibleToAvoidPoint(pointToAvoid: IPoint): number {\r\n        const toPointX = pointToAvoid.x - this.center.x;\r\n        const toPointY = pointToAvoid.y - this.center.y;\r\n\r\n        const maxSizeX = Math.abs(toPointX);\r\n        const maxSizeY = Math.abs(toPointY);\r\n        return 2 * Math.max(maxSizeX, maxSizeY);\r\n    }\r\n\r\n    protected computeBiggestSizePossibleToAvoidItem(itemToAvoid: PatternSquare, allowOverlapping: boolean): ISizeComputationResult {\r\n        const result = { size: 0, isInside: false };\r\n\r\n        const deltaX = Math.abs(this.center.x - itemToAvoid.center.x);\r\n        const deltaY = Math.abs(this.center.y - itemToAvoid.center.y);\r\n        const halfSideLength = 0.5 * itemToAvoid.sideLength;\r\n\r\n        if (deltaX < halfSideLength) {\r\n            if (deltaY < halfSideLength) {\r\n                if (allowOverlapping) {\r\n                    result.size = 2 * Math.min(halfSideLength - deltaX, halfSideLength - deltaY);\r\n                    result.isInside = true;\r\n                }\r\n            } else {\r\n                result.size = 2 * (deltaY - halfSideLength);\r\n            }\r\n        } else {\r\n            if (deltaY < halfSideLength) {\r\n                result.size = 2 * (deltaX - halfSideLength);\r\n            } else {\r\n                result.size = 2 * Math.max(deltaX - halfSideLength, deltaY - halfSideLength);\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    public computeVisibility(domainSize: ISize): EVisibility {\r\n        const halfDomainWidth = 0.5 * domainSize.width;\r\n        const halfDomainHeight = 0.5 * domainSize.height;\r\n\r\n        const absX = Math.abs(this.center.x);\r\n        const absY = Math.abs(this.center.y);\r\n\r\n        const halfSize = 0.5 * this.size;\r\n\r\n        if (absX + halfDomainWidth < halfSize && absY + halfDomainHeight < halfSize) {\r\n            return EVisibility.COVERS_VIEW;\r\n        }\r\n        if (absX - halfSize < halfDomainWidth && absY - halfSize < halfDomainHeight) {\r\n            return EVisibility.VISIBLE;\r\n        }\r\n        return EVisibility.OUT_OF_VIEW;\r\n    }\r\n\r\n    private get sideLength(): number {\r\n        return this.size;\r\n    }\r\n}\r\n\r\nexport { PatternSquare }\r\n","import { EVisibility, ISizeComputationResult, PatternBase } from \"./pattern-base\";\r\n\r\nimport { IPoint } from \"../utils/i-point\";\r\nimport { ISize } from \"../utils/i-size\";\r\n\r\nfunction rotatePoint(point: IPoint, cosAngle: number, sinAngle: number): IPoint {\r\n    return {\r\n        x: point.x * cosAngle - point.y * sinAngle,\r\n        y: point.x * sinAngle + point.y * cosAngle,\r\n    };\r\n}\r\n\r\n/** Computes intersection between a segment and a semiline, both defined with parametric equations.\r\n * The first segment is defined with \"from1 + t1 * delta1\" for 0 <= t1 <= 2\r\n * The semi line is defined with \"0 + t2 * delta2\" for 0 <= t2\r\n * @returns if there is an intersection, t2 >= 0\r\n *          if there is no intersection, returns a negative value\r\n */\r\nfunction computeSegmentsIntersection(from1: IPoint, delta1: IPoint, delta2: IPoint): number {\r\n    const denom = delta2.y * delta1.x - delta1.y * delta2.x;\r\n    if (denom !== 0) {\r\n        const invDenom = 1 / denom;\r\n\r\n        const t1 = (delta2.x * from1.y - delta2.y * from1.x) * invDenom;\r\n        if (0 <= t1 && t1 <= 1) {\r\n            const t2 = (delta1.x * from1.y - delta1.y * from1.x) * invDenom;\r\n            return t2;\r\n        }\r\n    }\r\n    return -1;\r\n}\r\n\r\nconst MAX_NUMBER = 100000000;\r\nfunction minPositive(...args: number[]): number {\r\n    let min = MAX_NUMBER;\r\n    for (const arg of args) {\r\n        if (arg >= 0 && arg < min) {\r\n            min = arg;\r\n        }\r\n    }\r\n    return (min === MAX_NUMBER) ? -1 : min;\r\n}\r\n\r\nclass PatternTriangle extends PatternBase {\r\n    public readonly angle: number;\r\n\r\n    public static readonly baseP1: IPoint = { x: 0, y: -0.5 };\r\n    public static readonly baseP2: IPoint = { x: 0.5 * Math.cos(Math.PI * 7 / 6), y: -0.5 * Math.sin(Math.PI * 7 / 6) };\r\n    public static readonly baseP3: IPoint = { x: -0.5 * Math.cos(Math.PI * 7 / 6), y: -0.5 * Math.sin(Math.PI * 7 / 6) };\r\n\r\n    // rotated, with a size=1\r\n    public readonly P1: IPoint;\r\n    public readonly P2: IPoint;\r\n    public readonly P3: IPoint;\r\n\r\n    // with a size=1\r\n    public readonly P1_TO_P2: IPoint;\r\n    public readonly P2_TO_P3: IPoint;\r\n    public readonly P3_TO_P1: IPoint;\r\n\r\n    public constructor() {\r\n        super();\r\n\r\n        this.angle = 2 * Math.PI * Math.random();\r\n\r\n        const cosAngle = Math.cos(this.angle);\r\n        const sinAngle = Math.sin(this.angle);\r\n        this.P1 = rotatePoint(PatternTriangle.baseP1, cosAngle, sinAngle);\r\n        this.P2 = rotatePoint(PatternTriangle.baseP2, cosAngle, sinAngle);\r\n        this.P3 = rotatePoint(PatternTriangle.baseP3, cosAngle, sinAngle);\r\n\r\n        this.P1_TO_P2 = { x: this.P2.x - this.P1.x, y: this.P2.y - this.P1.y };\r\n        this.P2_TO_P3 = { x: this.P3.x - this.P2.x, y: this.P3.y - this.P2.y };\r\n        this.P3_TO_P1 = { x: this.P1.x - this.P3.x, y: this.P1.y - this.P3.y };\r\n    }\r\n\r\n    protected computeBiggestSizePossibleToAvoidPoint(pointToAvoid: IPoint): number {\r\n        if (pointToAvoid.x === this.center.x && pointToAvoid.y === this.center.y) {\r\n            return 0;\r\n        }\r\n\r\n        const pointToAvoidLocal = { x: pointToAvoid.x - this.center.x, y: pointToAvoid.y - this.center.y };\r\n\r\n        let intersection = computeSegmentsIntersection(this.P1, this.P1_TO_P2, pointToAvoidLocal);\r\n        if (intersection < 0) {\r\n            intersection = computeSegmentsIntersection(this.P2, this.P2_TO_P3, pointToAvoidLocal);\r\n            if (intersection < 0) {\r\n                intersection = computeSegmentsIntersection(this.P3, this.P3_TO_P1, pointToAvoidLocal);\r\n            }\r\n        }\r\n\r\n        if (intersection > 0) {\r\n            return 1 / intersection;\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    protected computeBiggestSizePossibleToAvoidItem(itemToAvoid: PatternTriangle, allowOverlapping: boolean): ISizeComputationResult {\r\n        const result = { size: 0, isInside: false };\r\n\r\n        if (itemToAvoid.isPointInside(this.center.x, this.center.y)) {\r\n            if (allowOverlapping) {\r\n                result.isInside = true;\r\n            } else {\r\n                return result;\r\n            }\r\n        }\r\n\r\n        const localOtherP1: IPoint = {\r\n            x: itemToAvoid.center.x + itemToAvoid.P1.x * itemToAvoid.size - this.center.x,\r\n            y: itemToAvoid.center.y + itemToAvoid.P1.y * itemToAvoid.size - this.center.y,\r\n        };\r\n\r\n        const localOtherP2: IPoint = {\r\n            x: itemToAvoid.center.x + itemToAvoid.P2.x * itemToAvoid.size - this.center.x,\r\n            y: itemToAvoid.center.y + itemToAvoid.P2.y * itemToAvoid.size - this.center.y,\r\n        };\r\n\r\n        const localOtherP3: IPoint = {\r\n            x: itemToAvoid.center.x + itemToAvoid.P3.x * itemToAvoid.size - this.center.x,\r\n            y: itemToAvoid.center.y + itemToAvoid.P3.y * itemToAvoid.size - this.center.y,\r\n        };\r\n\r\n        const scaledOtherP1toP2: IPoint = {\r\n            x: itemToAvoid.P1_TO_P2.x * itemToAvoid.size,\r\n            y: itemToAvoid.P1_TO_P2.y * itemToAvoid.size,\r\n        };\r\n\r\n        const scaledOtherP2toP3: IPoint = {\r\n            x: itemToAvoid.P2_TO_P3.x * itemToAvoid.size,\r\n            y: itemToAvoid.P2_TO_P3.y * itemToAvoid.size,\r\n        };\r\n\r\n        const scaledOtherP3toP1: IPoint = {\r\n            x: itemToAvoid.P3_TO_P1.x * itemToAvoid.size,\r\n            y: itemToAvoid.P3_TO_P1.y * itemToAvoid.size,\r\n        };\r\n\r\n        // Check if a vertice of this may intersect a side of the other\r\n        let smallerTforMyVertices: number;\r\n        {\r\n            const T1_1 = computeSegmentsIntersection(localOtherP1, scaledOtherP1toP2, this.P1);\r\n            const T1_2 = computeSegmentsIntersection(localOtherP2, scaledOtherP2toP3, this.P1);\r\n            const T1_3 = computeSegmentsIntersection(localOtherP3, scaledOtherP3toP1, this.P1);\r\n\r\n            const T2_1 = computeSegmentsIntersection(localOtherP1, scaledOtherP1toP2, this.P2);\r\n            const T2_2 = computeSegmentsIntersection(localOtherP2, scaledOtherP2toP3, this.P2);\r\n            const T2_3 = computeSegmentsIntersection(localOtherP3, scaledOtherP3toP1, this.P2);\r\n\r\n            const T3_1 = computeSegmentsIntersection(localOtherP1, scaledOtherP1toP2, this.P3);\r\n            const T3_2 = computeSegmentsIntersection(localOtherP2, scaledOtherP2toP3, this.P3);\r\n            const T3_3 = computeSegmentsIntersection(localOtherP3, scaledOtherP3toP1, this.P3);\r\n\r\n            smallerTforMyVertices = minPositive(T1_1, T1_2, T1_3, T2_1, T2_2, T2_3, T3_1, T3_2, T3_3);\r\n        }\r\n\r\n        let smallerTforMySides: number;\r\n        {\r\n            const T1_1 = computeSegmentsIntersection(this.P1, this.P1_TO_P2, localOtherP1);\r\n            const T1_2 = computeSegmentsIntersection(this.P2, this.P2_TO_P3, localOtherP1);\r\n            const T1_3 = computeSegmentsIntersection(this.P3, this.P3_TO_P1, localOtherP1);\r\n\r\n            const T2_1 = computeSegmentsIntersection(this.P1, this.P1_TO_P2, localOtherP2);\r\n            const T2_2 = computeSegmentsIntersection(this.P2, this.P2_TO_P3, localOtherP2);\r\n            const T2_3 = computeSegmentsIntersection(this.P3, this.P3_TO_P1, localOtherP2);\r\n\r\n            const T3_1 = computeSegmentsIntersection(this.P1, this.P1_TO_P2, localOtherP3);\r\n            const T3_2 = computeSegmentsIntersection(this.P2, this.P2_TO_P3, localOtherP3);\r\n            const T3_3 = computeSegmentsIntersection(this.P3, this.P3_TO_P1, localOtherP3);\r\n\r\n            const max = Math.max(T1_1, T1_2, T1_3, T2_1, T2_2, T2_3, T3_1, T3_2, T3_3);\r\n            if (max !== 0) {\r\n                smallerTforMySides = 1 / max;\r\n            } else {\r\n                smallerTforMySides = -1;\r\n            }\r\n        }\r\n\r\n        result.size = minPositive(smallerTforMyVertices, smallerTforMySides);\r\n        return result;\r\n    }\r\n\r\n    public computeVisibility(domainSize: ISize): EVisibility {\r\n        const halfDomainWidth = 0.5 * domainSize.width;\r\n        const halfDomainHeight = 0.5 * domainSize.height;\r\n\r\n        const absX = Math.abs(this.center.x);\r\n        const absY = Math.abs(this.center.y);\r\n\r\n        const halfSize = 0.5 * this.size;\r\n\r\n        if (this.isPointInside(-halfDomainWidth, -halfDomainHeight) && this.isPointInside(halfDomainWidth, -halfDomainHeight) && this.isPointInside(-halfDomainWidth, halfDomainHeight) && this.isPointInside(halfDomainWidth, halfDomainHeight)) {\r\n            return EVisibility.COVERS_VIEW;\r\n        }\r\n        if (absX - halfSize < halfDomainWidth && absY - halfSize < halfDomainHeight) {\r\n            return EVisibility.VISIBLE;\r\n        }\r\n        return EVisibility.OUT_OF_VIEW;\r\n    }\r\n\r\n    private isPointInside(x: number, y: number): boolean {\r\n        x = (x - this.center.x) / this.size;\r\n        y = (y - this.center.y) / this.size;\r\n\r\n        const d1 = this.P1_TO_P2.x * (y - this.P2.y) - (x - this.P2.x) * this.P1_TO_P2.y;\r\n        const d2 = this.P2_TO_P3.x * (y - this.P3.y) - (x - this.P3.x) * this.P2_TO_P3.y;\r\n        const d3 = this.P3_TO_P1.x * (y - this.P1.y) - (x - this.P1.x) * this.P3_TO_P1.y;\r\n\r\n        return (d1 <= 0 && d2 <= 0 && d3 <= 0) || (d1 > 0 && d2 > 0 && d3 > 0);\r\n    }\r\n}\r\n\r\nexport { PatternTriangle }\r\n","import { Color } from \"../color/color\";\r\nimport { ILine } from \"../utils/i-line\";\r\nimport { ISize } from \"../utils/i-size\";\r\n\r\nimport { PatternCircle } from \"../patterns/pattern-circle\";\r\nimport { PatternSquare } from \"../patterns/pattern-square\";\r\nimport { PatternRectangle } from \"../patterns/pattern-rectangle\";\r\nimport { PatternTriangle } from \"../patterns/pattern-triangle\";\r\n\r\nabstract class PlotterBase {\r\n    public abstract get size(): ISize;\r\n\r\n    public abstract get isReady(): boolean;\r\n\r\n    public abstract initialize(backgroundColor: Color): void;\r\n    public abstract finalize(): void;\r\n\r\n    public abstract drawSquares(squares: PatternSquare[]): void;\r\n    public abstract drawCircles(circles: PatternCircle[]): void;\r\n    public abstract drawRectangles(rectangles: PatternRectangle[]): void;\r\n    public abstract drawTriangles(triangles: PatternTriangle[]): void;\r\n\r\n    /* Lines have  a 1 pixel thickness */\r\n    public abstract drawLines(lines: ILine[], color: Color): void;\r\n}\r\n\r\nexport { PlotterBase };\r\n\r\n","import { Color } from \"../color/color\";\r\nimport { ILine } from \"../utils/i-line\";\r\n\r\nimport { PlotterCanvasBase } from \"./plotter-canvas-base\";\r\n\r\nimport { PatternCircle } from \"../patterns/pattern-circle\";\r\nimport { PatternSquare } from \"../patterns/pattern-square\";\r\nimport { PatternRectangle } from \"../patterns/pattern-rectangle\";\r\nimport { PatternTriangle } from \"../patterns/pattern-triangle\";\r\n\r\nimport \"../page-interface-generated\";\r\n\r\nclass PlotterCanvas2D extends PlotterCanvasBase {\r\n    private readonly context: CanvasRenderingContext2D;\r\n    public constructor() {\r\n        super();\r\n        this.context = this.canvas.getContext(\"2d\", { alpha: false });\r\n    }\r\n\r\n    public get isReady(): boolean {\r\n        return true;\r\n    }\r\n\r\n    protected clearCanvas(color: Color): void {\r\n        this.context.fillStyle = color.toString();\r\n        this.context.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n    }\r\n\r\n    // tslint:disable-next-line:no-empty\r\n    public finalize(): void { }\r\n\r\n    public drawSquares(squares: PatternSquare[]): void {\r\n        const halfWidth = 0.5 * this._size.width;\r\n        const halfHeight = 0.5 * this._size.height;\r\n\r\n        for (const square of squares) {\r\n            const centerX = square.center.x + halfWidth;\r\n            const centerY = square.center.y + halfHeight;\r\n            const halfSize = 0.5 * square.size;\r\n\r\n            this.context.fillStyle = square.color.toString();\r\n            this.context.fillRect(centerX - halfSize, centerY - halfSize, square.size, square.size);\r\n        }\r\n    }\r\n\r\n    public drawCircles(circles: PatternCircle[]): void {\r\n        const halfWidth = 0.5 * this._size.width;\r\n        const halfHeight = 0.5 * this._size.height;\r\n        const TWO_PI = 2 * Math.PI;\r\n\r\n        for (const circle of circles) {\r\n            const centerX = circle.center.x + halfWidth;\r\n            const centerY = circle.center.y + halfHeight;\r\n\r\n            this.context.fillStyle = circle.color.toString();\r\n            this.context.beginPath();\r\n            this.context.arc(centerX, centerY, circle.radius, 0, TWO_PI);\r\n            this.context.fill();\r\n            this.context.closePath();\r\n        }\r\n    }\r\n\r\n    public drawRectangles(rectangles: PatternRectangle[]): void {\r\n        const halfWidth = 0.5 * this._size.width;\r\n        const halfHeight = 0.5 * this._size.height;\r\n\r\n        for (const rectangle of rectangles) {\r\n            const centerX = rectangle.center.x + halfWidth;\r\n            const centerY = rectangle.center.y + halfHeight;\r\n\r\n            this.context.fillStyle = rectangle.color.toString();\r\n            this.context.fillRect(centerX - 0.5 * rectangle.width, centerY - 0.5 * rectangle.height, rectangle.width, rectangle.height);\r\n        }\r\n    }\r\n\r\n    public drawTriangles(triangles: PatternTriangle[]): void {\r\n        const halfWidth = 0.5 * this._size.width;\r\n        const halfHeight = 0.5 * this._size.height;\r\n\r\n        for (const triangle of triangles) {\r\n            const centerX = triangle.center.x + halfWidth;\r\n            const centerY = triangle.center.y + halfHeight;\r\n\r\n            this.context.fillStyle = triangle.color.toString();\r\n            this.context.beginPath();\r\n            this.context.moveTo(centerX + triangle.P1.x * triangle.size, centerY + triangle.P1.y * triangle.size);\r\n            this.context.lineTo(centerX + triangle.P2.x * triangle.size, centerY + triangle.P2.y * triangle.size);\r\n            this.context.lineTo(centerX + triangle.P3.x * triangle.size, centerY + triangle.P3.y * triangle.size);\r\n            this.context.fill();\r\n            this.context.closePath();\r\n        }\r\n    }\r\n\r\n    public drawLines(lines: ILine[], color: Color): void {\r\n        this.context.fillStyle = \"none\";\r\n        this.context.strokeStyle = color.toString();\r\n        this.context.lineWidth = 1;\r\n        this.context.beginPath();\r\n\r\n        const halfWidth = 0.5 * this._size.width;\r\n        const halfHeight = 0.5 * this._size.height;\r\n        for (const line of lines) {\r\n            this.context.moveTo(line.from.x + halfWidth, line.from.y + halfHeight);\r\n            this.context.lineTo(line.to.x + halfWidth, line.to.y + halfHeight);\r\n        }\r\n\r\n        this.context.stroke();\r\n        this.context.closePath();\r\n        this.context.strokeStyle = \"none\";\r\n    }\r\n}\r\n\r\nexport { PlotterCanvas2D };\r\n\r\n","import { ISize } from \"../utils/i-size\";\r\nimport { Color } from \"../color/color\";\r\nimport { PlotterBase } from \"./plotter-base\";\r\n\r\nimport \"../page-interface-generated\";\r\n\r\nabstract class PlotterCanvasBase extends PlotterBase {\r\n    protected readonly canvas: HTMLCanvasElement;\r\n    protected _size: ISize;\r\n    private readonly cssPixel: number;\r\n\r\n    public constructor() {\r\n        super();\r\n\r\n        this.canvas = Page.Canvas.getCanvas();\r\n        this.cssPixel = window.devicePixelRatio ?? 1;\r\n        this.resizeCanvas();\r\n    }\r\n\r\n    public get size(): ISize {\r\n        return this._size;\r\n    }\r\n\r\n    public initialize(backgroundColor: Color): void {\r\n        this.resizeCanvas();\r\n        this.clearCanvas(backgroundColor);\r\n    }\r\n\r\n    protected abstract clearCanvas(color: Color): void;\r\n\r\n    private resizeCanvas(): void {\r\n        const actualWidth = Math.floor(this.cssPixel * this.canvas.clientWidth);\r\n        const actualHeight = Math.floor(this.cssPixel * this.canvas.clientHeight);\r\n\r\n        if (this.canvas.width !== actualWidth || this.canvas.height !== actualHeight) {\r\n            this.canvas.width = actualWidth;\r\n            this.canvas.height = actualHeight;\r\n        }\r\n\r\n        this._size = {\r\n            width: this.canvas.width,\r\n            height: this.canvas.height,\r\n        }\r\n    }\r\n}\r\n\r\nexport { PlotterCanvasBase };\r\n\r\n","import { ILine } from \"../utils/i-line\";\r\nimport { Color } from \"../color/color\";\r\n\r\nimport { PlotterCanvasBase } from \"./plotter-canvas-base\";\r\n\r\nimport { PatternBase } from \"../patterns/pattern-base\";\r\nimport { PatternCircle } from \"../patterns/pattern-circle\";\r\nimport { PatternSquare } from \"../patterns/pattern-square\";\r\nimport { PatternRectangle } from \"../patterns/pattern-rectangle\";\r\nimport { PatternTriangle } from \"../patterns/pattern-triangle\";\r\n\r\nimport { initGL, gl } from \"../gl-utils/gl-canvas\";\r\nimport { Shader } from \"../gl-utils/shader\";\r\nimport * as ShaderManager from \"../gl-utils/shader-manager\";\r\nimport { VBO } from \"../gl-utils/vbo\";\r\n\r\nimport \"../page-interface-generated\";\r\nimport { EPrimitive, Parameters } from \"../parameters\";\r\n\r\ntype AffectShaderFunction = (shader: Shader) => unknown;\r\ntype ExtraAttributeFunction = (item: PatternBase) => number;\r\n\r\nconst SQUARE_GEOMETRY = [-.5, .5, -.5, -.5, .5, .5, .5, -.5];\r\nconst TRIANGLE_GEOMETRY = [\r\n    PatternTriangle.baseP1.x, PatternTriangle.baseP1.y,\r\n    PatternTriangle.baseP2.x, PatternTriangle.baseP2.y,\r\n    PatternTriangle.baseP3.x, PatternTriangle.baseP3.y,\r\n];\r\n\r\nclass PlotterCanvasWebGL extends PlotterCanvasBase {\r\n    private instancingExt: ANGLE_instanced_arrays;\r\n    private needToResetInstancingDivision: boolean;\r\n\r\n    private linesShader: Shader | null;\r\n\r\n    private squaresShader: Shader | null;\r\n    private circlesShader: Shader | null;\r\n    private rectanglesShader: Shader | null;\r\n    private trianglesShader: Shader | null;\r\n\r\n    private squaresInstancedShader: Shader | null;\r\n    private circlesInstancedShader: Shader | null;\r\n    private rectanglesInstancedShader: Shader | null;\r\n    private trianglesInstancedShader: Shader | null;\r\n\r\n    private blending: boolean;\r\n\r\n    private linesBuffer: Float32Array;\r\n    private readonly linesVBO: VBO;\r\n\r\n    private statesBuffer: Float32Array;\r\n    private readonly statesVBO: VBO;\r\n\r\n    private colorsBuffer: Float32Array;\r\n    private readonly colorsVBO: VBO;\r\n\r\n    private readonly geometryVBO: VBO;\r\n\r\n    public constructor() {\r\n        super();\r\n\r\n        if (!initGL()) {\r\n            throw new Error(\"Failed to initialize WebGL.\");\r\n        }\r\n        console.log(`Max point size supported by WebGL: \"${gl.ALIASED_POINT_SIZE_RANGE}\" pixels.`);\r\n\r\n        this.needToResetInstancingDivision = false;\r\n        const instancingExtensionName = \"ANGLE_instanced_arrays\";\r\n        this.instancingExt = gl.getExtension(instancingExtensionName);\r\n        if (this.instancingExt === null) {\r\n            const errorMessage = `Your device does not support the \"${instancingExtensionName}\" WebGL extension. Using the fallback mode with GL_POINTS, which might cause visual artifacts.`;\r\n            Page.Demopage.setErrorMessage(\"webgl-instanced\", errorMessage);\r\n            console.log(errorMessage);\r\n            Parameters.disallowInstancing();\r\n        } else {\r\n            console.log(`Using the \"${instancingExtensionName}\" WebGL extension.`);\r\n        }\r\n\r\n        this.blending = false;\r\n        this.enableBlending = true;\r\n\r\n        this.linesBuffer = new Float32Array([]);\r\n        this.linesVBO = new VBO(gl, new Float32Array(this.linesBuffer), 2, gl.FLOAT, false);\r\n\r\n        this.statesBuffer = new Float32Array([]);\r\n        this.statesVBO = new VBO(gl, this.statesBuffer, 4, gl.FLOAT, false);\r\n\r\n        this.colorsBuffer = new Float32Array([]);\r\n        this.colorsVBO = new VBO(gl, this.colorsBuffer, 4, gl.FLOAT, false);\r\n\r\n        const geometryBuffer = SQUARE_GEOMETRY.concat(TRIANGLE_GEOMETRY);\r\n        this.geometryVBO = new VBO(gl, new Float32Array(geometryBuffer), 2, gl.FLOAT, true);\r\n\r\n        this.linesShader = null;\r\n        this.squaresShader = null;\r\n        this.circlesShader = null;\r\n        this.rectanglesShader = null;\r\n        this.trianglesShader = null;\r\n        this.loadAndBuildShader(\"point/lines.vert\", \"point/lines.frag\", \"lines\", (shader: Shader) => this.linesShader = shader);\r\n        this.loadAndBuildShader(\"point/items.vert\", \"point/squares.frag\", \"squares\", (shader: Shader) => this.squaresShader = shader);\r\n        this.loadAndBuildShader(\"point/items.vert\", \"point/circles.frag\", \"circles\", (shader: Shader) => this.circlesShader = shader);\r\n        this.loadAndBuildShader(\"point/rectangles.vert\", \"point/rectangles.frag\", \"rectangles\", (shader: Shader) => this.rectanglesShader = shader);\r\n        this.loadAndBuildShader(\"point/triangles.vert\", \"point/triangles.frag\", \"triangles\", (shader: Shader) => this.trianglesShader = shader);\r\n\r\n        this.squaresInstancedShader = null;\r\n        this.circlesInstancedShader = null;\r\n        this.rectanglesInstancedShader = null;\r\n        this.trianglesInstancedShader = null;\r\n        if (this.supportsInstancing) {\r\n            this.loadAndBuildShader(\"instanced/simpleGeometry.vert\", \"instanced/fillColor.frag\", \"instanced squares\", (shader: Shader) => this.squaresInstancedShader = shader);\r\n            this.loadAndBuildShader(\"instanced/circles.vert\", \"instanced/circles.frag\", \"instanced squares\", (shader: Shader) => this.circlesInstancedShader = shader);\r\n            this.loadAndBuildShader(\"instanced/rectangles.vert\", \"instanced/fillColor.frag\", \"instanced circles\", (shader: Shader) => this.rectanglesInstancedShader = shader);\r\n            this.loadAndBuildShader(\"instanced/triangles.vert\", \"instanced/fillColor.frag\", \"instanced triangles\", (shader: Shader) => this.trianglesInstancedShader = shader);\r\n        }\r\n    }\r\n\r\n    public get isReady(): boolean {\r\n        return this.linesShader !== null &&\r\n            this.squaresShader !== null && this.circlesShader !== null && this.rectanglesShader !== null && this.trianglesShader !== null &&\r\n            this.squaresInstancedShader !== null && this.circlesInstancedShader !== null && this.rectanglesInstancedShader !== null && this.trianglesInstancedShader !== null;\r\n    }\r\n\r\n    protected clearCanvas(color: Color): void {\r\n        gl.clearColor(color.r / 255, color.g / 255, color.b / 255, 1); // TODO avoid doing this if possible\r\n        gl.clear(gl.COLOR_BUFFER_BIT);\r\n    }\r\n\r\n    public initialize(backgroundColor: Color): void {\r\n        super.initialize(backgroundColor);\r\n        gl.viewport(0, 0, this._size.width, this._size.height);\r\n    }\r\n\r\n    // tslint:disable-next-line:no-empty\r\n    public finalize(): void { }\r\n\r\n    public drawSquares(squares: PatternSquare[]): void {\r\n        this.drawPrimitives(this.squaresShader, this.squaresInstancedShader, squares, EPrimitive.SQUARE);\r\n    }\r\n\r\n    public drawCircles(circles: PatternCircle[]): void {\r\n        this.drawPrimitives(this.circlesShader, this.circlesInstancedShader, circles, EPrimitive.CIRCLE);\r\n    }\r\n\r\n    public drawRectangles(rectangles: PatternRectangle[]): void {\r\n        const extraAttributeFunction = (item: PatternBase) => (item as PatternRectangle).aspectRatio;\r\n        this.drawPrimitives(this.rectanglesShader, this.rectanglesInstancedShader, rectangles, EPrimitive.RECTANGLE, extraAttributeFunction);\r\n    }\r\n\r\n    public drawTriangles(triangles: PatternTriangle[]): void {\r\n        const extraAttributeFunction = (item: PatternBase) => (item as PatternTriangle).angle;\r\n        this.drawPrimitives(this.trianglesShader, this.trianglesInstancedShader, triangles, EPrimitive.TRIANGLE, extraAttributeFunction);\r\n    }\r\n\r\n    public drawLines(lines: ILine[], color: Color): void {\r\n        const nbLines = lines.length;\r\n\r\n        if (this.linesShader !== null && nbLines >= 1) {\r\n            const wantedLinesBufferLength = 4 * nbLines;\r\n            if (this.linesBuffer.length !== wantedLinesBufferLength) {\r\n                this.linesBuffer = new Float32Array(wantedLinesBufferLength)\r\n            }\r\n\r\n            for (let i = 0; i < nbLines; i++) {\r\n                this.linesBuffer[4 * i + 0] = lines[i].from.x;\r\n                this.linesBuffer[4 * i + 1] = lines[i].from.y;\r\n                this.linesBuffer[4 * i + 2] = lines[i].to.x;\r\n                this.linesBuffer[4 * i + 3] = lines[i].to.y;\r\n            }\r\n\r\n            this.linesVBO.setData(new Float32Array(this.linesBuffer));\r\n\r\n            this.linesShader.a[\"aCoords\"].VBO = this.linesVBO;\r\n            this.linesShader.u[\"uScreenSize\"].value = [this._size.width, this._size.height];\r\n            this.linesShader.u[\"uColor\"].value = [color.r / 255, color.g / 255, color.b / 255, 1];\r\n\r\n            this.linesShader.use();\r\n            this.linesShader.bindUniformsAndAttributes();\r\n            gl.drawArrays(gl.LINES, 0, 2 * nbLines);\r\n        }\r\n    }\r\n\r\n    private drawPrimitives(pointsShader: Shader, instancedShader: Shader, items: PatternBase[], primitive: EPrimitive, extraAttributeFunction?: ExtraAttributeFunction): void {\r\n        this.updateStateAndColorVBOs(items, extraAttributeFunction);\r\n\r\n        if (this.useInstancing && instancedShader !== null) {\r\n            this.drawInstanced(instancedShader, items, primitive);\r\n        } else {\r\n            this.drawAsPoints(pointsShader, items);\r\n        }\r\n    }\r\n\r\n    private drawInstanced(shader: Shader, items: PatternBase[], primitive: EPrimitive): void {\r\n        const nbItems = items.length;\r\n        if (this.supportsInstancing && shader !== null && nbItems > 0) {\r\n            shader.u[\"uScreenSize\"].value = [this._size.width, this._size.height];\r\n\r\n            shader.use();\r\n            shader.bindUniforms();\r\n\r\n            this.geometryVBO.bind(shader.a[\"aVertex\"].loc);\r\n            this.statesVBO.bindInstanced(shader.a[\"aState\"].loc, this.instancingExt, 1);\r\n            this.colorsVBO.bindInstanced(shader.a[\"aColor\"].loc, this.instancingExt, 1);\r\n            this.needToResetInstancingDivision = true;\r\n\r\n            if (primitive === EPrimitive.TRIANGLE) {\r\n                this.instancingExt.drawArraysInstancedANGLE(gl.TRIANGLES, 4, 3, nbItems);\r\n            } else {\r\n                this.instancingExt.drawArraysInstancedANGLE(gl.TRIANGLE_STRIP, 0, 4, nbItems);\r\n            }\r\n        }\r\n    }\r\n\r\n    private drawAsPoints(shader: Shader, items: PatternBase[]): void {\r\n        const nbItems = items.length;\r\n        if (shader !== null && nbItems > 0) {\r\n            shader.a[\"aState\"].VBO = this.statesVBO;\r\n            shader.a[\"aColor\"].VBO = this.colorsVBO;\r\n            shader.u[\"uScreenSize\"].value = [this._size.width, this._size.height];\r\n\r\n            shader.use();\r\n\r\n            if (this.needToResetInstancingDivision) {\r\n                this.statesVBO.bindInstanced(shader.a[\"aState\"].loc, this.instancingExt, 0);\r\n                this.colorsVBO.bindInstanced(shader.a[\"aColor\"].loc, this.instancingExt, 0);\r\n                this.needToResetInstancingDivision = false;\r\n            }\r\n\r\n            shader.bindUniformsAndAttributes();\r\n            gl.drawArrays(gl.POINTS, 0, nbItems);\r\n        }\r\n    }\r\n\r\n    private updateStateAndColorVBOs(items: PatternBase[], extraAttribute?: ExtraAttributeFunction): void {\r\n        const nbItems = items.length;\r\n\r\n        // try not to resize the buffers too often to avoid GC\r\n        const nbItemsRounded = 1024 * Math.ceil(nbItems / 1024);\r\n\r\n        const wantedStatesBufferLength = 4 * nbItemsRounded;\r\n        if (this.statesBuffer.length !== wantedStatesBufferLength) {\r\n            this.statesBuffer = new Float32Array(wantedStatesBufferLength);\r\n        }\r\n\r\n        const wantedColorsBufferLength = 4 * nbItemsRounded;\r\n        if (this.colorsBuffer.length !== wantedColorsBufferLength) {\r\n            this.colorsBuffer = new Float32Array(wantedColorsBufferLength);\r\n        }\r\n\r\n        this.enableBlending = Parameters.blending;\r\n        const time = performance.now();\r\n        const blendTime = PatternBase.maxBlendingTime;\r\n\r\n        if (typeof extraAttribute !== \"function\") {\r\n            extraAttribute = () => 0; // unused value\r\n        }\r\n\r\n        for (let i = 0; i < nbItems; i++) {\r\n            const color = items[i].color;\r\n\r\n            this.statesBuffer[4 * i + 0] = items[i].center.x;\r\n            this.statesBuffer[4 * i + 1] = items[i].center.y;\r\n            this.statesBuffer[4 * i + 2] = items[i].size;\r\n            this.statesBuffer[4 * i + 3] = extraAttribute(items[i]);\r\n            this.colorsBuffer[4 * i + 0] = color.r / 255;\r\n            this.colorsBuffer[4 * i + 1] = color.g / 255;\r\n            this.colorsBuffer[4 * i + 2] = color.b / 255;\r\n            this.colorsBuffer[4 * i + 3] = items[i].computeOpacity(time, blendTime);\r\n        }\r\n\r\n        this.statesVBO.setData(this.statesBuffer);\r\n        this.colorsVBO.setData(this.colorsBuffer);\r\n    }\r\n\r\n    private set enableBlending(value: boolean) {\r\n        if (value !== this.blending) {\r\n            this.blending = value;\r\n\r\n            if (value) {\r\n                gl.enable(gl.BLEND);\r\n                gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n            } else {\r\n                gl.disable(gl.BLEND);\r\n            }\r\n        }\r\n    }\r\n\r\n    private loadAndBuildShader(vertexFilename: string, fragmentFilename: string, shaderName: string, affectShader: AffectShaderFunction): void {\r\n        ShaderManager.buildShader({\r\n            vertexFilename,\r\n            fragmentFilename,\r\n            injected: {},\r\n        }, (builtShader: Shader | null) => {\r\n            if (builtShader === null) {\r\n                const errorMessage = `Failed to load or build the ${shaderName} shader.`;\r\n                Page.Demopage.setErrorMessage(`shader-${shaderName}`, errorMessage);\r\n                throw new Error(errorMessage);\r\n            }\r\n            affectShader(builtShader);\r\n        });\r\n    }\r\n\r\n    private get supportsInstancing(): boolean {\r\n        return this.instancingExt !== null;\r\n    }\r\n\r\n    private get useInstancing(): boolean {\r\n        return this.supportsInstancing && Parameters.useInstancing;\r\n    }\r\n}\r\n\r\nexport { PlotterCanvasWebGL };\r\n","import { Color } from \"../color/color\";\r\nimport { ILine } from \"../utils/i-line\";\r\nimport { ISize } from \"../utils/i-size\";\r\n\r\nimport { PlotterBase } from \"./plotter-base\";\r\n\r\nimport { PatternCircle } from \"../patterns/pattern-circle\";\r\nimport { PatternSquare } from \"../patterns/pattern-square\";\r\nimport { PatternRectangle } from \"../patterns/pattern-rectangle\";\r\nimport { PatternTriangle } from \"../patterns/pattern-triangle\";\r\n\r\nclass PlotterSVG extends PlotterBase {\r\n    private stringParts: string[];\r\n    private readonly _size: ISize;\r\n\r\n    public constructor(size: ISize) {\r\n        super();\r\n\r\n        this._size = {\r\n            width: size.width,\r\n            height: size.height,\r\n        };\r\n    }\r\n\r\n    public get size(): ISize {\r\n        return this._size;\r\n    }\r\n\r\n    public get isReady(): boolean {\r\n        return true;\r\n    }\r\n\r\n    public initialize(backgroundColor: Color): void {\r\n        this.stringParts = [];\r\n\r\n        this.stringParts.push(`<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\\n`);\r\n        this.stringParts.push(`<svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\" viewBox=\"0 0 ${this._size.width} ${this._size.height}\">\\n`);\r\n\r\n        this.stringParts.push(`\\t<rect fill=\"${backgroundColor}\" stroke=\"none\" x=\"0\" y=\"0\" width=\"${this._size.width}\" height=\"${this._size.height}\"/>\\n`);\r\n    }\r\n\r\n    // tslint:disable-next-line:no-empty\r\n    public finalize(): void {\r\n        this.stringParts.push(`</svg>\\n`);\r\n    }\r\n\r\n    public drawSquares(squares: PatternSquare[]): void {\r\n        const halfWidth = 0.5 * this._size.width;\r\n        const halfHeight = 0.5 * this._size.height;\r\n\r\n        this.stringParts.push(`\\t<g stroke=\"none\">\\n`);\r\n        for (const square of squares) {\r\n            const centerX = square.center.x + halfWidth;\r\n            const centerY = square.center.y + halfHeight;\r\n            const halfSize = 0.5 * square.size;\r\n\r\n            this.stringParts.push(`\\t\\t<rect fill=\"${square.color}\" x=\"${centerX - halfSize}\" y=\"${centerY - halfSize}\" width=\"${square.size}\" height=\"${square.size}\"/>\\n`);\r\n        }\r\n        this.stringParts.push(`\\t</g>\\n`);\r\n    }\r\n\r\n    public drawCircles(circles: PatternCircle[]): void {\r\n        const halfWidth = 0.5 * this._size.width;\r\n        const halfHeight = 0.5 * this._size.height;\r\n\r\n        this.stringParts.push(`\\t<g stroke=\"none\">\\n`);\r\n        for (const circle of circles) {\r\n            const centerX = circle.center.x + halfWidth;\r\n            const centerY = circle.center.y + halfHeight;\r\n\r\n            this.stringParts.push(`\\t\\t<circle fill=\"${circle.color}\" cx=\"${centerX}\" cy=\"${centerY}\" r=\"${circle.radius}\"/>\\n`);\r\n        }\r\n        this.stringParts.push(`\\t</g>\\n`);\r\n    }\r\n\r\n    public drawRectangles(rectangles: PatternRectangle[]): void {\r\n        const halfWidth = 0.5 * this._size.width;\r\n        const halfHeight = 0.5 * this._size.height;\r\n\r\n        this.stringParts.push(`\\t<g stroke=\"none\">\\n`);\r\n        for (const rectangle of rectangles) {\r\n            const centerX = rectangle.center.x + halfWidth;\r\n            const centerY = rectangle.center.y + halfHeight;\r\n\r\n            this.stringParts.push(`\\t\\t<rect fill=\"${rectangle.color}\" x=\"${centerX - 0.5 * rectangle.width}\" y=\"${centerY - 0.5 * rectangle.height}\" width=\"${rectangle.width}\" height=\"${rectangle.height}\"/>\\n`);\r\n        }\r\n        this.stringParts.push(`\\t</g>\\n`);\r\n    }\r\n\r\n    public drawTriangles(triangles: PatternTriangle[]): void {\r\n        const halfWidth = 0.5 * this._size.width;\r\n        const halfHeight = 0.5 * this._size.height;\r\n\r\n        this.stringParts.push(`\\t<g stroke=\"none\">\\n`);\r\n        for (const triangle of triangles) {\r\n            const centerX = triangle.center.x + halfWidth;\r\n            const centerY = triangle.center.y + halfHeight;\r\n\r\n            this.stringParts.push(`\\t\\t<polygon fill=\"${triangle.color}\" points=\"${centerX + triangle.P1.x * triangle.size},${centerY + triangle.P1.y * triangle.size} ${centerX + triangle.P2.x * triangle.size},${centerY + triangle.P2.y * triangle.size} ${centerX + triangle.P3.x * triangle.size},${centerY + triangle.P3.y * triangle.size}\"/>\\n`);\r\n        }\r\n        this.stringParts.push(`\\t</g>\\n`);\r\n    }\r\n\r\n    public drawLines(lines: ILine[], color: Color): void {\r\n        const path: string[] = [];\r\n\r\n        const halfWidth = 0.5 * this._size.width;\r\n        const halfHeight = 0.5 * this._size.height;\r\n        for (const line of lines) {\r\n            const x1 = line.from.x + halfWidth;\r\n            const y1 = line.from.y + halfHeight;\r\n            const x2 = line.to.x + halfWidth;\r\n            const y2 = line.to.y + halfHeight;\r\n\r\n            path.push(`M${x1},${y1}L${x2},${y2}`);\r\n        }\r\n\r\n        this.stringParts.push(`\\t\\t\\t<path fill=\"none\" stroke-width=\"1\" stroke=\"${color}\" d=\"${path.join()}\"/>\\n`);\r\n    }\r\n\r\n    public export(): string {\r\n        const result = this.stringParts.join(\"\");\r\n        return result;\r\n    }\r\n}\r\n\r\nexport { PlotterSVG }\r\n","import { PatternBase } from \"../patterns/pattern-base\";\r\nimport { PlotterBase } from \"../plotter/plotter-base\";\r\nimport { Color } from \"../color/color\";\r\nimport { ILine } from \"../utils/i-line\";\r\nimport { IPoint } from \"../utils/i-point\";\r\nimport { ISize } from \"../utils/i-size\";\r\n\r\nimport * as Statistics from \"..//statistics/statistics\";\r\n\r\ntype GridCell = PatternBase[];\r\n\r\nconst MIN_CELL_SIZE = 10;\r\nconst MAX_CELL_SIZE = 500;\r\n\r\nclass Grid {\r\n    private readonly gridSize: ISize;\r\n    private readonly gridCells: GridCell[];\r\n    private readonly topLeftCorner: IPoint;\r\n    private _cellSize: number;\r\n\r\n    private registeredItemsCount: number; // including duplicates\r\n\r\n    constructor() {\r\n        this.gridSize = { width: 0, height: 0 };\r\n        this.gridCells = [];\r\n        this.topLeftCorner = { x: 0, y: 0 };\r\n\r\n        this.reset({ width: 1, height: 1 }, 100, []);\r\n    }\r\n\r\n    /** @returns true if the grid needs to be redrawn */\r\n    public reset(domainSize: ISize, cellSize: number, items: PatternBase[]): boolean {\r\n        this.registeredItemsCount = 0;\r\n        const gridHasChanged = this.resetDomain(domainSize, cellSize);\r\n\r\n        for (const item of items) {\r\n            this.registerItem(item);\r\n        }\r\n\r\n        return gridHasChanged;\r\n    }\r\n\r\n    public registerItem(item: PatternBase): void {\r\n        const topLeft: IPoint = {\r\n            x: item.center.x - 0.5 * item.size,\r\n            y: item.center.y - 0.5 * item.size,\r\n        };\r\n        const bottomRight: IPoint = {\r\n            x: item.center.x + 0.5 * item.size,\r\n            y: item.center.y + 0.5 * item.size,\r\n        };\r\n\r\n        const minCellId = this.getCellId(topLeft);\r\n        const maxCellId = this.getCellId(bottomRight);\r\n\r\n        for (let iCellY = minCellId.y; iCellY <= maxCellId.y; iCellY++) {\r\n            for (let iCellX = minCellId.x; iCellX <= maxCellId.x; iCellX++) {\r\n                const cellId = this.computeCellId(iCellX, iCellY);\r\n                this.gridCells[cellId].push(item);\r\n                this.registeredItemsCount++;\r\n            }\r\n        }\r\n    }\r\n\r\n    public draw(plotter: PlotterBase): void {\r\n        const lines: ILine[] = [];\r\n\r\n        const minX = this.topLeftCorner.x;\r\n        const maxX = minX + this.gridSize.width * this._cellSize;\r\n\r\n        const minY = this.topLeftCorner.y;\r\n        const maxY = minY + this.gridSize.height * this._cellSize;\r\n\r\n        for (let iX = 0; iX < this.gridSize.width; iX++) {\r\n            const x = minX + iX * this._cellSize;\r\n            const line: ILine = {\r\n                from: { x, y: minY },\r\n                to: { x, y: maxY },\r\n            };\r\n            lines.push(line);\r\n        }\r\n\r\n        for (let iY = 0; iY < this.gridSize.height; iY++) {\r\n            const y = minY + iY * this._cellSize;\r\n            const line: ILine = {\r\n                from: { x: minX, y },\r\n                to: { x: maxX, y },\r\n            };\r\n            lines.push(line);\r\n        }\r\n\r\n        plotter.drawLines(lines, Color.GREEN);\r\n    }\r\n\r\n    public getCellId(position: IPoint): IPoint {\r\n        let cellX = Math.floor((position.x - this.topLeftCorner.x) / this._cellSize);\r\n        let cellY = Math.floor((position.y - this.topLeftCorner.y) / this._cellSize);\r\n\r\n        if (cellX < 0) {\r\n            cellX = 0;\r\n        } else if (cellX >= this.gridSize.width) {\r\n            cellX = this.gridSize.width - 1;\r\n        }\r\n\r\n        if (cellY < 0) {\r\n            cellY = 0;\r\n        } else if (cellY >= this.gridSize.height) {\r\n            cellY = this.gridSize.height - 1;\r\n        }\r\n\r\n        return { x: cellX, y: cellY };\r\n    }\r\n\r\n    public getDistanceToClosestBorder(position: IPoint): number {\r\n        // position relative to the containing cell\r\n        const localX = (position.x - this.topLeftCorner.x) % this._cellSize;\r\n        const localY = (position.y - this.topLeftCorner.y) % this._cellSize;\r\n\r\n        const minDistanceX = Math.min(localX, this._cellSize - localX);\r\n        const minDistanceY = Math.min(localY, this._cellSize - localY);\r\n        return Math.min(minDistanceX, minDistanceY);\r\n    }\r\n\r\n    /** Provides the registered items that overlap a given cell.\r\n     * @param cellX (integer) horizontal position of the wanted cell\r\n     * @param cellY (integer) vertical position of the wanted cell\r\n     * @returns array of cells that overlap the wanted cell. If the wanted cell doesn't exist, returns empty array\r\n     */\r\n    public getItemsFromCell(cellX: number, cellY: number): PatternBase[] {\r\n        if (cellX >= 0 && cellX < this.gridSize.width && cellY >= 0 && cellY < this.gridSize.height) {\r\n            const cellId = this.computeCellId(cellX, cellY);\r\n            return this.gridCells[cellId];\r\n        }\r\n        return [];\r\n    }\r\n\r\n    /** Provides the registered items that overlap a certain group of cells. Contains duplicates.\r\n     * @param minCellX (integer) horizontal position of the lowest wanted cell\r\n     * @param minCellY (integer) vertical position of the lowest wanted cell\r\n     * @param maxCellX (integer) horizontal position of the highest wanted cell\r\n     * @param maxCellY (integer) vertical position of the highest wanted cell\r\n     * @returns array of cells that overlap the wanted group of cell. If no cell matches, returns empty array\r\n     */\r\n    public getItemsFromCellsGroup(minCellX: number, minCellY: number, maxCellX: number, maxCellY: number): PatternBase[] {\r\n        const result: PatternBase[] = [];\r\n\r\n        for (let iCellY = minCellY; iCellY <= maxCellY; iCellY++) {\r\n            for (let iCellX = minCellX; iCellX <= maxCellX; iCellX++) {\r\n                const cellItems = this.getItemsFromCell(iCellX, iCellY);\r\n                result.push.apply(result, cellItems);\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    public computeStatistics(): void {\r\n        Statistics.registerGridStats(this.gridSize, this._cellSize, this.registeredItemsCount);\r\n    }\r\n\r\n    public get itemsPerCell(): number {\r\n        if (this.gridCells.length === 0) {\r\n            return 0;\r\n        }\r\n        return this.registeredItemsCount / this.gridCells.length;\r\n    }\r\n\r\n    public get cellSize(): number {\r\n        return this._cellSize;\r\n    }\r\n\r\n    /** @returns true if the cells disposition changed */\r\n    private resetDomain(domainSize: ISize, cellSize: number): boolean {\r\n        const wantedGridSizeX = Math.ceil(domainSize.width / cellSize);\r\n        const wantedGridSizeY = Math.ceil(domainSize.height / cellSize);\r\n\r\n        if (cellSize < MIN_CELL_SIZE) {\r\n            cellSize = MIN_CELL_SIZE;\r\n        } else if (cellSize > MAX_CELL_SIZE) {\r\n            cellSize = MAX_CELL_SIZE;\r\n        }\r\n\r\n        const hasChanged = (this._cellSize !== cellSize) ||\r\n            (this.gridSize.width !== wantedGridSizeX) || (this.gridSize.height !== wantedGridSizeY);\r\n\r\n        this._cellSize = cellSize;\r\n        this.gridSize.width = wantedGridSizeX;\r\n        this.gridSize.height = wantedGridSizeY;\r\n\r\n        this.topLeftCorner.x = -0.5 * domainSize.width;\r\n        this.topLeftCorner.y = -0.5 * domainSize.height;\r\n\r\n        const nbCells = this.gridSize.width * this.gridSize.height;\r\n        this.gridCells.length = nbCells; // reduce size if needed\r\n        for (let i = 0; i < nbCells; i++) {\r\n            this.gridCells[i] = []; // empty/initialize all cells\r\n        }\r\n\r\n        return hasChanged;\r\n    }\r\n\r\n    /** No check that the parameters are in bounds. */\r\n    private computeCellId(cellX: number, cellY: number): number {\r\n        return cellX + cellY * this.gridSize.width;\r\n    }\r\n}\r\n\r\nexport { Grid };","import { StopWatch } from \"./stop-watch\";\r\n\r\nimport \"../page-interface-generated\";\r\nimport { Parameters } from \"../parameters\";\r\nimport { ISize } from \"../utils/i-size\";\r\n\r\nconst VERBOSE_INTERVAL = 1000;\r\n\r\nconst timeSinceLastVerboseFrame = new StopWatch();\r\n\r\nlet frames = 0;\r\nconst timeSpentInMainLoop = new StopWatch();\r\nconst timeSpentInDraw = new StopWatch();\r\nconst timeSpentInUpdate = new StopWatch();\r\nconst timeSpentInReindex = new StopWatch();\r\nconst timeSpentInRecycle = new StopWatch();\r\nconst timeSpentInZoom = new StopWatch();\r\n\r\nlet itemsCount = 0;\r\nlet itemsRecycledCount = 0;\r\nlet itemsPendingRecyclingCount = 0;\r\nlet itemsRecyclingTries = 0;\r\n\r\nlet nbGridStats = 0;\r\nlet gridWidth = 0;\r\nlet gridHeight = 0;\r\nlet gridCellSize = 0;\r\nlet gridRegisteredItems = 0;\r\n\r\nfunction initialize(): void {\r\n    timeSinceLastVerboseFrame.reset();\r\n    timeSinceLastVerboseFrame.start();\r\n    frames = 0;\r\n}\r\n\r\nfunction registerFrame(): void {\r\n    frames++;\r\n\r\n    if (isVerboseFrame()) {\r\n        updateIndicators();\r\n        resetAll();\r\n    }\r\n}\r\n\r\nfunction isVerboseFrame(): boolean {\r\n    return timeSinceLastVerboseFrame.totalTime > VERBOSE_INTERVAL;\r\n}\r\n\r\nfunction updateIndicators(): void {\r\n    const fps = 1000 * frames / timeSinceLastVerboseFrame.totalTime;\r\n    const averageFrameTime = timeSinceLastVerboseFrame.totalTime / frames;\r\n\r\n    const averageMainLoopTime = timeSpentInMainLoop.totalTime / frames;\r\n    const mainLoopTimeRelative = averageMainLoopTime / averageFrameTime;\r\n\r\n    const averageDrawTime = timeSpentInDraw.totalTime / frames;\r\n    const drawTimeRelative = averageDrawTime / averageMainLoopTime;\r\n\r\n    const averageUpdateTime = timeSpentInUpdate.totalTime / frames;\r\n    const updateTimeRelative = averageUpdateTime / averageMainLoopTime;\r\n\r\n    const averageUpdateReindexTime = timeSpentInReindex.totalTime / frames;\r\n    const updateReindexTimeRelative = averageUpdateReindexTime / averageUpdateTime;\r\n\r\n    const averageUpdateRecycleTime = timeSpentInRecycle.totalTime / frames;\r\n    const updateRecycleTimeRelative = averageUpdateRecycleTime / averageUpdateTime;\r\n\r\n    const averageUpdateZoomTime = timeSpentInZoom.totalTime / frames;\r\n    const updateZoomTimeRelative = averageUpdateZoomTime / averageUpdateTime;\r\n\r\n    if (Parameters.isInDebug) {\r\n        Page.Canvas.setIndicatorText(\"fps\", `${fps.toFixed(0)} (${averageFrameTime.toFixed(2)} ms)`);\r\n        Page.Canvas.setIndicatorText(\"main-loop-time\", `${averageMainLoopTime.toFixed(2)} ms (${(100 * mainLoopTimeRelative).toFixed(1)} %)`);\r\n        Page.Canvas.setIndicatorText(\"draw-time\", `${averageDrawTime.toFixed(2)} ms (${(100 * drawTimeRelative).toFixed(1)} %)`);\r\n        Page.Canvas.setIndicatorText(\"update-time\", `${averageUpdateTime.toFixed(2)} ms (${(100 * updateTimeRelative).toFixed(1)} %)`);\r\n        Page.Canvas.setIndicatorText(\"update-reindex-time\", `${averageUpdateReindexTime.toFixed(2)} ms (${(100 * updateReindexTimeRelative).toFixed(1)} %)`);\r\n        Page.Canvas.setIndicatorText(\"update-recycle-time\", `${averageUpdateRecycleTime.toFixed(2)} ms (${(100 * updateRecycleTimeRelative).toFixed(1)} %)`);\r\n        Page.Canvas.setIndicatorText(\"update-zoom-time\", `${averageUpdateZoomTime.toFixed(2)} ms (${(100 * updateZoomTimeRelative).toFixed(1)} %)`);\r\n\r\n        Page.Canvas.setIndicatorText(\"items-reclycled-count\", `${(itemsRecycledCount / frames * fps).toFixed(1)}`);\r\n        Page.Canvas.setIndicatorText(\"items-pending-recycling-count\", `${(itemsPendingRecyclingCount / frames).toFixed(1)}`);\r\n        Page.Canvas.setIndicatorText(\"items-recycling-tries-count\", `${(itemsRecyclingTries / frames).toFixed(1)}`);\r\n\r\n        if (nbGridStats > 0) {\r\n            const averageGridWidth = Math.round(gridWidth / nbGridStats);\r\n            const averageGridHeight = Math.round(gridHeight / nbGridStats);\r\n            const averageGridCellCount = averageGridWidth * averageGridHeight;\r\n            Page.Canvas.setIndicatorText(\"grid-size\", `${averageGridWidth}x${averageGridHeight} (${averageGridCellCount})`);\r\n            Page.Canvas.setIndicatorText(\"grid-cell-size\", `${(gridCellSize / nbGridStats).toFixed(1)}`);\r\n            Page.Canvas.setIndicatorText(\"grid-items-per-cell\", `${(gridRegisteredItems / nbGridStats / averageGridCellCount).toFixed(1)}`);\r\n        }\r\n    } else {\r\n        Page.Canvas.setIndicatorText(\"fps\", fps.toFixed(0));\r\n    }\r\n\r\n    Page.Canvas.setIndicatorText(\"items-count\", `${itemsCount}`);\r\n    Page.Canvas.setIndicatorText(\"items-visible-count\", `${(itemsCount - itemsPendingRecyclingCount / frames).toFixed(0)}`);\r\n\r\n}\r\n\r\nfunction resetAll(): void {\r\n    timeSinceLastVerboseFrame.reset();\r\n\r\n    frames = 0;\r\n    timeSpentInMainLoop.reset();\r\n    timeSpentInDraw.reset();\r\n    timeSpentInUpdate.reset();\r\n    timeSpentInReindex.reset();\r\n    timeSpentInRecycle.reset();\r\n    timeSpentInZoom.reset();\r\n\r\n    itemsRecycledCount = 0;\r\n    itemsPendingRecyclingCount = 0;\r\n    itemsRecyclingTries = 0;\r\n\r\n    nbGridStats = 0;\r\n}\r\n\r\nfunction registerRecyclingStats(total: number, recycled: number, pendingRecycling: number, nbTriesCount: number): void {\r\n    itemsCount = total;\r\n    itemsRecycledCount += recycled;\r\n    itemsPendingRecyclingCount += pendingRecycling;\r\n    itemsRecyclingTries += nbTriesCount;\r\n}\r\n\r\nfunction registerGridStats(gridSize: ISize, cellSize: number, registeredItems: number): void {\r\n    if (nbGridStats === 0) {\r\n        gridWidth = 0;\r\n        gridHeight = 0;\r\n        gridCellSize = 0;\r\n        gridRegisteredItems = 0;\r\n    }\r\n\r\n    nbGridStats++;\r\n    gridWidth += gridSize.width;\r\n    gridHeight += gridSize.height;\r\n    gridCellSize += cellSize;\r\n    gridRegisteredItems += registeredItems;\r\n}\r\n\r\nexport {\r\n    initialize,\r\n    registerGridStats,\r\n    registerFrame,\r\n    registerRecyclingStats,\r\n    timeSpentInMainLoop,\r\n    timeSpentInDraw,\r\n    timeSpentInUpdate,\r\n    timeSpentInReindex,\r\n    timeSpentInRecycle,\r\n    timeSpentInZoom,\r\n}\r\n","class StopWatch {\r\n    private _totalTime: number;\r\n    private _lastCheckpoint: number;\r\n    private _isRunning: boolean;\r\n\r\n    constructor() {\r\n        this._totalTime = 0;\r\n        this._isRunning = false;\r\n    }\r\n\r\n    public start(): void {\r\n        if (!this._isRunning) {\r\n            this._lastCheckpoint = performance.now();\r\n            this._isRunning = true;\r\n        } else {\r\n            console.log(\"Error: stopwatch is already started\");\r\n        }\r\n    }\r\n\r\n    public stop(): void {\r\n        if (this._isRunning) {\r\n            const now = performance.now();\r\n            this._totalTime += now - this._lastCheckpoint;\r\n            this._lastCheckpoint = now;\r\n            this._isRunning = false;\r\n        } else {\r\n            console.log(\"Error: stopwatch is already stopped.\");\r\n        }\r\n    }\r\n\r\n    public reset(): void {\r\n        this._totalTime = 0;\r\n        this._lastCheckpoint = performance.now();\r\n    }\r\n\r\n    public get totalTime(): number {\r\n        if (this._isRunning) {\r\n            return this._totalTime + (performance.now() - this._lastCheckpoint);\r\n        } else {\r\n            return this._totalTime;\r\n        }\r\n    }\r\n}\r\n\r\nexport { StopWatch }\r\n","function downloadTextFile(fileName: string, content: string): void {\r\n    const fileType = \"text/plain\";\r\n\r\n    const blob = new Blob([content], { type: fileType });\r\n\r\n    if (typeof window.navigator !== \"undefined\" && typeof window.navigator.msSaveBlob !== \"undefined\") { // for IE\r\n        window.navigator.msSaveBlob(blob, fileName);\r\n    } else {\r\n        const objectUrl = URL.createObjectURL(blob);\r\n\r\n        const linkElement = document.createElement('a');\r\n        linkElement.download = fileName;\r\n        linkElement.href = objectUrl;\r\n        linkElement.dataset.downloadurl = `${fileType}:${linkElement.download}:${linkElement.href}`;\r\n        linkElement.style.display = \"none\";\r\n        document.body.appendChild(linkElement);\r\n        linkElement.click();\r\n        document.body.removeChild(linkElement);\r\n\r\n        // don't forget to free the objectURL after a few seconds\r\n        setTimeout(() => {\r\n            URL.revokeObjectURL(objectUrl);\r\n        }, 5000);\r\n    }\r\n}\r\n\r\nfunction getQueryStringValue(name: string): string | null {\r\n    const url = window.location.href;\r\n    const queryStringStart = url.indexOf(\"?\");\r\n    if (queryStringStart >= 0) {\r\n        const queryString = url.substring(queryStringStart + 1);\r\n        if (queryString.length > 0) {\r\n            const parameters = queryString.split(\"&\");\r\n            for (const parameter of parameters) {\r\n                const keyValue = parameter.split(\"=\");\r\n                if (keyValue.length === 2) {\r\n                    const decodedKey = decodeURIComponent(keyValue[0]);\r\n                    if (decodedKey === name) {\r\n                        return decodeURIComponent(keyValue[1]);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\nexport {\r\n    downloadTextFile,\r\n    getQueryStringValue,\r\n}\r\n","class NumberRange {\r\n    public constructor (public readonly from: number, public readonly to: number) {}\r\n\r\n    public isInRange(candidate: number): boolean {\r\n        return this.from <= candidate && candidate <= this.to;\r\n    }\r\n}\r\n\r\nexport { NumberRange }\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module\n// This entry module is referenced by other modules so it can't be inlined\n__webpack_require__(633);\n"],"sourceRoot":""}